<?xml version="1.0" encoding="gbk"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>金立基础框架</title>
<meta http-equiv="Content-Type" content="text/html;charset=gbk"/>
<meta name="title" content="金立基础框架"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2014-09-22T14:24+0800"/>
<meta name="author" content="雷鸣"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="gnif.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">金立基础框架</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 简介</a></li>
<li><a href="#sec-2">2 系统架构</a>
<ul>
<li><a href="#sec-2-1">2.1 隔离与解耦</a></li>
<li><a href="#sec-2-2">2.2 系统级隔离</a></li>
<li><a href="#sec-2-3">2.3 软件分层</a></li>
<li><a href="#sec-2-4">2.4 模块级隔离</a></li>
<li><a href="#sec-2-5">2.5 包结构</a>
<ul>
<li><a href="#sec-2-5-1">2.5.1 web 项目目录结构</a></li>
<li><a href="#sec-2-5-2">2.5.2 服务组件目录结构</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-3">3 展现层</a>
<ul>
<li><a href="#sec-3-1">3.1 MVC 介绍</a></li>
<li><a href="#sec-3-2">3.2 安全与权限</a>
<ul>
<li><a href="#sec-3-2-1">3.2.1 基于 GNIF 框架的配置</a>
<ul>
<li><a href="#sec-3-2-1-1">3.2.1.1 web.xml</a></li>
<li><a href="#sec-3-2-1-2">3.2.1.2 security-context.xml</a></li>
<li><a href="#sec-3-2-1-3">3.2.1.3 app.properties</a></li>
</ul>
</li>
<li><a href="#sec-3-2-2">3.2.2 不使用 GNIF 框架的配置</a>
<ul>
<li><a href="#sec-3-2-2-1">3.2.2.1 web.xml</a></li>
<li><a href="#sec-3-2-2-2">3.2.2.2 UserInitializeFilter.java</a></li>
<li><a href="#sec-3-2-2-3">3.2.2.3 退出操作</a></li>
</ul>
</li>
<li><a href="#sec-3-2-3">3.2.3 在页面中获取用户资源</a></li>
</ul>
</li>
<li><a href="#sec-3-3">3.3 JavaScript 与 jQuery</a>
<ul>
<li><a href="#sec-3-3-1">3.3.1 递归一个列表</a></li>
<li><a href="#sec-3-3-2">3.3.2 使用局部变量</a></li>
<li><a href="#sec-3-3-3">3.3.3 使用闭包</a></li>
</ul>
</li>
<li><a href="#sec-3-4">3.4 使用 Easy UI 的开发</a>
<ul>
<li><a href="#sec-3-4-1">3.4.1 html 头部</a></li>
<li><a href="#sec-3-4-2">3.4.2 布局</a></li>
<li><a href="#sec-3-4-3">3.4.3 简单 CRUD 操作</a></li>
<li><a href="#sec-3-4-4">3.4.4 表单提交时 IE 提示下载</a></li>
<li><a href="#sec-3-4-5">3.4.5 重复提交控制</a></li>
</ul>
</li>
<li><a href="#sec-3-5">3.5 使用 FreeMarker</a>
<ul>
<li><a href="#sec-3-5-1">3.5.1 入门知识</a>
<ul>
<li><a href="#sec-3-5-1-1">3.5.1.1 获取变量值</a></li>
<li><a href="#sec-3-5-1-2">3.5.1.2 条件判断</a></li>
<li><a href="#sec-3-5-1-3">3.5.1.3 循环列表</a></li>
</ul>
</li>
<li><a href="#sec-3-5-2">3.5.2 常见用法</a>
<ul>
<li><a href="#sec-3-5-2-1">3.5.2.1 获取 Request 参数</a></li>
<li><a href="#sec-3-5-2-2">3.5.2.2 处理 null 值</a></li>
<li><a href="#sec-3-5-2-3">3.5.2.3 判断是否为空(null,empty)</a></li>
<li><a href="#sec-3-5-2-4">3.5.2.4 自定义宏（标签）</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-3-6">3.6 Java代码</a>
<ul>
<li><a href="#sec-3-6-1">3.6.1 Controller 控制器</a>
<ul>
<li><a href="#sec-3-6-1-1">3.6.1.1 默认地址映射</a></li>
<li><a href="#sec-3-6-1-2">3.6.1.2 自定义地址映射</a></li>
<li><a href="#sec-3-6-1-3">3.6.1.3 接收客户端提交参数</a></li>
<li><a href="#sec-3-6-1-4">3.6.1.4 查询数据</a></li>
<li><a href="#sec-3-6-1-5">3.6.1.5 文件上传</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-3-7">3.7 配置文件</a></li>
</ul>
</li>
<li><a href="#sec-4">4 应用层</a>
<ul>
<li><a href="#sec-4-1">4.1 测试驱动</a></li>
<li><a href="#sec-4-2">4.2 Service</a>
<ul>
<li><a href="#sec-4-2-1">4.2.1 聚合服务</a></li>
<li><a href="#sec-4-2-2">4.2.2 可否用 Map/Object 作为参数或返回值</a></li>
<li><a href="#sec-4-2-3">4.2.3 服务粒度――事务完整性</a></li>
<li><a href="#sec-4-2-4">4.2.4 Service 之间不能直接调用</a></li>
</ul>
</li>
<li><a href="#sec-4-3">4.3 Model</a>
<ul>
<li><a href="#sec-4-3-1">4.3.1 Model 的继承结构</a>
<ul>
<li><a href="#sec-4-3-1-1">4.3.1.1 可持久化对象</a></li>
<li><a href="#sec-4-3-1-2">4.3.1.2 可锁定更新对象</a></li>
<li><a href="#sec-4-3-1-3">4.3.1.3 业务对象</a></li>
</ul>
</li>
<li><a href="#sec-4-3-2">4.3.2 在 Model 中获取数据访问对象</a></li>
</ul>
</li>
<li><a href="#sec-4-4">4.4 日志</a>
<ul>
<li><a href="#sec-4-4-1">4.4.1 使用 Logger</a></li>
<li><a href="#sec-4-4-2">4.4.2 配置 log4j.properties</a></li>
<li><a href="#sec-4-4-3">4.4.3 配置 log4j.xml</a></li>
</ul>
</li>
<li><a href="#sec-4-5">4.5 异常</a>
<ul>
<li><a href="#sec-4-5-1">4.5.1 异常类的层次结构</a></li>
<li><a href="#sec-4-5-2">4.5.2 异常与事务处理</a></li>
<li><a href="#sec-4-5-3">4.5.3 异常与用户交互</a></li>
</ul>
</li>
<li><a href="#sec-4-6">4.6 其它</a>
<ul>
<li><a href="#sec-4-6-1">4.6.1 物理删除与逻辑删除</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-5">5 集成层</a>
<ul>
<li><a href="#sec-5-1">5.1 接口定义</a>
<ul>
<li><a href="#sec-5-1-1">5.1.1 同步数据</a></li>
<li><a href="#sec-5-1-2">5.1.2 乐观锁更新</a></li>
</ul>
</li>
<li><a href="#sec-5-2">5.2 MyBatis O/R Mapping</a>
<ul>
<li><a href="#sec-5-2-1">5.2.1 使用 sql 将包装可复用的 sql 语句</a></li>
<li><a href="#sec-5-2-2">5.2.2 使用 resultMap 建立对象与关系表的映射</a>
<ul>
<li><a href="#sec-5-2-2-1">5.2.2.1 基本结构</a></li>
<li><a href="#sec-5-2-2-2">5.2.2.2 一对一关联</a></li>
<li><a href="#sec-5-2-2-3">5.2.2.3 一对多关联</a></li>
</ul>
</li>
<li><a href="#sec-5-2-3">5.2.3 自动映射</a></li>
</ul>
</li>
<li><a href="#sec-5-3">5.3 MyBatis 动态 SQL 语句</a>
<ul>
<li><a href="#sec-5-3-1">5.3.1 使用 _parameter</a></li>
<li><a href="#sec-5-3-2">5.3.2 模糊查询 like '%?%'</a></li>
<li><a href="#sec-5-3-3">5.3.3 if 判断</a></li>
<li><a href="#sec-5-3-4">5.3.4 switch 判断</a></li>
<li><a href="#sec-5-3-5">5.3.5 trim 去掉多余内容</a></li>
<li><a href="#sec-5-3-6">5.3.6 foreach 迭代变量</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-6">6 代码规范</a>
<ul>
<li><a href="#sec-6-1">6.1 通用规范</a></li>
<li><a href="#sec-6-2">6.2 数据库</a>
<ul>
<li><a href="#sec-6-2-1">6.2.1 命名规范</a></li>
<li><a href="#sec-6-2-2">6.2.2 数据库的全局配置类</a></li>
<li><a href="#sec-6-2-3">6.2.3 初始化 SQL</a></li>
<li><a href="#sec-6-2-4">6.2.4 删除表 SQL</a></li>
<li><a href="#sec-6-2-5">6.2.5 升级数据库 SQL</a></li>
</ul>
</li>
<li><a href="#sec-6-3">6.3 Java 代码</a>
<ul>
<li><a href="#sec-6-3-1">6.3.1 项目命名</a></li>
<li><a href="#sec-6-3-2">6.3.2 类命名</a></li>
<li><a href="#sec-6-3-3">6.3.3 属性名</a></li>
<li><a href="#sec-6-3-4">6.3.4 方法名</a></li>
<li><a href="#sec-6-3-5">6.3.5 注释</a></li>
<li><a href="#sec-6-3-6">6.3.6 代码格式</a></li>
</ul>
</li>
<li><a href="#sec-6-4">6.4 WEB 页面</a></li>
<li><a href="#sec-6-5">6.5 配置文件</a></li>
<li><a href="#sec-6-6">6.6 访问路径</a></li>
</ul>
</li>
<li><a href="#sec-7">7 系统开发</a>
<ul>
<li><a href="#sec-7-1">7.1 项目主要阶段</a>
<ul>
<li><a href="#sec-7-1-1">7.1.1 项目设计与原型</a></li>
<li><a href="#sec-7-1-2">7.1.2 建立模型</a></li>
</ul>
</li>
<li><a href="#sec-7-2">7.2 环境介绍</a></li>
<li><a href="#sec-7-3">7.3 开发环境</a></li>
<li><a href="#sec-7-4">7.4 eclipse</a>
<ul>
<li><a href="#sec-7-4-1">7.4.1 使用快捷键</a></li>
<li><a href="#sec-7-4-2">7.4.2 使用远程 Debug</a></li>
<li><a href="#sec-7-4-3">7.4.3 设置</a>
<ul>
<li><a href="#sec-7-4-3-1">7.4.3.1 项目编码格式</a></li>
<li><a href="#sec-7-4-3-2">7.4.3.2 maven</a></li>
<li><a href="#sec-7-4-3-3">7.4.3.3 jdk</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-7-5">7.5 maven 使用</a>
<ul>
<li><a href="#sec-7-5-1">7.5.1 maven 原理</a>
<ul>
<li><a href="#sec-7-5-1-1">7.5.1.1 pom.xml</a></li>
<li><a href="#sec-7-5-1-2">7.5.1.2 maven 运作</a></li>
<li><a href="#sec-7-5-1-3">7.5.1.3 maven 网络结构</a></li>
</ul>
</li>
<li><a href="#sec-7-5-2">7.5.2 maven 环境搭建</a></li>
</ul>
</li>
<li><a href="#sec-7-6">7.6 svn 使用</a>
<ul>
<li><a href="#sec-7-6-1">7.6.1 放弃最近的修改</a></li>
<li><a href="#sec-7-6-2">7.6.2 分支版本及标签</a></li>
<li><a href="#sec-7-6-3">7.6.3 查看版本提交历史</a></li>
</ul>
</li>
<li><a href="#sec-7-7">7.7 git 使用</a></li>
<li><a href="#sec-7-8">7.8 firebug 使用</a>
<ul>
<li><a href="#sec-7-8-1">7.8.1 运行 javascript 代码</a></li>
<li><a href="#sec-7-8-2">7.8.2 查看所有网络传输数据</a></li>
<li><a href="#sec-7-8-3">7.8.3 动态调整 css</a></li>
<li><a href="#sec-7-8-4">7.8.4 动态调整 html 元素</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-8">8 系统测试</a>
<ul>
<li><a href="#sec-8-1">8.1 功能测试与集成测试</a></li>
<li><a href="#sec-8-2">8.2 快速发布版本</a></li>
</ul>
</li>
<li><a href="#sec-9">9 系统部署</a>
<ul>
<li><a href="#sec-9-1">9.1 包命名规范</a>
<ul>
<li><a href="#sec-9-1-1">9.1.1 全量文件</a></li>
<li><a href="#sec-9-1-2">9.1.2 补丁包文件</a></li>
</ul>
</li>
<li><a href="#sec-9-2">9.2 配置文件</a>
<ul>
<li><a href="#sec-9-2-1">9.2.1 app.properties</a></li>
<li><a href="#sec-9-2-2">9.2.2 log4j.properties</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-10">10 开发工具介绍</a>
<ul>
<li><a href="#sec-10-1">10.1 WEB应用开发工具</a></li>
<li><a href="#sec-10-2">10.2 功能模块的设置</a></li>
<li><a href="#sec-10-3">10.3 代码生成</a>
<ul>
<li><a href="#sec-10-3-1">10.3.1 集成层</a></li>
<li><a href="#sec-10-3-2">10.3.2 应用层</a></li>
<li><a href="#sec-10-3-3">10.3.3 展现层</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-11">11 核心系统介绍</a>
<ul>
<li><a href="#sec-11-1">11.1 核心系统关联</a></li>
<li><a href="#sec-11-2">11.2 用户核心操作时序图</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> 简介</h2>
<div class="outline-text-2" id="text-1">


<p>
GNIF 全称为 Gionee Infrastructure Framework，中文名：金立基础框架。GNIF 的核心是定义一套规范，在系统、前后台、模块上将代码进行隔离，实现各个层面的解耦。以达到降低技术复杂度，提升代码可重用的目的。
</p>
<p>
基于 GNIF 规范提供的基础代码包括：
</p>
<ul>
<li>核心系统(war)
<ul>
<li>集中认证系统(CAS/AUTH)
</li>
<li>认证与授权管理系统(UAAM)
</li>
<li>工作流平台(GNIFLOW)
</li>
<li>用户中心(EOA)
</li>
<li>报表平台
</li>
</ul>

</li>
<li>核心模块(jar)
<ul>
<li>模块基础包(gnif-core.jar)
</li>
<li>用户授权模块(gnif-auth.jar)
</li>
</ul>

</li>
<li>开发工具
<ul>
<li>项目原型(gnifweb)
</li>
<li>开发支持包(devtool)
</li>
</ul>

</li>
</ul>


<p>
核心系统将系统中通用的功能抽取出来作为公共系统。如，一个系统通常会涉及到认证（登录）、授权（将用户放入session）、工作流（解决系统间的交互）等功能。在核心系统的作用之下，各业务系统不需要再开发这些模块。这样可以整体减少系统的开发工作量。
</p>
<p>
核心模块将系统中经常用到的获取用户包括用户组织架构、用户权限，访问应用容器中对象等常用操作抽取出来，供业务系统调用。业务系统代码可以只关注业务运算，复杂的技术细节交给核心模块。这样可以实现各业务系统共享常用操作，业务系统代码得到简化的目标。
</p>
<p>
本文档将详细介绍 GNIF 框架，读者通过本文档可以全面了解框架，能够使用框架进行开发，并根据规范在适当的系统、模块对框架进行扩展。
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> 系统架构</h2>
<div class="outline-text-2" id="text-2">



</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> 隔离与解耦</h3>
<div class="outline-text-3" id="text-2-1">


<p>
解决软件复杂度的主要方式就是隔离。将一个复杂的软件有效地分割，可以让每个被分割的部分所涉及的功能更加专一，该功能所涉及的开发与维护也会相应地更加专一。这样可以让开发与维护工作更加简单。隔离的目的就是为了解耦，解耦的结果就是：被隔离的功能专一。
</p>
<p>
有效的隔离才能实现解耦，无效的隔离不仅不能解耦，通常会导致大量的时间浪费的同时并不能带来软件开发、运维效率上的提升。GNIF 从系统级隔离、软件分层、软件分模块等三个方面来进行系统隔离。系统级隔离，将通用系统功能分离出来作为单独的系统，包括用户认证，用户授权等系统；软件分层，将软件从前端到后端分为展现层、应用层、集成层；软件分模块，在软件分层的基础上，将各层的功能按模块独立出来。
</p>
<p>
<img src="architecture.png"  alt="architecture.png" />
</p>
</div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> 系统级隔离</h3>
<div class="outline-text-3" id="text-2-2">


<p>
在传统软件开发过种中,通常每开发一个系统,都需要写用户管理、用户登录等内容。一些快速开发平台将用户管理、用户授权等内容集成在平台内部，开发人员在平台的项目原型中可以直接得到用户管理、权限管理的代码。这在一定程度上减少了开发量。在 GNIF 中，用户管理、权限管理作为一个单独的基础系统存在。这样做的优势在于，用户管理系统进一步与业务系统解耦。用户管理系统的开发与维护对业务系统的影响很小。这种层面的隔离即系统级隔离。
</p>
<p>
系统级隔离是将通用业务功能开发为单独的系统。系统与系统之间通过远程调用，API等方式进行数据交互。
</p>
<p>
以下功能可以开发成单独系统：
</p>
<ol>
<li>用户认证与授权管理系统(UAAM) 该系统提供各业务系统的用户管理功能。所有业务系统的用户管理都由该系统来完成。系统包括：用户新增、用户密码设定、用户权限设置等功能。
</li>
<li>集中认证服务(CAS) 该服务提供业务系统的登录认证功能。所有业务系统通过该系统进行登录认证。通过该服务可以完成单点登录功能。
</li>
<li>工作流平台(FP) 该平台提供系统与系统之间的数据交互机制，业务系统之间可以通过该平台完成需要协作处理的功能。
</li>
</ol>


</div>

</div>

<div id="outline-container-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> 软件分层</h3>
<div class="outline-text-3" id="text-2-3">


<p>
分层概念在软件开发的过程中就一直存在。如，CPU指令(汇编语言)/C语言/Java语言 都是由高级语言调用低级语言。GNIF 的分层是指，由展现层、应用层、集成层三层组成的分层结构。分层要求调用只能由高层调用低层代码，低层不得调用高层代码。
</p>
<ul>
<li>展现层：负责与用户交互，具体包括从应用层取数据显示到用户端，从用户端获取数据传给应用层完成业务逻辑。
</li>
<li>应用层：负责完成数据业务处理。
</li>
<li>集成层：负责业务数据与第三方交互。如，数据的持久化。
</li>
</ul>


<p>
<img src="layer.png"  alt="layer.png" />
</p>
<p>
软件分层之下，高层调用低层代码时，低层代码需要提供接口给高层代码。低层可以根据接口来开发不同的实现。如，展现层通过 Controller 调用 Service 接口，如果 Service 的实现发生改变，也不会影响 Controller 的调用。
</p>
</div>

</div>

<div id="outline-container-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> 模块级隔离</h3>
<div class="outline-text-3" id="text-2-4">


<p>
模块级隔离建立在分层基础上，指在某一个或者几个分层中，能够独立完成特定功能的代码，将其隔离。如，用户管理，是基于应用层与集成层提供的完成用户管理的代码模块。工作流(activiti)是基于应用层提供的完成工作流功能的代码模块。
</p>
</div>

</div>

<div id="outline-container-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> 包结构</h3>
<div class="outline-text-3" id="text-2-5">


<p>
基于 GNIF 开发的内容分为两类：
</p>
<ol>
<li>web 项目。以 war 包的形式存在。用于对终端用户提供基于浏览器访问的服务
</li>
<li>服务组件。以 jar 包的形式存在。用于对开发人员提供 API，简化开发，提升代码可重用性
</li>
</ol>


<p>
GNIF 开发的两种类型项目，均以 com.gionee.项目名 为包名。
</p>

</div>

<div id="outline-container-2-5-1" class="outline-4">
<h4 id="sec-2-5-1"><span class="section-number-4">2.5.1</span> web 项目目录结构</h4>
<div class="outline-text-4" id="text-2-5-1">


<ul>
<li>com.gionee.projectname 项目包名
<ul>
<li>web 展现层
<ul>
<li>controller 控制器
</li>
<li>response JSON响应对象
</li>
<li>util 工具类，用于转换数据
</li>
</ul>

</li>
<li>biz 应用层
<ul>
<li>service 服务接口
</li>
<li>service.impl 服务实现类
</li>
<li>model 数据模型
</li>
</ul>

</li>
<li>integration 集成层
<ul>
<li>dao 数据访问对象
</li>
<li>sao 服务访问对象
</li>
</ul>

</li>
<li>constant 常量
</li>
</ul>

</li>
</ul>


</div>

</div>

<div id="outline-container-2-5-2" class="outline-4">
<h4 id="sec-2-5-2"><span class="section-number-4">2.5.2</span> 服务组件目录结构</h4>
<div class="outline-text-4" id="text-2-5-2">


<ul>
<li>com.gionee.projectname 项目包名
<ul>
<li>XxxService 服务接口定义
</li>
<li>YyyService 服务接口定义
</li>
<li>ProjectConfig 服务配置文件定义
</li>
<li>impl 服务实现
<ul>
<li>XxxServiceImpl
</li>
<li>YyyServiceImpl
</li>
</ul>

</li>
<li>model 服务对应的数据模型
</li>
<li>util 服务所用到的工具类
</li>
<li>dao 服务所用到的数据访问对象
</li>
<li>constant 常量
</li>
</ul>

</li>
</ul>


</div>
</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> 展现层</h2>
<div class="outline-text-2" id="text-3">



</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> MVC 介绍</h3>
<div class="outline-text-3" id="text-3-1">


<p>
MVC 是当前 WEB 开发的主要模式。过去的开发将业务逻辑、接受用户数据、展现用户数据等操作放在一起（如：放在一个 JSP 文件中），导致代码的重用程度不高、维护难度大。MVC 模式正是为着解决这个问题而产生的。
</p>
<p>
MVC 将代码分为三个模块：
</p>
<ul>
<li>Model：业务模型，用于处理业务逻辑。
</li>
<li>View：视图，用于展现数据给用户。
</li>
<li>Controller：控制器，用于接收用户数据并协调 Model 完成业务逻辑处理。
</li>
</ul>


<p>
从 GNIF 的分层而言，GNIF 的 Web 曾采用 Spring MVC。基于 Spring MVC，GNIF 的三层为：
</p>
<ul>
<li>Model：以 Service 为接口的后端代码，即 biz、integration 中的代码
</li>
<li>View：采用 Freemarker 作为视图展现方案
</li>
<li>Controller：即 Spring MVC 中的 Controller
</li>
</ul>


</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> 安全与权限</h3>
<div class="outline-text-3" id="text-3-2">



</div>

<div id="outline-container-3-2-1" class="outline-4">
<h4 id="sec-3-2-1"><span class="section-number-4">3.2.1</span> 基于 GNIF 框架的配置</h4>
<div class="outline-text-4" id="text-3-2-1">


<p>
GNIF 的 WEB 项目基于 CAS 登录。WEB 项目在认证与授权由 spring-security<sup><a class="footref" name="fnr-.1" href="#fn-.1">1</a></sup> 接管。配置 spring-security 主要是 web.xml 及 security-context.xml。在 security-context.xml 中引入了外部属性配置文件，从 app.properties 中可以看到配置样例。
</p>

</div>

<div id="outline-container-3-2-1-1" class="outline-5">
<h5 id="sec-3-2-1-1"><span class="section-number-5">3.2.1.1</span> web.xml</h5>
<div class="outline-text-5" id="text-3-2-1-1">





<pre class="src src-xml">&lt;?<span style="color: #a020f0;">xml</span> <span style="color: #a0522d;">version</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">1.0</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">encoding</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">ISO-8859-1</span><span style="color: #8b2252;">"</span>?&gt;

&lt;<span style="color: #0000ff;">web-app</span> <span style="color: #483d8b;">xmlns</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://java.sun.com/xml/ns/javaee</span><span style="color: #8b2252;">"</span> <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">xsi</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.w3.org/2001/XMLSchema-instance</span><span style="color: #8b2252;">"</span>
         <span style="color: #483d8b;">xsi</span>:<span style="color: #a0522d;">schemaLocation</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd</span><span style="color: #8b2252;">"</span>
         <span style="color: #a0522d;">version</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">2.5</span><span style="color: #8b2252;">"</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622;&#26435;&#38480;&#36807;&#28388;&#22120; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">filter</span>&gt;
    &lt;<span style="color: #0000ff;">filter-name</span>&gt;springSecurityFilterChain&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
    &lt;<span style="color: #0000ff;">filter-class</span>&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/<span style="color: #0000ff;">filter-class</span>&gt;
  &lt;/<span style="color: #0000ff;">filter</span>&gt;
  &lt;<span style="color: #0000ff;">filter-mapping</span>&gt;
    &lt;<span style="color: #0000ff;">filter-name</span>&gt;springSecurityFilterChain&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
    &lt;<span style="color: #0000ff;">url-pattern</span>&gt;/*&lt;/<span style="color: #0000ff;">url-pattern</span>&gt;
  &lt;/<span style="color: #0000ff;">filter-mapping</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622;&#21152;&#36733; spring &#23481;&#22120;&#30340;&#30417;&#21548;&#22120; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">listener</span>&gt;
    &lt;<span style="color: #0000ff;">listener-class</span>&gt;org.springframework.web.context.ContextLoaderListener&lt;/<span style="color: #0000ff;">listener-class</span>&gt;
  &lt;/<span style="color: #0000ff;">listener</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622;&#21152;&#36733; spring &#31383;&#21475;&#26102;&#38656;&#35201;&#35835;&#21462;&#30340;&#37197;&#32622;&#25991;&#20214; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">context-param</span>&gt;
    &lt;<span style="color: #0000ff;">param-name</span>&gt;contextConfigLocation&lt;/<span style="color: #0000ff;">param-name</span>&gt;
    &lt;<span style="color: #0000ff;">param-value</span>&gt;/WEB-INF/biz-context.xml,/WEB-INF/security-context.xml&lt;/<span style="color: #0000ff;">param-value</span>&gt;
  &lt;/<span style="color: #0000ff;">context-param</span>&gt;

&lt;/<span style="color: #0000ff;">web-app</span>&gt;
</pre>


</div>

</div>

<div id="outline-container-3-2-1-2" class="outline-5">
<h5 id="sec-3-2-1-2"><span class="section-number-5">3.2.1.2</span> security-context.xml</h5>
<div class="outline-text-5" id="text-3-2-1-2">





<pre class="src src-xml">&lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">beans</span> <span style="color: #483d8b;">xmlns</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.springframework.org/schema/security</span><span style="color: #8b2252;">"</span>
             <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">beans</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.springframework.org/schema/beans</span><span style="color: #8b2252;">"</span>
             <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">xsi</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.w3.org/2001/XMLSchema-instance</span><span style="color: #8b2252;">"</span>
             <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">context</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.springframework.org/schema/context</span><span style="color: #8b2252;">"</span>
             <span style="color: #483d8b;">xsi</span>:<span style="color: #a0522d;">schemaLocation</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.springframework.org/schema/beans</span>
<span style="color: #8b2252;">                                 http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span style="color: #8b2252;">                                 http://www.springframework.org/schema/context</span>
<span style="color: #8b2252;">                                 http://www.springframework.org/schema/context/spring-context.xsd</span>
<span style="color: #8b2252;">                                 http://www.springframework.org/schema/security</span>
<span style="color: #8b2252;">                                 http://www.springframework.org/schema/security/spring-security-3.1.xsd</span><span style="color: #8b2252;">"</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#23646;&#24615;&#37197;&#32622;&#25991;&#20214; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">context</span>:<span style="color: #0000ff;">property-placeholder</span> <span style="color: #a0522d;">location</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">classpath:app.properties</span><span style="color: #8b2252;">"</span>/&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#19981;&#38656;&#35201;&#25318;&#25130;&#30340;URL </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">http</span> <span style="color: #a0522d;">security</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">none</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">pattern</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/index.html</span><span style="color: #8b2252;">"</span>&gt;&lt;/<span style="color: #0000ff;">http</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#38656;&#35201;&#36827;&#34892;&#25318;&#25130;&#30340;URL </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">http</span> <span style="color: #a0522d;">pattern</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/**</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">entry-point-ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">casEntryPoint</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">custom-filter</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">requestSingleLogoutFilter</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">before</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">LOGOUT_FILTER</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;<span style="color: #0000ff;">custom-filter</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">singleLogoutFilter</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">before</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">CAS_FILTER</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;<span style="color: #0000ff;">custom-filter</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">casFilter</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">position</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">CAS_FILTER</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">custom-filter</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">gnifFilterSecurityInterceptor</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">before</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">FILTER_SECURITY_INTERCEPTOR</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">logout</span> <span style="color: #a0522d;">logout-success-url</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/cas-logout.jsp</span><span style="color: #8b2252;">"</span>/&gt;
  &lt;/<span style="color: #0000ff;">http</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#36864;&#20986;&#30331;&#24405;&#21457;&#36865;&#22120;&#65292;&#29992;&#20110;&#21521; CAS &#21457;&#36865;&#29992;&#25143;&#30340;&#21333;&#28857;&#36864;&#20986;&#35831;&#27714; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">requestSingleLogoutFilter</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.security.web.authentication.logout.LogoutFilter</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">constructor-arg</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">${cas.logout.url}</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">constructor-arg</span>&gt;
      &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;/<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">constructor-arg</span>&gt;
    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39029;&#38754;&#30340;&#36864;&#20986;&#25353;&#38062;&#20351;&#29992;&#20197;&#19979;URL </span><span style="color: #b22222;">--&gt;</span>
    &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">filterProcessesUrl</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/j_spring_cas_security_logout</span><span style="color: #8b2252;">"</span>/&gt;
  &lt;/<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#21333;&#28857;&#36864;&#20986;&#36807;&#28388;&#22120;&#65292;&#29992;&#20110;&#28165;&#31354; session </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">singleLogoutFilter</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.web.GnifSingleSignOutFilter</span><span style="color: #8b2252;">"</span>/&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25480;&#26435;&#25318;&#25130;&#22120;&#65292;&#26681;&#25454;&#29992;&#25143;&#30340;&#26435;&#38480;&#65292;&#23545;&#35831;&#27714;&#30340; URL &#36827;&#34892;&#25318;&#25130; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">gnifFilterSecurityInterceptor</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.auth.security.FilterSecurityInterceptorImpl</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">securityMetadataSource</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.auth.security.InvocationSecurityMetadataSourceImpl</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;/<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span>&gt;
    &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">authenticationManager</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">authenticationManager</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">accessDecisionManager</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.auth.security.AccessDecisionManagerImpl</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;/<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span>&gt;
  &lt;/<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#29992;&#25143;&#20449;&#24687;&#26381;&#21153;&#65292;&#22312;&#29992;&#25143;&#30331;&#24405;&#26102;&#65292;&#20174;&#25968;&#25454;&#24211;&#21462;&#20986;&#30331;&#24405;&#29992;&#25143;&#30340;&#26435;&#38480;&#25918;&#20837; session </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">userDetailService</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.auth.security.cas.CasUserDetailsServiceImpl</span><span style="color: #8b2252;">"</span> /&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> CAS &#36807;&#28388;&#22120;&#65292;&#29992;&#25143;&#35748;&#35777;&#36890;&#36807;&#35813;&#20027;&#31867;&#26469;&#23436;&#25104; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">casFilter</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.security.cas.web.CasAuthenticationFilter</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">authenticationManager</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">authenticationManager</span><span style="color: #8b2252;">"</span>/&gt;
  &lt;/<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#35748;&#35777;&#31649;&#29702;&#31867;&#65292;&#31649;&#29702;&#35748;&#35777;&#26041;&#24335;&#65292;&#24403;&#21069;&#20351;&#29992;&#30340;&#35748;&#35777;&#26041;&#24335;&#20026;&#36890;&#36807; CAS &#36827;&#34892;&#35748;&#35777; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">authentication-manager</span> <span style="color: #a0522d;">alias</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">authenticationManager</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">authentication-provider</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">casAuthenticationProvider</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #0000ff;">authentication-manager</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> CAS &#35748;&#35777;&#37197;&#32622;&#65292;&#36890;&#36807;&#35813;&#31867;&#35775;&#38382; CAS &#30830;&#35748;&#29992;&#25143;&#26159;&#21542;&#24050;&#32463;&#30331;&#24405; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">casAuthenticationProvider</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.security.cas.authentication.CasAuthenticationProvider</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">authenticationUserDetailsService</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.security.core.userdetails.UserDetailsByNameServiceWrapper</span><span style="color: #8b2252;">"</span>&gt;
        &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">constructor-arg</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">userDetailService</span><span style="color: #8b2252;">"</span> /&gt;
      &lt;/<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span>&gt;
    &lt;/<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span>&gt;
    &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">serviceProperties</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">serviceProperties</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">ticketValidator</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.jasig.cas.client.validation.Cas20ServiceTicketValidator</span><span style="color: #8b2252;">"</span>&gt;
        &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">constructor-arg</span> <span style="color: #a0522d;">index</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">0</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">${cas.auth.url}</span><span style="color: #8b2252;">"</span> /&gt;
      &lt;/<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span>&gt;
    &lt;/<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span>&gt;
    &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">key</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">an_id_for_this_auth_provider_only</span><span style="color: #8b2252;">"</span>/&gt;
  &lt;/<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#19982; CAS &#20132;&#20114;&#26102;&#38656;&#35201;&#20256;&#36882;&#30340;&#23646;&#24615; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">serviceProperties</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.security.cas.ServiceProperties</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">service</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">${base.path}j_spring_cas_security_check</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">sendRenew</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">false</span><span style="color: #8b2252;">"</span>/&gt;
  &lt;/<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#29992;&#25143;&#35748;&#35777;&#37325;&#23450;&#21521;&#37197;&#32622;&#65292;&#22914;&#26524;&#29992;&#25143;&#22312;&#24403;&#21069;&#31995;&#32479;&#38656;&#35201;&#30331;&#24405;&#65292;&#20250;&#26681;&#25454;&#20197;&#19979;&#37197;&#32622;&#37325;&#23450;&#21521;&#21040; CAS &#36827;&#34892;&#30331;&#24405;&#35748;&#35777; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">casEntryPoint</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.security.cas.web.CasAuthenticationEntryPoint</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">loginUrl</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">${cas.login.url}</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">serviceProperties</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">serviceProperties</span><span style="color: #8b2252;">"</span>/&gt;
  &lt;/<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">bean</span>&gt;

&lt;/<span style="color: #483d8b;">beans</span>:<span style="color: #0000ff;">beans</span>&gt;
</pre>


</div>

</div>

<div id="outline-container-3-2-1-3" class="outline-5">
<h5 id="sec-3-2-1-3"><span class="section-number-5">3.2.1.3</span> app.properties</h5>
<div class="outline-text-5" id="text-3-2-1-3">





<pre class="src src-conf"><span style="color: #a0522d;">base.path</span>=http://localhost:8080/project_name

<span style="color: #b22222;"># </span><span style="color: #b22222;">CAS &#26381;&#21153;&#22120;&#30331;&#24405;&#22320;&#22336;</span>
<span style="color: #a0522d;">cas.login.url</span>=http://192.168.0.96/cas/login
<span style="color: #b22222;"># </span><span style="color: #b22222;">CAS &#26381;&#21153;&#22120;&#36864;&#20986;&#30331;&#24405;&#22320;&#22336;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#21152;&#19978; redirect &#21442;&#25968;&#65292;&#21017;&#36864;&#20986;&#30331;&#24405;&#20043;&#21518;&#20877;&#30331;&#24405;&#20250;&#36827;&#20837;&#21040;&#21442;&#25968;&#25351;&#23450;&#30340; URL</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#19981;&#21152; redirect &#21442;&#25968;&#65292;&#21017;&#36864;&#20986;&#30331;&#24405;&#20043;&#21518;&#65292;&#20877;&#30331;&#24405;&#20250;&#36827;&#20837;&#40664;&#35748;&#25104;&#21151;&#30028;&#38754;(EOA)</span>
<span style="color: #a0522d;">cas.logout.url</span>=http://192.168.0.96/cas/logout?redirect=localhost:8080/
<span style="color: #b22222;"># </span><span style="color: #b22222;">CAS &#26381;&#21153;&#22120;&#26657;&#39564;&#22320;&#22336;</span>
<span style="color: #a0522d;">cas.auth.url</span>=http://192.168.0.96/cas
</pre>


</div>
</div>

</div>

<div id="outline-container-3-2-2" class="outline-4">
<h4 id="sec-3-2-2"><span class="section-number-4">3.2.2</span> 不使用 GNIF 框架的配置</h4>
<div class="outline-text-4" id="text-3-2-2">


<p>
部分早期开发的项目没有使用 GNIF 框架，也可以与 CAS 集成实现单点登录。需要在 web.xml 中配置过滤器。再写一个授权过滤器的实现类即可。
</p>

</div>

<div id="outline-container-3-2-2-1" class="outline-5">
<h5 id="sec-3-2-2-1"><span class="section-number-5">3.2.2.1</span> web.xml</h5>
<div class="outline-text-5" id="text-3-2-2-1">


<p>
所配置的过滤器有顺序区分，应当将以下所示的所有过滤器按顺序放在最前面，然后再放置业务系统所使用的过滤器。
</p>



<pre class="src src-xml">&lt;?<span style="color: #a020f0;">xml</span> <span style="color: #a0522d;">version</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">1.0</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">encoding</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">ISO-8859-1</span><span style="color: #8b2252;">"</span>?&gt;

&lt;<span style="color: #0000ff;">web-app</span> <span style="color: #483d8b;">xmlns</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://java.sun.com/xml/ns/javaee</span><span style="color: #8b2252;">"</span> <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">xsi</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.w3.org/2001/XMLSchema-instance</span><span style="color: #8b2252;">"</span>
         <span style="color: #483d8b;">xsi</span>:<span style="color: #a0522d;">schemaLocation</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd</span><span style="color: #8b2252;">"</span>
         <span style="color: #a0522d;">version</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">2.5</span><span style="color: #8b2252;">"</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#29992;&#20110;&#21333;&#28857;&#36864;&#20986;&#65292;&#35813;&#36807;&#28388;&#22120;&#29992;&#20110;&#23454;&#29616;&#21333;&#28857;&#30331;&#20986;&#21151;&#33021;&#65292;&#21487;&#36873;&#37197;&#32622;</span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">listener</span>&gt;
    &lt;<span style="color: #0000ff;">listener-class</span>&gt;org.jasig.cas.client.session.SingleSignOutHttpSessionListener&lt;/<span style="color: #0000ff;">listener-class</span>&gt;
  &lt;/<span style="color: #0000ff;">listener</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#35813;&#36807;&#28388;&#22120;&#29992;&#20110;&#23454;&#29616;&#21333;&#28857;&#30331;&#20986;&#21151;&#33021;&#65292;&#21487;&#36873;&#37197;&#32622;&#12290; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">filter</span>&gt;
    &lt;<span style="color: #0000ff;">filter-name</span>&gt;CAS Single Sign Out Filter&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
    &lt;<span style="color: #0000ff;">filter-class</span>&gt;org.jasig.cas.client.session.SingleSignOutFilter&lt;/<span style="color: #0000ff;">filter-class</span>&gt;
  &lt;/<span style="color: #0000ff;">filter</span>&gt;
  &lt;<span style="color: #0000ff;">filter-mapping</span>&gt;
    &lt;<span style="color: #0000ff;">filter-name</span>&gt;CAS Single Sign Out Filter&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
    &lt;<span style="color: #0000ff;">url-pattern</span>&gt;/*&lt;/<span style="color: #0000ff;">url-pattern</span>&gt;
  &lt;/<span style="color: #0000ff;">filter-mapping</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#35813;&#36807;&#28388;&#22120;&#36127;&#36131;&#29992;&#25143;&#30340;&#35748;&#35777;&#24037;&#20316;&#65292;&#24517;&#39035;&#21551;&#29992;&#23427; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">filter</span>&gt;
    &lt;<span style="color: #0000ff;">filter-name</span>&gt;CASFilter&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
    &lt;<span style="color: #0000ff;">filter-class</span>&gt;org.jasig.cas.client.authentication.AuthenticationFilter&lt;/<span style="color: #0000ff;">filter-class</span>&gt;
    &lt;<span style="color: #0000ff;">init-param</span>&gt;
      <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> CAS &#26381;&#21153;&#22120;&#30331;&#24405;&#22320;&#22336; </span><span style="color: #b22222;">--&gt;</span>
      &lt;<span style="color: #0000ff;">param-name</span>&gt;casServerLoginUrl&lt;/<span style="color: #0000ff;">param-name</span>&gt;
      &lt;<span style="color: #0000ff;">param-value</span>&gt;http://192.168.0.96/cas/login&lt;/<span style="color: #0000ff;">param-value</span>&gt;
    &lt;/<span style="color: #0000ff;">init-param</span>&gt;
    &lt;<span style="color: #0000ff;">init-param</span>&gt;
      <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#24403;&#21069;&#31995;&#32479;&#22320;&#22336; </span><span style="color: #b22222;">--&gt;</span>
      &lt;<span style="color: #0000ff;">param-name</span>&gt;serverName&lt;/<span style="color: #0000ff;">param-name</span>&gt;
      &lt;<span style="color: #0000ff;">param-value</span>&gt;http://localhost:8080&lt;/<span style="color: #0000ff;">param-value</span>&gt;
    &lt;/<span style="color: #0000ff;">init-param</span>&gt;
  &lt;/<span style="color: #0000ff;">filter</span>&gt;
  &lt;<span style="color: #0000ff;">filter-mapping</span>&gt;
    &lt;<span style="color: #0000ff;">filter-name</span>&gt;CASFilter&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
    &lt;<span style="color: #0000ff;">url-pattern</span>&gt;/*&lt;/<span style="color: #0000ff;">url-pattern</span>&gt;
  &lt;/<span style="color: #0000ff;">filter-mapping</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#35813;&#36807;&#28388;&#22120;&#36127;&#36131;&#23545;Ticket&#30340;&#26657;&#39564;&#24037;&#20316;&#65292;&#24517;&#39035;&#21551;&#29992;&#23427; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">filter</span>&gt;
    &lt;<span style="color: #0000ff;">filter-name</span>&gt;CAS Validation Filter&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
    &lt;<span style="color: #0000ff;">filter-class</span>&gt;org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter&lt;/<span style="color: #0000ff;">filter-class</span>&gt;
    &lt;<span style="color: #0000ff;">init-param</span>&gt;
      <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> CAS &#26381;&#21153;&#22120;&#22320;&#22336; </span><span style="color: #b22222;">--&gt;</span>
      &lt;<span style="color: #0000ff;">param-name</span>&gt;casServerUrlPrefix&lt;/<span style="color: #0000ff;">param-name</span>&gt;
      &lt;<span style="color: #0000ff;">param-value</span>&gt;http://192.168.0.96/cas&lt;/<span style="color: #0000ff;">param-value</span>&gt;
    &lt;/<span style="color: #0000ff;">init-param</span>&gt;
    &lt;<span style="color: #0000ff;">init-param</span>&gt;
      <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#24403;&#21069;&#31995;&#32479;&#22320;&#22336; </span><span style="color: #b22222;">--&gt;</span>
      &lt;<span style="color: #0000ff;">param-name</span>&gt;serverName&lt;/<span style="color: #0000ff;">param-name</span>&gt;
      &lt;<span style="color: #0000ff;">param-value</span>&gt;http://localhost:8080&lt;/<span style="color: #0000ff;">param-value</span>&gt;
    &lt;/<span style="color: #0000ff;">init-param</span>&gt;
  &lt;/<span style="color: #0000ff;">filter</span>&gt;
  &lt;<span style="color: #0000ff;">filter-mapping</span>&gt;
    &lt;<span style="color: #0000ff;">filter-name</span>&gt;CAS Validation Filter&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
    &lt;<span style="color: #0000ff;">url-pattern</span>&gt;/*&lt;/<span style="color: #0000ff;">url-pattern</span>&gt;
  &lt;/<span style="color: #0000ff;">filter-mapping</span>&gt;

  <span style="color: #b22222;">&lt;!--</span>
<span style="color: #b22222;">      &#35813;&#36807;&#28388;&#22120;&#36127;&#36131;&#23454;&#29616;HttpServletRequest&#35831;&#27714;&#30340;&#21253;&#35065;&#65292;</span>
<span style="color: #b22222;">      &#27604;&#22914;&#20801;&#35768;&#24320;&#21457;&#32773;&#36890;&#36807;HttpServletRequest&#30340;getRemoteUser()&#26041;&#27861;&#33719;&#24471;SSO&#30331;&#24405;&#29992;&#25143;&#30340;&#30331;&#24405;&#21517;&#65292;&#21487;&#36873;&#37197;&#32622;&#12290;</span>
<span style="color: #b22222;">  </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">filter</span>&gt;
    &lt;<span style="color: #0000ff;">filter-name</span>&gt;CAS HttpServletRequest Wrapper Filter&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
    &lt;<span style="color: #0000ff;">filter-class</span>&gt;
    org.jasig.cas.client.util.HttpServletRequestWrapperFilter&lt;/<span style="color: #0000ff;">filter-class</span>&gt;
  &lt;/<span style="color: #0000ff;">filter</span>&gt;
  &lt;<span style="color: #0000ff;">filter-mapping</span>&gt;
    &lt;<span style="color: #0000ff;">filter-name</span>&gt;CAS HttpServletRequest Wrapper Filter&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
    &lt;<span style="color: #0000ff;">url-pattern</span>&gt;/*&lt;/<span style="color: #0000ff;">url-pattern</span>&gt;
  &lt;/<span style="color: #0000ff;">filter-mapping</span>&gt;

  <span style="color: #b22222;">&lt;!--</span>
<span style="color: #b22222;">      &#35813;&#36807;&#28388;&#22120;&#20351;&#24471;&#24320;&#21457;&#32773;&#21487;&#20197;&#36890;&#36807;org.jasig.cas.client.util.AssertionHolder&#26469;&#33719;&#21462;&#29992;&#25143;&#30340;&#30331;&#24405;&#21517;&#12290;</span>
<span style="color: #b22222;">      &#27604;&#22914;AssertionHolder.getAssertion().getPrincipal().getName()&#12290;</span>
<span style="color: #b22222;">  </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">filter</span>&gt;
    &lt;<span style="color: #0000ff;">filter-name</span>&gt;CAS Assertion Thread Local Filter&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
    &lt;<span style="color: #0000ff;">filter-class</span>&gt;org.jasig.cas.client.util.AssertionThreadLocalFilter&lt;/<span style="color: #0000ff;">filter-class</span>&gt;
  &lt;/<span style="color: #0000ff;">filter</span>&gt;
  &lt;<span style="color: #0000ff;">filter-mapping</span>&gt;
    &lt;<span style="color: #0000ff;">filter-name</span>&gt;CAS Assertion Thread Local Filter&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
    &lt;<span style="color: #0000ff;">url-pattern</span>&gt;/*&lt;/<span style="color: #0000ff;">url-pattern</span>&gt;
  &lt;/<span style="color: #0000ff;">filter-mapping</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#33258;&#21160;&#26681;&#25454;&#21333;&#28857;&#30331;&#24405;&#30340;&#32467;&#26524;&#35774;&#32622;&#26412;&#31995;&#32479;&#30340;&#29992;&#25143;&#20449;&#24687; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">filter</span>&gt;
    &lt;<span style="color: #0000ff;">display-name</span>&gt;UserInitializeFilter&lt;/<span style="color: #0000ff;">display-name</span>&gt;
    &lt;<span style="color: #0000ff;">filter-name</span>&gt;UserInitializeFilter&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
    &lt;<span style="color: #0000ff;">filter-class</span>&gt;com.gionee.casclient.UserInitializeFilter&lt;/<span style="color: #0000ff;">filter-class</span>&gt;
  &lt;/<span style="color: #0000ff;">filter</span>&gt;
  &lt;<span style="color: #0000ff;">filter-mapping</span>&gt;
    &lt;<span style="color: #0000ff;">filter-name</span>&gt;UserInitializeFilter&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
    &lt;<span style="color: #0000ff;">url-pattern</span>&gt;/*&lt;/<span style="color: #0000ff;">url-pattern</span>&gt;
  &lt;/<span style="color: #0000ff;">filter-mapping</span>&gt;

&lt;/<span style="color: #0000ff;">web-app</span>&gt;
</pre>


</div>

</div>

<div id="outline-container-3-2-2-2" class="outline-5">
<h5 id="sec-3-2-2-2"><span class="section-number-5">3.2.2.2</span> UserInitializeFilter.java</h5>
<div class="outline-text-5" id="text-3-2-2-2">





<pre class="src src-java"><span style="color: #a020f0;">package</span> com.gionee.<span style="color: #008b8b;">casclient</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">io</span>.<span style="color: #228b22;">IOException</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #228b22;">Filter</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #228b22;">FilterChain</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #228b22;">FilterConfig</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #228b22;">ServletException</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #228b22;">ServletRequest</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #228b22;">ServletResponse</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #008b8b;">http</span>.<span style="color: #228b22;">HttpServletRequest</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">org</span>.<span style="color: #008b8b;">jasig</span>.<span style="color: #008b8b;">cas</span>.<span style="color: #008b8b;">client</span>.<span style="color: #008b8b;">validation</span>.<span style="color: #228b22;">Assertion</span>;

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">UserInitializeFilter</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">Filter</span> {

    <span style="color: #a020f0;">public</span> UserInitializeFilter() {
    }

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">destroy</span>() {
    }

    <span style="color: #8b2252;">/**</span>
<span style="color: #8b2252;">     * &#36807;&#28388;&#36923;&#36753;&#65306;&#39318;&#20808;&#21028;&#26029;&#21333;&#28857;&#30331;&#24405;&#30340;&#36134;&#25143;&#26159;&#21542;&#24050;&#32463;&#23384;&#22312;&#26412;&#31995;&#32479;&#20013;&#65292; &#22914;&#26524;&#19981;&#23384;&#22312;&#20351;&#29992;&#29992;&#25143;&#26597;&#35810;&#25509;&#21475;&#26597;&#35810;&#20986;&#29992;&#25143;&#23545;&#35937;&#24182;&#35774;&#32622;&#22312;Session&#20013;</span>
<span style="color: #8b2252;">     * </span>
<span style="color: #8b2252;">     * </span><span style="color: #008b8b;">@see</span><span style="color: #8b2252;"> Filter#doFilter(ServletRequest, ServletResponse, FilterChain)</span>
<span style="color: #8b2252;">     */</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doFilter</span>(<span style="color: #228b22;">ServletRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">ServletResponse</span> <span style="color: #a0522d;">response</span>, <span style="color: #228b22;">FilterChain</span> <span style="color: #a0522d;">chain</span>) <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">IOException</span>, <span style="color: #228b22;">ServletException</span> {
        <span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">httpRequest</span> = (<span style="color: #228b22;">HttpServletRequest</span>) request;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">_const_cas_assertion_&#26159;CAS&#20013;&#23384;&#25918;&#30331;&#24405;&#29992;&#25143;&#21517;&#30340;session&#26631;&#24535;</span>
        <span style="color: #228b22;">Object</span> <span style="color: #a0522d;">object</span> = httpRequest.getSession().getAttribute(<span style="color: #8b2252;">"_const_cas_assertion_"</span>);

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#24403;&#21069;&#31995;&#32479;&#20013;&#65292;&#29992;&#25143;&#22312; SESSIOIN &#20013;&#19981;&#23384;&#22312;</span>
        <span style="color: #a020f0;">if</span> (httpRequest.getSession().getAttribute(<span style="color: #8b2252;">"SYSUSER"</span>) == <span style="color: #008b8b;">null</span>) {
            <span style="color: #228b22;">Assertion</span> <span style="color: #a0522d;">assertion</span> = (<span style="color: #228b22;">Assertion</span>) object;
            System.out.println(<span style="color: #8b2252;">"=========== Login Account : "</span> + assertion.getPrincipal().getName());
            <span style="color: #b22222;">// </span><span style="color: #b22222;">init user</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">session.addAttribute("SYSUSER", user);</span>
        }
        chain.doFilter(request, response);
    }

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">init</span>(<span style="color: #228b22;">FilterConfig</span> <span style="color: #a0522d;">fConfig</span>) <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span> {
    }

}
</pre>


</div>

</div>

<div id="outline-container-3-2-2-3" class="outline-5">
<h5 id="sec-3-2-2-3"><span class="section-number-5">3.2.2.3</span> 退出操作</h5>
<div class="outline-text-5" id="text-3-2-2-3">


<p>
退出操作，应当在一个处理类中清空 session，然后将页面重定向到 CAS 退出登录地址。如：
</p>



<pre class="example">http://192.168.0.96/cas/logout?redirect=localhost:8080/
</pre>


<p>
如果带有 redirect 参数，则再登录时会重新进入当前系统。不带有 redirect 参数则重登录时进入默认系统(EOA)
</p>
</div>
</div>

</div>

<div id="outline-container-3-2-3" class="outline-4">
<h4 id="sec-3-2-3"><span class="section-number-4">3.2.3</span> 在页面中获取用户资源</h4>
<div class="outline-text-4" id="text-3-2-3">


<p>
页面中获取用户的资源，主要通过 resource 函数来获取。
</p>
<ul>
<li>resource('CODE') 获取当前用户的编码为 "CODE" 的资源。如果当前用户不能访问该资源，返回 null
</li>
<li>resource('CODE', "mp") 获取当前用户的编码为 "CODE" 的子资源，子资源只限菜单与页面，如果当前用户不能访问子资源，返回一个长度为 0 的 list
</li>
</ul>


<p>
resource() 的第一个参数为资源编码或者资源ID，第二个参数为子资源类型。只有指定第二个参数，才查询子资源。第二个参数为标志位，含义如下：
</p>
<ul>
<li>m: 菜单
</li>
<li>p: 页面
</li>
<li>b: 按钮
</li>
<li>a: 区域
</li>
<li>r: 资源
</li>
</ul>


<p>
为方便页面使用，定义了以下 FreeMarker 宏。
</p>



<pre class="src src-html">&lt;#macro menuinternal items&gt;
  &lt;#list items as item&gt;
    &lt;#if item.page&gt;
      &lt;<span style="color: #0000ff;">li</span>&gt;&lt;<span style="color: #0000ff;">span</span>&gt;&lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">turl</span>=<span style="color: #8b2252;">"${item.url}"</span>&gt;${item.name}&lt;/<span style="color: #0000ff;">a</span>&gt;&lt;/<span style="color: #0000ff;">span</span>&gt;&lt;/<span style="color: #0000ff;">li</span>&gt;
    &lt;#elseif item.leaf&gt;
      &lt;<span style="color: #0000ff;">li</span>&gt;&lt;<span style="color: #0000ff;">span</span>&gt;${item.action}&lt;/<span style="color: #0000ff;">span</span>&gt;&lt;/<span style="color: #0000ff;">li</span>&gt;
    &lt;#else&gt;
      &lt;<span style="color: #0000ff;">li</span>&gt;&lt;<span style="color: #0000ff;">span</span>&gt;${item.name}&lt;/<span style="color: #0000ff;">span</span>&gt;
        &lt;<span style="color: #0000ff;">ul</span>&gt;
          &lt;@menuinternal item.child /&gt;
        &lt;/<span style="color: #0000ff;">ul</span>&gt;
      &lt;/<span style="color: #0000ff;">li</span>&gt;
    &lt;/#if&gt;
  &lt;/#list&gt;
&lt;/#macro&gt;

&lt;#macro menu code&gt;
  &lt;@menuinternal resource(code, <span style="color: #8b2252;">"mp"</span>) /&gt;
&lt;/#macro&gt;

&lt;#macro toolbar code&gt;
  toolbar: [&lt;#list resource(code, <span style="color: #8b2252;">"b"</span>) as item&gt;{text:'${item.name}',iconCls:'${item.icon!<span style="color: #8b2252;">""</span>}',handler:${item.action!<span style="color: #8b2252;">""</span>}}&lt;#if item_has_next&gt;,&lt;/#if&gt;&lt;/#list&gt;]
&lt;/#macro&gt;
</pre>


<p>
使用以上定义的宏，可以简化页面代码，如，菜单显示代码可以写成：
</p>



<pre class="src src-html">&lt;<span style="color: #0000ff;">ul</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"menu"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"easyui-tree"</span>&gt;
  &lt;@menu <span style="color: #8b2252;">"ROOT"</span> /&gt;
&lt;/<span style="color: #0000ff;">ul</span>&gt;
</pre>


<p>
表格(datagrid)的按钮可以写成：
</p>



<pre class="src src-js">dg.datagrid({
  url: <span style="color: #8b2252;">'user.json'</span>,
  &lt;@toolbar <span style="color: #8b2252;">"USER"</span> /&gt;
});
</pre>


</div>
</div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> JavaScript 与 jQuery</h3>
<div class="outline-text-3" id="text-3-3">


<p>
JavaScript<sup><a class="footref" name="fnr-.2" href="#fn-.2">2</a></sup> 与 jQuery<sup><a class="footref" name="fnr-.3" href="#fn-.3">3</a></sup> 是 WEB 开发的基础语言和框架。本节例举一些常见代码：
</p>

</div>

<div id="outline-container-3-3-1" class="outline-4">
<h4 id="sec-3-3-1"><span class="section-number-4">3.3.1</span> 递归一个列表</h4>
<div class="outline-text-4" id="text-3-3-1">





<pre class="src src-js">ar = [<span style="color: #8b2252;">'green'</span>, <span style="color: #8b2252;">'red'</span>, <span style="color: #8b2252;">'blue'</span>];
$.each(ar, <span style="color: #a020f0;">function</span>(<span style="color: #a0522d;">index</span>, <span style="color: #a0522d;">data</span>) {
  console.log(index, data);
});
<span style="color: #b22222;">// </span><span style="color: #b22222;">index: &#24403;&#21069;&#21015;&#34920;&#19979;&#26631;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">data : &#23545;&#24212;&#30340;&#25968;&#25454;</span>
</pre>


</div>

</div>

<div id="outline-container-3-3-2" class="outline-4">
<h4 id="sec-3-3-2"><span class="section-number-4">3.3.2</span> 使用局部变量</h4>
<div class="outline-text-4" id="text-3-3-2">





<pre class="src src-js">$(<span style="color: #a020f0;">function</span>() {
  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20197;&#19979;&#20004;&#20010;&#21464;&#37327;&#30340;&#20316;&#29992;&#22495;&#34987;&#38480;&#21046;&#22312;&#24403;&#21069;&#20989;&#25968;&#20307;&#20869;</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22806;&#37096;&#26080;&#27861;&#35775;&#38382;&#36825;&#37324;&#23450;&#20041;&#30340;&#21464;&#37327;</span>
  <span style="color: #a020f0;">var</span> <span style="color: #a0522d;">table</span> = $(<span style="color: #8b2252;">'#table'</span>);
  <span style="color: #a020f0;">var</span> <span style="color: #a0522d;">button</span> = $(<span style="color: #8b2252;">'#submit'</span>);

  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#24403;&#21069;&#20989;&#25968;&#20307;&#20869;&#65292;&#21487;&#20197;&#20351;&#29992;&#23450;&#20041;&#30340;&#21464;&#37327;</span>
  table.html(<span style="color: #8b2252;">'&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;'</span>);

  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#24403;&#21069;&#20989;&#25968;&#20307;&#30340;&#20989;&#25968;&#20869;&#65292;&#20063;&#21487;&#20197;&#20351;&#29992;&#23450;&#20041;&#30340;&#21464;&#37327;</span>
  <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">innerfunc</span>() {
    table.html(<span style="color: #8b2252;">'&lt;tr&gt;&lt;td&gt;From innerfunc&lt;/td&gt;&lt;/tr&gt;'</span>);
  }
});
</pre>


</div>

</div>

<div id="outline-container-3-3-3" class="outline-4">
<h4 id="sec-3-3-3"><span class="section-number-4">3.3.3</span> 使用闭包</h4>
<div class="outline-text-4" id="text-3-3-3">


<p>
闭包是一个包含引用环境的函数。在 JavaScript 中，可以创建一个函数，这个函数建立一个变量引用环境。如：
</p>



<pre class="src src-js"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#21019;&#24314;&#38381;&#21253;&#30340;&#20989;&#25968;</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">createClosure</span>() {
  <span style="color: #a020f0;">var</span> <span style="color: #a0522d;">inc</span> = 0;
  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36825;&#20010;&#35201;&#36820;&#22238;&#30340;&#20989;&#25968;&#23601;&#26159;&#38381;&#21253;&#65292;&#35813;&#20989;&#25968;&#24341;&#29992;&#20102;&#19968;&#20010;&#22806;&#37096;&#21464;&#37327; inc</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21363;&#21253;&#21547;&#20102;&#19968;&#20010;&#24341;&#29992;&#65292;&#20174;&#32780;&#24418;&#25104;&#19968;&#20010;&#20989;&#25968;&#29615;&#22659;</span>
  <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">function</span>() {
    <span style="color: #a020f0;">return</span> ++inc;
  }
}

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#36890;&#36807;&#20989;&#25968;&#21019;&#24314;&#38381;&#21253;</span>
<span style="color: #a020f0;">var</span> <span style="color: #a0522d;">inc</span> = createClosure();

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20351;&#29992;&#38381;&#21253;</span>
console.log(inc()); <span style="color: #b22222;">// </span><span style="color: #b22222;">1</span>
console.log(inc()); <span style="color: #b22222;">// </span><span style="color: #b22222;">2</span>
</pre>


<p>
通过以上代码，可以知道闭包的具体存在形式。以下再举一个递归的例子：
</p>



<pre class="src src-js"><span style="color: #a020f0;">function</span> <span style="color: #0000ff;">createSum</span>(<span style="color: #a0522d;">range</span>) {
  <span style="color: #a020f0;">var</span> <span style="color: #a0522d;">i</span> = 1;
  <span style="color: #a020f0;">var</span> <span style="color: #a0522d;">total</span> = 0;
  <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">function</span> sum() {
    <span style="color: #a020f0;">if</span> (i &gt; range) {
      <span style="color: #a020f0;">return</span> total;
    }
    <span style="color: #a020f0;">else</span> {
      total += i++;
      <span style="color: #a020f0;">return</span> sum();
    }
  }
}

<span style="color: #a020f0;">var</span> <span style="color: #a0522d;">sum100</span> = createSum(100);
console.log(sum100()); <span style="color: #b22222;">// </span><span style="color: #b22222;">5050</span>
<span style="color: #a020f0;">var</span> <span style="color: #a0522d;">sum36</span> = createSum(36);
console.log(sum36()); <span style="color: #b22222;">// </span><span style="color: #b22222;">666</span>
</pre>


</div>
</div>

</div>

<div id="outline-container-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> 使用 Easy UI 的开发</h3>
<div class="outline-text-3" id="text-3-4">


<p>
EasyUI<sup><a class="footref" name="fnr-.4" href="#fn-.4">4</a></sup> 是基于 jQuery<sup><a class="footref" name="fnr-.3.2" href="#fn-.3">3</a></sup> 开发的 UI 框架。EasyUI 对通用 web 组件进行了封装，开发人员可以使用少量代码就写出标准规范的界面。 目前中使用较多的是 EasyUI 的布局、提示框、弹出框、表格、树状结构等组件，以下将对这些组件进行介绍。同时，还要介绍 JavaScript 与 EasyUI 如何进行最佳实践。
</p>

</div>

<div id="outline-container-3-4-1" class="outline-4">
<h4 id="sec-3-4-1"><span class="section-number-4">3.4.1</span> html 头部</h4>
<div class="outline-text-4" id="text-3-4-1">


<p>
使用 EasyUI 需要引入依赖的 js, css，需要在 html 头部加入以下代码：
</p>



<pre class="src src-html">&lt;<span style="color: #0000ff;">link</span> <span style="color: #a0522d;">rel</span>=<span style="color: #8b2252;">"stylesheet"</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text/css"</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"css/themes/default/easyui.css"</span>/&gt;
&lt;<span style="color: #0000ff;">link</span> <span style="color: #a0522d;">rel</span>=<span style="color: #8b2252;">"stylesheet"</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text/css"</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"css/themes/icon.css"</span>/&gt;
&lt;<span style="color: #0000ff;">link</span> <span style="color: #a0522d;">rel</span>=<span style="color: #8b2252;">"stylesheet"</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text/css"</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"css/gnif.css"</span>/&gt;
&lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text/javascript"</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"js/jquery.min.js"</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text/javascript"</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"js/jquery.easyui.min.js"</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text/javascript"</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"js/locale/easyui-lang-zh_CN.js"</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text/javascript"</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"js/jquery.edatagrid.js"</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text/javascript"</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"js/gnif.js"</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
</pre>


<p>
其中，gnif.css, gnif.js 分别包含基于 gnif 框架的样式及工具类。这些样式及工具类可以为界面开发提供便利。
</p>
</div>

</div>

<div id="outline-container-3-4-2" class="outline-4">
<h4 id="sec-3-4-2"><span class="section-number-4">3.4.2</span> 布局</h4>
<div class="outline-text-4" id="text-3-4-2">


<p>
EasyUI 的布局主要通过 layout 组件来完成。layout 可以进行嵌套。在开发中，每一个 layout 都要设置 fit:true，这样可以让 layout 能够根据游览器自适应大小。为了配合布局，还使用 tab 组件。一个典型的页面布局如下：
</p>



<pre class="src src-html">&lt;<span style="color: #0000ff;">body</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"easyui-layout"</span>&gt;
  &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">data-options</span>=<span style="color: #8b2252;">"region:'north',border:false"</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">"height:30px;background:#eeeeff;"</span>&gt;
  &lt;/<span style="color: #0000ff;">div</span>&gt;
  &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">data-options</span>=<span style="color: #8b2252;">"region:'west',border:false,split:true,title:'&#25805;&#20316;&#33756;&#21333;'"</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">"width:200px;margin-left:10px;"</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"itsm-menu"</span>&gt;
    &lt;<span style="color: #0000ff;">ul</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"gnif-menu"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"easyui-tree"</span>&gt;
      &lt;<span style="color: #0000ff;">li</span>&gt;&lt;<span style="color: #0000ff;">span</span>&gt;&#25805;&#20316;&#33756;&#21333;&lt;/<span style="color: #0000ff;">span</span>&gt;
        &lt;<span style="color: #0000ff;">ul</span>&gt;
          &lt;<span style="color: #0000ff;">li</span>&gt;&lt;<span style="color: #0000ff;">span</span>&gt;&lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">turl</span>=<span style="color: #8b2252;">"main/index.html"</span>&gt;&#25805;&#20316;&#39029;&#38754;&lt;/<span style="color: #0000ff;">a</span>&gt;&lt;/<span style="color: #0000ff;">span</span>&gt;&lt;/<span style="color: #0000ff;">li</span>&gt;
        &lt;/<span style="color: #0000ff;">ul</span>&gt;
      &lt;/<span style="color: #0000ff;">li</span>&gt;
    &lt;/<span style="color: #0000ff;">ul</span>&gt;
  &lt;/<span style="color: #0000ff;">div</span>&gt;
  &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">data-options</span>=<span style="color: #8b2252;">"region:'center',border:false"</span>&gt;
    &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"gnif-tab"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"easyui-tabs"</span> <span style="color: #a0522d;">data-options</span>=<span style="color: #8b2252;">"fit:true,border:false,plain:true"</span>&gt;
      &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">title</span>=<span style="color: #8b2252;">"&#39318;&#39029;"</span> <span style="color: #a0522d;">data-options</span>=<span style="color: #8b2252;">"closable:true,fit:true"</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"common/welcome.html"</span>&gt;
        &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"easyui-layout"</span> <span style="color: #a0522d;">data-options</span>=<span style="color: #8b2252;">"fit:true"</span>&gt;
          &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">data-options</span>=<span style="color: #8b2252;">"region:'north',border:false"</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">"width:200px;padding:10px;"</span>&gt;
          &lt;/<span style="color: #0000ff;">div</span>&gt;
          &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">data-options</span>=<span style="color: #8b2252;">"region:'center',border:false"</span>&gt;
          &lt;/<span style="color: #0000ff;">div</span>&gt;
        &lt;/<span style="color: #0000ff;">div</span>&gt;
      &lt;/<span style="color: #0000ff;">div</span>&gt;
    &lt;/<span style="color: #0000ff;">div</span>&gt;
  &lt;/<span style="color: #0000ff;">div</span>&gt;
&lt;/<span style="color: #0000ff;">body</span>&gt;
</pre>


<p>
使用该布局需要注意以下几点：
</p>
<ol>
<li>gnif-menu 是基于 gnif 框架的菜单，使用该 ID 的菜单时，其中的 a 标签可以通过 turl 来指定通过 tab 打开的页面 URL 地址
</li>
<li>gnif-tab 是基于 gnif 框架的标签页，使用 gnif.opentab(title, url) 可以打开 gnif-tab 对应的标签
</li>
<li>turl 指定的页面在加载完成之后，会从 body 截取内容，不会包含页面的 head 部分。如果 tab 加载的页面需要包含其它 js/css，应当在该布局文件中将这些 js/css 包含
</li>
</ol>


</div>

</div>

<div id="outline-container-3-4-3" class="outline-4">
<h4 id="sec-3-4-3"><span class="section-number-4">3.4.3</span> 简单 CRUD 操作</h4>
<div class="outline-text-4" id="text-3-4-3">





<pre class="src src-html">&lt;<span style="color: #0000ff;">table</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"user-dg"</span>&gt;&lt;/<span style="color: #0000ff;">table</span>&gt;
&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"user-dlg"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"easyui-dialog"</span> <span style="color: #a0522d;">data-options</span>=<span style="color: #8b2252;">"closed:true"</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">"width:580px;height:480px;padding:10px;"</span>&gt;
  &lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"user-fm"</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">"post"</span>&gt;
    &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"hidden"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"id"</span>&gt;
    &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"ftitle"</span>&gt;&lt;<span style="color: #0000ff;">label</span>&gt;&#22522;&#26412;&#20449;&#24687;&lt;/<span style="color: #0000ff;">label</span>&gt;&lt;/<span style="color: #0000ff;">div</span>&gt;
    &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"fitem"</span>&gt;&lt;<span style="color: #0000ff;">label</span>&gt;&#22995;&#21517;&lt;/<span style="color: #0000ff;">label</span>&gt;&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"code"</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"easyui-validatebox"</span> <span style="color: #a0522d;">data-options</span>=<span style="color: #8b2252;">"required:true"</span> /&gt;&lt;/<span style="color: #0000ff;">div</span>&gt;
    &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"fitem"</span>&gt;&lt;<span style="color: #0000ff;">label</span>&gt;&#24615;&#21035;&lt;/<span style="color: #0000ff;">label</span>&gt;&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"gender"</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"easyui-combobox"</span> <span style="color: #a0522d;">data-options</span>=<span style="color: #8b2252;">"required:true,data:[{text:'&#30007;',value:'1'},{text:'&#22899;',value:'0'}]"</span>&gt;&lt;/<span style="color: #0000ff;">div</span>&gt;
    &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"litem"</span>&gt;&lt;<span style="color: #0000ff;">label</span>&gt;&#22320;&#22336;&lt;/<span style="color: #0000ff;">label</span>&gt;&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"address"</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"easyui-validatebox"</span> <span style="color: #a0522d;">data-options</span>=<span style="color: #8b2252;">"required:true"</span> /&gt;&lt;/<span style="color: #0000ff;">div</span>&gt;
    &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"ftitle"</span>&gt;&lt;<span style="color: #0000ff;">label</span>&gt;&#23478;&#24237;&#20449;&#24687;&lt;/<span style="color: #0000ff;">label</span>&gt;&#22312;&#32039;&#24613;&#24773;&#20917;&#19979;&#21487;&#33021;&#38656;&#35201;&#32852;&#31995;&#20146;&#20154;&lt;/<span style="color: #0000ff;">div</span>&gt;
    &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"fitem"</span>&gt;&lt;<span style="color: #0000ff;">label</span>&gt;&#32039;&#24613;&#32852;&#31995;&#20154;&lt;/<span style="color: #0000ff;">label</span>&gt;&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"contact"</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"easyui-validatebox"</span> <span style="color: #a0522d;">data-options</span>=<span style="color: #8b2252;">""</span> /&gt;&lt;/<span style="color: #0000ff;">div</span>&gt;
    &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"fitem"</span>&gt;&lt;<span style="color: #0000ff;">label</span>&gt;&#30005;&#35805;&lt;/<span style="color: #0000ff;">label</span>&gt;&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"telephone"</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"easyui-validatebox"</span> <span style="color: #a0522d;">data-options</span>=<span style="color: #8b2252;">""</span> /&gt;&lt;/<span style="color: #0000ff;">div</span>&gt;
  &lt;/<span style="color: #0000ff;">form</span>&gt;
&lt;/<span style="color: #0000ff;">div</span>&gt;

&lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text/javascript"</span>&gt;
$(function() {
  var dg = $('#user-dg');
  var dgh = gnif.create_dgh({
    en: '&#29992;&#25143;',
    dg: dg,
    fm: $('#user-fm'),
    dlg: $('#user-dlg'),
    lu: 'user/load.json',
    su: 'user/save.json'
  });

  dg.datagrid({
    url: 'app/all.json',
    fit: true,
    rownumbers: true,
    singleSelect: true,
    columns: [[
      {field:'id',checkbox:true},
      {field:'name',title:'&#22995;&#21517;'}
    ]],
    toolbar: [
      {text: '&#26032;&#22686;', handler: dgh.create},
      {text: '&#32534;&#36753;', handler: dgh.edit},
      {text: '&#21024;&#38500;', handler: dgh.remove}
    ]
  });
});  
&lt;/<span style="color: #0000ff;">script</span>&gt;
</pre>


</div>

</div>

<div id="outline-container-3-4-4" class="outline-4">
<h4 id="sec-3-4-4"><span class="section-number-4">3.4.4</span> 表单提交时 IE 提示下载</h4>
<div class="outline-text-4" id="text-3-4-4">


<p>
基于 EasyUI 的表单提交，返回数据后，在 IE 下会提示下载文件。以下是解决该问题的方案
</p>
<p>
在 Controller 当中，指定请求的地址后缀为 .html，并在响应方法上加上 @ResponseBody 标签，指示 Controller 的方法不返回视图而是返回数据对象
</p>



<pre class="src src-java"><span style="color: #008b8b;">@RequestMapping</span>(<span style="color: #8b2252;">"/save.html"</span>)
<span style="color: #008b8b;">@ResponseBody</span>
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">MessageResponse</span> <span style="color: #0000ff;">save</span>(<span style="color: #228b22;">GioneeApp</span> <span style="color: #a0522d;">gioneeApp</span>) {
    appService.save(gioneeApp);
    <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MessageResponse</span>(<span style="color: #008b8b;">MessageConstant</span>.SUCCESS);
}
</pre>


<p>
在 form submit 的 success 方法里面，使用 eval 将返回的字符串转化为 json 对象
</p>



<pre class="src src-js"><span style="color: #a020f0;">function</span> <span style="color: #0000ff;">submitform</span>() {
  $(<span style="color: #8b2252;">'#form'</span>).form(<span style="color: #8b2252;">'submit'</span>, {
    url: <span style="color: #8b2252;">'save.html'</span>,
    <span style="color: #0000ff;">success</span>: <span style="color: #a020f0;">function</span>(<span style="color: #a0522d;">data</span>) {
      data = eval(<span style="color: #8b2252;">'('</span> + data + <span style="color: #8b2252;">')'</span>);
      $.messager.alert(<span style="color: #8b2252;">'&#25552;&#31034;'</span>, data.message);
    }
  });
}
</pre>


<p>
IE 下，form 表单提交后，可以接受的响应 Content-Type 是 text/html，在 web-context.xml 指定 text/html 响应由 Json 转换器来处理即可：
</p>



<pre class="src src-xml">&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">annotation-driven</span>&gt;
  &lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">message-converters</span>&gt;
    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> Json &#36716;&#25442;&#22120;&#65292;&#23558; Controller &#23545;&#35937;&#36716;&#25442;&#20026; Json &#25968;&#25454;&#26684;&#24335; </span><span style="color: #b22222;">--&gt;</span>
    &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.http.converter.json.MappingJackson2HttpMessageConverter</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">objectMapper</span><span style="color: #8b2252;">"</span>&gt;
        &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.util.GnifObjectMapper</span><span style="color: #8b2252;">"</span> /&gt;
      &lt;/<span style="color: #0000ff;">property</span>&gt;
      &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">supportedMediaTypes</span><span style="color: #8b2252;">"</span>&gt;
        &lt;<span style="color: #0000ff;">list</span>&gt;
          <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#35774;&#32622;&#25903;&#25345;&#36820;&#22238;Content-Type&#65292;&#22914;&#26524;&#27983;&#35272;&#22120;&#35831;&#27714;&#22836;&#25351;&#23450;&#21487;&#25509;&#21463;&#30340; Content-Type &#20026;&#20197;&#19979;&#31867;&#22411;&#65292;&#21017;&#20351;&#29992;&#24403;&#21069;&#36716;&#25442;&#22120; </span><span style="color: #b22222;">--&gt;</span>
          &lt;<span style="color: #0000ff;">value</span>&gt;text/html;charset=UTF-8&lt;/<span style="color: #0000ff;">value</span>&gt;
          &lt;<span style="color: #0000ff;">value</span>&gt;application/json;charset=UTF-8&lt;/<span style="color: #0000ff;">value</span>&gt;
        &lt;/<span style="color: #0000ff;">list</span>&gt;
      &lt;/<span style="color: #0000ff;">property</span>&gt;
    &lt;/<span style="color: #0000ff;">bean</span>&gt;
  &lt;/<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">message-converters</span>&gt;
&lt;/<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">annotation-driven</span>&gt;
</pre>


</div>

</div>

<div id="outline-container-3-4-5" class="outline-4">
<h4 id="sec-3-4-5"><span class="section-number-4">3.4.5</span> 重复提交控制</h4>
<div class="outline-text-4" id="text-3-4-5">





<pre class="src src-js"><span style="color: #a020f0;">function</span> <span style="color: #0000ff;">submitform</span>() {
  $.messager.progress();
  $(<span style="color: #8b2252;">'#form'</span>).form(<span style="color: #8b2252;">'submit'</span>, {
    url: <span style="color: #8b2252;">'save.html'</span>,
    <span style="color: #0000ff;">onSubmit</span>: <span style="color: #a020f0;">function</span>() {
      <span style="color: #a020f0;">var</span> <span style="color: #a0522d;">isValid</span> = $(<span style="color: #008b8b;">this</span>).form(<span style="color: #8b2252;">'validate'</span>);
      <span style="color: #a020f0;">if</span> (!isValid) {
        $.messager.progress(<span style="color: #8b2252;">'close'</span>);
      }
      <span style="color: #a020f0;">return</span> isValid;
    },
    <span style="color: #0000ff;">success</span>: <span style="color: #a020f0;">function</span>(<span style="color: #a0522d;">data</span>) {
      $.messager.progress(<span style="color: #8b2252;">'close'</span>);
    }
  });
}
</pre>


<p>
通过 EasyUI 的 $.messager.progress() 来处理重复提交的问题。在用户点击提交之后，页面弹出进度框，用户无法做任何操作。在校验表单出错，或者提交得到响应的时候，关闭进度框。
</p>
</div>
</div>

</div>

<div id="outline-container-3-5" class="outline-3">
<h3 id="sec-3-5"><span class="section-number-3">3.5</span> 使用 FreeMarker</h3>
<div class="outline-text-3" id="text-3-5">


<p>
FreeMarker<sup><a class="footref" name="fnr-.5" href="#fn-.5">5</a></sup> 是一个模板引擎，GNIF 使用 FreeMarker 代替传统的 JSP 作为视图展示层技术。FreeMarker 相对于 JSP 而言有以下优势：
</p>
<ul>
<li>完成相同的功能，所需要的代码量减少
</li>
<li>自定义标签相对简单
</li>
<li>强制视图中不写业务逻辑代码
</li>
</ul>



</div>

<div id="outline-container-3-5-1" class="outline-4">
<h4 id="sec-3-5-1"><span class="section-number-4">3.5.1</span> 入门知识</h4>
<div class="outline-text-4" id="text-3-5-1">



</div>

<div id="outline-container-3-5-1-1" class="outline-5">
<h5 id="sec-3-5-1-1"><span class="section-number-5">3.5.1.1</span> 获取变量值</h5>
<div class="outline-text-5" id="text-3-5-1-1">





<pre class="src src-html">${user.name}
${user.age}
</pre>


</div>

</div>

<div id="outline-container-3-5-1-2" class="outline-5">
<h5 id="sec-3-5-1-2"><span class="section-number-5">3.5.1.2</span> 条件判断</h5>
<div class="outline-text-5" id="text-3-5-1-2">





<pre class="src src-html">&lt;#if test??&gt;
  test is true.
&lt;/#if&gt;

&lt;#if test??&gt;
  test is true.
&lt;#else&gt;
  test is false.
&lt;/#if&gt;

&lt;#if testa??&gt;
  testa is true.
&lt;#elseif testb??&gt;
  testb is true.
&lt;#elseif testc??&gt;
  testc is true.
&lt;#else&gt;
  all is false.
&lt;/#if&gt;
</pre>


</div>

</div>

<div id="outline-container-3-5-1-3" class="outline-5">
<h5 id="sec-3-5-1-3"><span class="section-number-5">3.5.1.3</span> 循环列表</h5>
<div class="outline-text-5" id="text-3-5-1-3">





<pre class="src src-html">&lt;#list [1,2,3,4] as x&gt;
  ${x}
&lt;/#list&gt;

&lt;#list [1,2,3,4] as x&gt;
  ${x}&lt;#if x_has_next&gt;,&lt;/#if&gt;
&lt;/#list&gt;
</pre>


</div>
</div>

</div>

<div id="outline-container-3-5-2" class="outline-4">
<h4 id="sec-3-5-2"><span class="section-number-4">3.5.2</span> 常见用法</h4>
<div class="outline-text-4" id="text-3-5-2">



</div>

<div id="outline-container-3-5-2-1" class="outline-5">
<h5 id="sec-3-5-2-1"><span class="section-number-5">3.5.2.1</span> 获取 Request 参数</h5>
<div class="outline-text-5" id="text-3-5-2-1">





<pre class="src src-html">&#33719;&#21462;&#21517;&#31216;&#20026; name &#30340; Request &#21442;&#25968;&#65306;${RequestParameters.name}
</pre>


</div>

</div>

<div id="outline-container-3-5-2-2" class="outline-5">
<h5 id="sec-3-5-2-2"><span class="section-number-5">3.5.2.2</span> 处理 null 值</h5>
<div class="outline-text-5" id="text-3-5-2-2">


<p>
如果使用 FreeMarker 处理的值为 null，FreeMarker 会抛出异常。可以通过以下方式来处理 null 值。
</p>



<pre class="src src-html">! &#26159;&#40664;&#35748;&#20540;&#25805;&#20316;&#31526;
${value!<span style="color: #8b2252;">"&#22914;&#26524;&#20026;null&#65292;&#21017;&#20351;&#29992;&#40664;&#35748;&#20540;"</span>}

?? &#27979;&#35797;&#20540;&#26159;&#21542;&#23384;&#22312;&#65288;&#26159;&#21542;&#20026; null&#65289;
&lt;#if value??&gt;
  Value: ${value}
&lt;#else&gt;
  Value not found.
&lt;/#if&gt;
</pre>


</div>

</div>

<div id="outline-container-3-5-2-3" class="outline-5">
<h5 id="sec-3-5-2-3"><span class="section-number-5">3.5.2.3</span> 判断是否为空(null,empty)</h5>
<div class="outline-text-5" id="text-3-5-2-3">





<pre class="src src-html">&lt;#if value?has_content&gt;
  Value: ${value}
&lt;#else&gt;
  Value is empty
&lt;/#if&gt;
</pre>


<p>
判断是否为空时，会检查 null，并且检查 length/size 是否为 0
</p>
</div>

</div>

<div id="outline-container-3-5-2-4" class="outline-5">
<h5 id="sec-3-5-2-4"><span class="section-number-5">3.5.2.4</span> 自定义宏（标签）</h5>
<div class="outline-text-5" id="text-3-5-2-4">





<pre class="src src-html">&#23450;&#20041;&#23439;
&lt;#macro button id name&gt;
&lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"${id}"</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"#"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"easyui-linkbutton"</span>&gt;${name}&lt;/<span style="color: #0000ff;">a</span>&gt;
&lt;/#macro&gt;

&#20351;&#29992;&#23439;
&lt;@button <span style="color: #8b2252;">"id"</span> <span style="color: #8b2252;">"&#27979;&#35797;&#25353;&#38062;"</span> /&gt;
</pre>


</div>
</div>
</div>

</div>

<div id="outline-container-3-6" class="outline-3">
<h3 id="sec-3-6"><span class="section-number-3">3.6</span> Java代码</h3>
<div class="outline-text-3" id="text-3-6">


<p>
WEB 展现层的代码都放在 com.gionee.projectname.web 包下。该包有以下目录：
</p>
<ul>
<li>controller 控制器。具体职责包括：
<ol>
<li>接收浏览器提交的数据
</li>
<li>将数据进行输入与输出的转换
</li>
<li>调用服务层代码进行业务逻辑操作
</li>
<li>将数据汇集传给视图进行展示
</li>
<li>将数据汇集直接返回给浏览器
</li>
</ol>

</li>
<li>response 响应类。将模型数据(model)包装为响应类以 json 的形式返回给浏览器。这样做的原因：
<ol>
<li>只将页面需要的数据返回给客户端，减少传输的数据量
</li>
<li>不将 model 完整地在前端暴露，保持安全可控
</li>
<li>model 可以写更加复杂的业务逻辑代码，不限于简单的 get/set 方法，增强代码的灵活性
</li>
</ol>

</li>
<li>util 工具类。将通用数据转换、数据处理的功能放在这个包里面，在 controller 里面可以共用这部分代码
</li>
<li>interceptor 拦截器。可以在 controller 处理之前，之后加上拦截器代码
</li>
</ul>



</div>

<div id="outline-container-3-6-1" class="outline-4">
<h4 id="sec-3-6-1"><span class="section-number-4">3.6.1</span> Controller 控制器</h4>
<div class="outline-text-4" id="text-3-6-1">



</div>

<div id="outline-container-3-6-1-1" class="outline-5">
<h5 id="sec-3-6-1-1"><span class="section-number-5">3.6.1.1</span> 默认地址映射</h5>
<div class="outline-text-5" id="text-3-6-1-1">


<p>
在一个项目中，并不是所有的页面都需要通过业务操作取出数据之后再将页面展现给客户端。如，登录页面，用户表单提交页面等，都是作为一个数据录入页面将需要用户填写的数据展现给用户，并不需要通过业务操作(访问应用层)取出数据放到页面展示。这种情况下，可以使用页面转发控制器将页面直接转发到视图。在项目原型阶段，这种没有在业务逻辑处理之后展现的页面更多。
</p>
<p>
基于 GNIF 框架的 Controller，默认由 ParameterizableViewController 直接将对应的 URL 映射到 URL 所对应的视图。使用 ParameterizableViewController 转发视图的配置可以自定义：
</p>



<pre class="src src-xml"><span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#35774;&#32622;&#36716;&#21457;Controller &#22788;&#29702;&#30340; URL&#12290;&#22914;&#26524;&#19968;&#20010; URL &#27809;&#26377;&#25214;&#21040;&#23545;&#24212;&#30340; Controller &#22788;&#29702;&#65292;&#21017;&#30001;&#36716;&#21457; Controller &#30452;&#25509;&#21462; URL &#23545;&#24212;&#30340;&#35270;&#22270;&#36820;&#22238;&#32473;&#27983;&#35272;&#22120; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">view-controller</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">view-name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">home</span><span style="color: #8b2252;">"</span> /&gt;
&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">view-controller</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/index.html</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">view-name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">index</span><span style="color: #8b2252;">"</span> /&gt;
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377;&#35774;&#32622; view-name&#65292;&#21017;&#20351;&#29992;&#40664;&#35748; URL-&#35270;&#22270; &#26144;&#23556;&#26041;&#24335;&#25214;&#21040;&#35270;&#22270; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">view-controller</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/**/*.html</span><span style="color: #8b2252;">"</span> /&gt;
</pre>


<p>
默认的视图映射方式由以下代码来确定，可以通过代码查看工具查看实现细节：
</p>



<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">DispatcherServlet</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">FrameworkServlet</span> {

    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">applyDefaultViewName</span>(<span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">ModelAndView</span> <span style="color: #a0522d;">mv</span>) <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> {
        <span style="color: #a020f0;">if</span> (mv != <span style="color: #008b8b;">null</span> &amp;&amp; !mv.hasView()) {
            mv.setViewName(getDefaultViewName(request));
        }
    }

    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">getDefaultViewName</span>(<span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">request</span>) <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> {
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">this</span>.viewNameTranslator.getViewName(request);
    }

}
</pre>


<p>
默认的视图映射方式，实际上就是将请求的 URL 的后缀去掉，得到视图名称。
</p>
</div>

</div>

<div id="outline-container-3-6-1-2" class="outline-5">
<h5 id="sec-3-6-1-2"><span class="section-number-5">3.6.1.2</span> 自定义地址映射</h5>
<div class="outline-text-5" id="text-3-6-1-2">


<p>
如果一个视图需要进行业务处理之后再返回数据给客户端浏览器，基于 GNIF 框架的做法如下：
</p>



<pre class="src src-java"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#29992; RequestMapping &#25351;&#23450;&#38656;&#35201;&#22788;&#29702;&#30340; URL &#22320;&#22336;</span>
<span style="color: #008b8b;">@RequestMapping</span>(<span style="color: #8b2252;">"/app"</span>)
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#25351;&#23450;&#35813;&#31867;&#26159;&#19968;&#20010; Controller&#65292;spring &#25195;&#25551;&#21040; Controller &#27880;&#35299;&#21518;&#20250;&#23558; Controller &#21152;&#20837;&#21040; spring &#23481;&#22120;&#20013;&#21435;</span>
<span style="color: #008b8b;">@Controller</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">GioneeAppController</span> {
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27880;&#20837;&#26381;&#21153;&#65292;Controller &#36890;&#36807;&#35843;&#29992;&#26381;&#21153;&#23436;&#25104;&#19994;&#21153;&#25805;&#20316;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Controller &#33258;&#36523;&#19981;&#20570;&#19994;&#21153;&#25805;&#20316;</span>
    <span style="color: #008b8b;">@Autowired</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">GioneeAppService</span> <span style="color: #a0522d;">appService</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25351;&#23450;&#31532;&#20108;&#32423; URL &#22320;&#22336;&#65292;&#35813;&#32423;&#22320;&#22336;&#19982;&#31532;&#19968;&#32423; URL &#22320;&#22336;&#26500;&#25104;&#23436;&#25972;&#30340;&#19994;&#21153;&#21709;&#24212;&#22320;&#22336;&#12290;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#24403;&#21069;&#21709;&#24212;&#22320;&#22336;&#20026; /app/save.html&#65292;&#22914;&#26524;&#23458;&#25143;&#31471;&#21457;&#36215;&#19968;&#20010;&#35831;&#27714;&#20026;&#35813;&#22320;&#22336;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21017;&#30001; save &#26041;&#27861;&#36827;&#34892;&#21709;&#24212;</span>
    <span style="color: #008b8b;">@RequestMapping</span>(<span style="color: #8b2252;">"/save.html"</span>)
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20351;&#29992; ResponseBody &#25351;&#23450;&#36820;&#22238;&#30340;&#25968;&#25454;&#19981;&#30001;&#35270;&#22270;&#22788;&#29702;&#22120;&#36827;&#34892;&#28210;&#26579;&#65292;&#32780;&#30001;&#28040;&#24687;&#36716;&#25442;&#22120;&#23558;&#25968;&#25454;&#20316;&#20026;&#28040;&#24687;&#36820;&#22238;&#32473;&#23458;&#25143;&#31471;</span>
    <span style="color: #008b8b;">@ResponseBody</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">MessageResponse</span> <span style="color: #0000ff;">save</span>(<span style="color: #228b22;">GioneeApp</span> <span style="color: #a0522d;">gioneeApp</span>, <span style="color: #228b22;">DbConfig</span> <span style="color: #a0522d;">dbConfig</span>) {
        <span style="color: #a020f0;">if</span> (dbConfig.isValid()) {
            gioneeApp.setDbInfo(dbConfig.getEncrypt());
        }
        appService.save(gioneeApp);
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MessageResponse</span>(<span style="color: #008b8b;">MessageConstant</span>.SUCCESS);
    }

    <span style="color: #008b8b;">@RequestMapping</span>(<span style="color: #8b2252;">"/list.html"</span>)
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377; ResponseBody&#65292;&#21017;&#30001;&#35270;&#22270;&#23545;&#25968;&#25454;&#36827;&#34892;&#28210;&#26579;&#12290;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#23558;&#25968;&#25454;&#25918;&#20837;&#21040; model &#24403;&#20013;&#65292;&#22312;&#35270;&#22270;&#20013;&#21487;&#20197;&#36890;&#36807; model &#21462;&#21040;&#25968;&#25454;&#36827;&#34892;&#23637;&#29616;</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">list</span>(<span style="color: #228b22;">Model</span> <span style="color: #a0522d;">model</span>) {
        model.addAttribute(<span style="color: #8b2252;">"apps"</span>, appService.getAll());
    }
}
</pre>


</div>

</div>

<div id="outline-container-3-6-1-3" class="outline-5">
<h5 id="sec-3-6-1-3"><span class="section-number-5">3.6.1.3</span> 接收客户端提交参数</h5>
<div class="outline-text-5" id="text-3-6-1-3">


<p>
在 Controller 中的处理方法中可以指定各种类型的参数类型。部分参数类型具有特殊含义：
</p>
<ul>
<li>Model 用于存放 model，在视图中可以获取该对象当中的值
</li>
<li>QueryMap 用于存放查询条件，查询条件已经完成了数值类型转换
</li>
<li>HttpServletRequest/HttpServletResponse 访问Servlet中的 request/response
</li>
</ul>


<p>
可以在 <a href="http://docs.spring.io/spring/docs/3.2.6.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-methods">Spring Controller</a> 中查看完整的预定义参数类型。
</p>
<p>
除了预定义参数类型，可以在 Controller 通过参数将对象初始化。以下为一个 form 表单：
</p>



<pre class="src src-html">&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">"post"</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">"handle.html"</span> <span style="color: #a0522d;">enctype</span>=<span style="color: #8b2252;">"multipart/form-data"</span>&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"hidden"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"name"</span> /&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"hidden"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"age"</span> /&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"hidden"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"address[0].name"</span> /&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"hidden"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"address[1].name"</span> /&gt; <span style="color: #b22222;">&lt;!-- </span><span style="color: #b22222;">&#22810;&#20010;&#23376;&#23545;&#35937; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"file"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"avatar"</span> /&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"file"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"pic[0]"</span> /&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"file"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"pic[1]"</span> /&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"file"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"pic[2]"</span> /&gt;  <span style="color: #b22222;">&lt;!-- </span><span style="color: #b22222;">&#22810;&#20010;&#25991;&#20214;&#20197; List &#30340;&#24418;&#24335;&#19978;&#20256; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"file"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"files"</span> /&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"file"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"files"</span> /&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"file"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"files"</span> /&gt;  <span style="color: #b22222;">&lt;!-- </span><span style="color: #b22222;">&#22810;&#20010;&#25991;&#20214;&#19978;&#20256; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"hidden"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"friends"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"1,2,3,4"</span> /&gt; <span style="color: #b22222;">&lt;!-- </span><span style="color: #b22222;">&#25972;&#24418;&#25968;&#32452; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"submit"</span> /&gt;
&lt;/<span style="color: #0000ff;">form</span>&gt;
</pre>


<p>
Java 代码如下：
</p>



<pre class="src src-java"><span style="color: #008b8b;">@Controller</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">HandleController</span> {

    <span style="color: #008b8b;">@RequestMapping</span>(<span style="color: #8b2252;">"/handle.html"</span>)
    <span style="color: #008b8b;">@ResponseBody</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">handle</span>(<span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span>, <span style="color: #008b8b;">@RequestParam</span>(<span style="color: #8b2252;">"files"</span>) <span style="color: #228b22;">MultipartFile</span>[] <span style="color: #a0522d;">files</span>) {
        System.out.println(user);
        System.out.println(files);
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"Hello"</span>;
    }

}

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">User</span> {
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">age</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">List</span>&lt;Address&gt; address = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ArrayList</span>&lt;Address&gt;(); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25509;&#25910;</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">MultipartFile</span> <span style="color: #a0522d;">avater</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25509;&#25910;&#21333;&#20010;&#25991;&#20214;</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">List</span>&lt;MultipartFile&gt; pic = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ArrayList</span>&lt;MultipartFile&gt;(); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25509;&#25910;&#25991;&#20214;&#21015;&#34920;</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">Integer</span>[] <span style="color: #a0522d;">friends</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25509;&#25910;&#25968;&#32452;&#21442;&#25968;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">getter and setter's</span>
}

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Address</span> {
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span>;
    <span style="color: #b22222;">// </span><span style="color: #b22222;">getter and setter's</span>
}
</pre>


</div>

</div>

<div id="outline-container-3-6-1-4" class="outline-5">
<h5 id="sec-3-6-1-4"><span class="section-number-5">3.6.1.4</span> 查询数据</h5>
<div class="outline-text-5" id="text-3-6-1-4">


<p>
通过 QueryMap 可以接收用于查询的数据。 QueryMap 做了以下事情：
</p>
<ul>
<li>根据提交数据的后缀，对数据类型进行转换：
<ul>
<li>_s: String
</li>
<li>_i: Integer
</li>
<li>_f: Double
</li>
<li>_d: Date 提交的时间格式为 yyyy-MM-dd
</li>
<li>_da: Date 时分秒为 00:00:00
</li>
<li>_db: Date 时分秒为 23:59:59
</li>
<li>_t: Date 提交的时间格式为 yyyy-MM-dd HH:mm:ss
</li>
</ul>

</li>
<li>设置分页变量
<ul>
<li>firstResult 起始结果集 // 用于 mysql, postgresql, h2 等使用 limit 的数据源
</li>
<li>maxResults 每页条数
</li>
<li>firstRow 第一条记录 // 用于 oracle, db2, mssql 等使用 rownumber() 的数据源
</li>
<li>lastRow 最后一条记录
</li>
<li>pageRow 每页条数 // 第一版兼容变量
</li>
<li>rowFrom 起始行
</li>
<li>rowTo 结束行
</li>
</ul>

</li>
</ul>


<p>
页面提交的查询条件代码如下：
</p>



<pre class="src src-html">&lt;<span style="color: #0000ff;">form</span>&gt;
  &#22995;&#21517;&#65306;&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"name_s"</span> /&gt;
  &#24180;&#40836;&#65306;&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"age_i"</span> /&gt;
  &#20986;&#29983;&#26102;&#38388;&#65306;&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"borthday_d"</span> /&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"button"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"&#26597;&#35810;"</span> /&gt;
&lt;/<span style="color: #0000ff;">form</span>&gt;
</pre>


<p>
数据库查询时，将类型后缀去掉。数据库查询代码如下：
</p>



<pre class="src src-xml">&lt;<span style="color: #0000ff;">select</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">getAll</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">parameterType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">Map</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">resultMap</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">result</span><span style="color: #8b2252;">"</span>&gt;
  select name, account, borthday from user
  &lt;<span style="color: #0000ff;">where</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">name != null</span><span style="color: #8b2252;">"</span>&gt;
      and name like '%' + #{name} + '%'
    &lt;/<span style="color: #0000ff;">if</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">age != null</span><span style="color: #8b2252;">"</span>&gt;
      and age = #{age}
    &lt;/<span style="color: #0000ff;">if</span>&gt;
  &lt;/<span style="color: #0000ff;">where</span>&gt;
&lt;/<span style="color: #0000ff;">select</span>&gt;
</pre>


</div>

</div>

<div id="outline-container-3-6-1-5" class="outline-5">
<h5 id="sec-3-6-1-5"><span class="section-number-5">3.6.1.5</span> 文件上传</h5>
<div class="outline-text-5" id="text-3-6-1-5">


<p>
文件上传时，需要指定表单的类型为：multipart/form-data
</p>



<pre class="src src-html">&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">"post"</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">"handle.html"</span> <span style="color: #a0522d;">enctype</span>=<span style="color: #8b2252;">"multipart/form-data"</span>&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"file"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"avatar"</span> /&gt;
&lt;/<span style="color: #0000ff;">form</span>&gt;
</pre>


<p>
在 Controller 中，如果需要在处理方法参数中直接获取文件数组，需要加上 @RequestParam 标签：
</p>



<pre class="src src-java"><span style="color: #008b8b;">@Controller</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">HandleController</span> {

    <span style="color: #008b8b;">@RequestMapping</span>(<span style="color: #8b2252;">"/handle_array.html"</span>)
    <span style="color: #008b8b;">@ResponseBody</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">handleArray</span>(<span style="color: #008b8b;">@RequestParam</span>(<span style="color: #8b2252;">"avatar"</span>) <span style="color: #228b22;">MultipartFile</span>[] <span style="color: #a0522d;">avatar</span>) {
        System.out.println(avatar);
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"Hello"</span>;
    }

    <span style="color: #008b8b;">@RequestMapping</span>(<span style="color: #8b2252;">"/handle_single.html"</span>)
    <span style="color: #008b8b;">@ResponseBody</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">handleSingle</span>(<span style="color: #228b22;">MultipartFile</span> <span style="color: #a0522d;">avatar</span>) {
        System.out.println(avatar);
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"Hello"</span>;
    }

}
</pre>


</div>
</div>
</div>

</div>

<div id="outline-container-3-7" class="outline-3">
<h3 id="sec-3-7"><span class="section-number-3">3.7</span> 配置文件</h3>
<div class="outline-text-3" id="text-3-7">


<p>
WEB 层的配置文件集中于 web-context.xml 中。在 web.xml 中配置 DispatcherServlet 时，指定该 DispatcherServlet 所读取的配置文件。
</p>
<p>
web.xml
</p>



<pre class="src src-xml">&lt;?<span style="color: #a020f0;">xml</span> <span style="color: #a0522d;">version</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">1.0</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">encoding</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">ISO-8859-1</span><span style="color: #8b2252;">"</span>?&gt;

&lt;<span style="color: #0000ff;">web-app</span> <span style="color: #483d8b;">xmlns</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://java.sun.com/xml/ns/javaee</span><span style="color: #8b2252;">"</span>
         <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">xsi</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.w3.org/2001/XMLSchema-instance</span><span style="color: #8b2252;">"</span>
         <span style="color: #483d8b;">xsi</span>:<span style="color: #a0522d;">schemaLocation</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd</span><span style="color: #8b2252;">"</span>
         <span style="color: #a0522d;">version</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">2.5</span><span style="color: #8b2252;">"</span>&gt; 

  &lt;<span style="color: #0000ff;">servlet</span>&gt;
    &lt;<span style="color: #0000ff;">servlet-name</span>&gt;spring&lt;/<span style="color: #0000ff;">servlet-name</span>&gt;
    &lt;<span style="color: #0000ff;">servlet-class</span>&gt;org.springframework.web.servlet.DispatcherServlet&lt;/<span style="color: #0000ff;">servlet-class</span>&gt;
    &lt;<span style="color: #0000ff;">init-param</span>&gt;
      &lt;<span style="color: #0000ff;">param-name</span>&gt;contextConfigLocation&lt;/<span style="color: #0000ff;">param-name</span>&gt;
      <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25351;&#23450; DispatcherServlet &#25152;&#35835;&#21462;&#30340;&#37197;&#32622;&#25991;&#20214; </span><span style="color: #b22222;">--&gt;</span>
      &lt;<span style="color: #0000ff;">param-value</span>&gt;/WEB-INF/web-context.xml&lt;/<span style="color: #0000ff;">param-value</span>&gt;
    &lt;/<span style="color: #0000ff;">init-param</span>&gt;
    &lt;<span style="color: #0000ff;">load-on-startup</span>&gt;1&lt;/<span style="color: #0000ff;">load-on-startup</span>&gt;
  &lt;/<span style="color: #0000ff;">servlet</span>&gt;

  &lt;<span style="color: #0000ff;">servlet-mapping</span>&gt;
    &lt;<span style="color: #0000ff;">servlet-name</span>&gt;spring&lt;/<span style="color: #0000ff;">servlet-name</span>&gt;
    &lt;<span style="color: #0000ff;">url-pattern</span>&gt;*.json&lt;/<span style="color: #0000ff;">url-pattern</span>&gt;
  &lt;/<span style="color: #0000ff;">servlet-mapping</span>&gt;

  &lt;<span style="color: #0000ff;">servlet-mapping</span>&gt;
    &lt;<span style="color: #0000ff;">servlet-name</span>&gt;spring&lt;/<span style="color: #0000ff;">servlet-name</span>&gt;
    &lt;<span style="color: #0000ff;">url-pattern</span>&gt;*.html&lt;/<span style="color: #0000ff;">url-pattern</span>&gt;
  &lt;/<span style="color: #0000ff;">servlet-mapping</span>&gt;

&lt;/<span style="color: #0000ff;">web-app</span>&gt;
</pre>


<p>
web-context.xml
</p>



<pre class="src src-xml">&lt;?<span style="color: #a020f0;">xml</span> <span style="color: #a0522d;">version</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">1.0</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">encoding</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">UTF-8</span><span style="color: #8b2252;">"</span>?&gt;
&lt;<span style="color: #0000ff;">beans</span> <span style="color: #483d8b;">xmlns</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.springframework.org/schema/beans</span><span style="color: #8b2252;">"</span>
       <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">xsi</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.w3.org/2001/XMLSchema-instance</span><span style="color: #8b2252;">"</span>
       <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">context</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.springframework.org/schema/context</span><span style="color: #8b2252;">"</span>
       <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">mvc</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.springframework.org/schema/mvc</span><span style="color: #8b2252;">"</span>
       <span style="color: #483d8b;">xsi</span>:<span style="color: #a0522d;">schemaLocation</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.springframework.org/schema/beans</span>
<span style="color: #8b2252;">              http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span style="color: #8b2252;">              http://www.springframework.org/schema/context</span>
<span style="color: #8b2252;">              http://www.springframework.org/schema/context/spring-context.xsd</span>
<span style="color: #8b2252;">              http://www.springframework.org/schema/mvc</span>
<span style="color: #8b2252;">              http://www.springframework.org/schema/mvc/spring-mvc.xsd</span><span style="color: #8b2252;">"</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#35774;&#32622;&#23646;&#24615;&#26367;&#25442;&#25991;&#20214; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">context</span>:<span style="color: #0000ff;">property-placeholder</span> <span style="color: #a0522d;">location</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">classpath:app.properties</span><span style="color: #8b2252;">"</span>/&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#35774;&#32622; web &#23618;&#21152;&#36733;&#30340; controller </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">context</span>:<span style="color: #0000ff;">component-scan</span> <span style="color: #a0522d;">base-package</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.dev.web.controller</span><span style="color: #8b2252;">"</span>/&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#36716;&#25442;&#22120;&#65292;&#29992;&#20110;&#36716;&#25442;&#39029;&#38754;&#25552;&#20132;&#30340;&#25968;&#25454;&#21040;&#24212;&#29992;&#65292;&#25110;&#32773;&#23558;&#24212;&#29992;&#30340;&#25968;&#25454;&#36716;&#25442;&#20026;&#39029;&#38754;&#21487;&#25509;&#21463;&#30340;&#25968;&#25454;&#26684;&#24335; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">annotation-driven</span> <span style="color: #a0522d;">conversion-service</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">conversionService</span><span style="color: #8b2252;">"</span>&gt;
    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25968;&#25454;&#26597;&#35810;&#36716;&#31227;&#22120;&#65292;&#29992;&#20110;&#26597;&#35810;&#26465;&#20214;&#30340;&#25968;&#25454;&#36716;&#25442; </span><span style="color: #b22222;">--&gt;</span>
    &lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">argument-resolvers</span>&gt;
      &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.web.util.QueryMapArgumentResolver</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;/<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">argument-resolvers</span>&gt;
    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#28040;&#24687;&#36716;&#25442;&#22120;&#65292;&#29992;&#20110;&#23558;&#36820;&#22238;&#23545;&#35937;&#36716;&#25442;&#20026;&#27983;&#35272;&#22120;&#21487;&#20197;&#35782;&#21035;&#30340;&#26684;&#24335; </span><span style="color: #b22222;">--&gt;</span>
    &lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">message-converters</span>&gt;
      <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> Json &#36716;&#25442;&#22120;&#65292;&#23558; Controller &#23545;&#35937;&#36716;&#25442;&#20026; Json &#25968;&#25454;&#26684;&#24335; </span><span style="color: #b22222;">--&gt;</span>
      &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.http.converter.json.MappingJackson2HttpMessageConverter</span><span style="color: #8b2252;">"</span>&gt;
        &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">objectMapper</span><span style="color: #8b2252;">"</span>&gt;
          &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.util.GnifObjectMapper</span><span style="color: #8b2252;">"</span> /&gt;
        &lt;/<span style="color: #0000ff;">property</span>&gt;
        &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">supportedMediaTypes</span><span style="color: #8b2252;">"</span>&gt;
          &lt;<span style="color: #0000ff;">list</span>&gt;
            <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#35774;&#32622;&#25903;&#25345;&#36820;&#22238;Content-Type&#65292;&#22914;&#26524;&#27983;&#35272;&#22120;&#35831;&#27714;&#22836;&#25351;&#23450;&#21487;&#25509;&#21463;&#30340; Content-Type &#20026;&#20197;&#19979;&#31867;&#22411;&#65292;&#21017;&#20351;&#29992;&#24403;&#21069;&#36716;&#25442;&#22120; </span><span style="color: #b22222;">--&gt;</span>
            &lt;<span style="color: #0000ff;">value</span>&gt;text/html;charset=UTF-8&lt;/<span style="color: #0000ff;">value</span>&gt;
            &lt;<span style="color: #0000ff;">value</span>&gt;application/json;charset=UTF-8&lt;/<span style="color: #0000ff;">value</span>&gt;
          &lt;/<span style="color: #0000ff;">list</span>&gt;
        &lt;/<span style="color: #0000ff;">property</span>&gt;
      &lt;/<span style="color: #0000ff;">bean</span>&gt;
    &lt;/<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">message-converters</span>&gt;
  &lt;/<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">annotation-driven</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#36716;&#25442;&#22120;&#65292;&#29992;&#20110;&#23558;&#39029;&#38754;&#25552;&#20132;&#30340;&#25968;&#25454;&#36716;&#25442;&#20026;&#23545;&#35937; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">conversionService</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.format.support.FormattingConversionServiceFactoryBean</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">registerDefaultFormatters</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">false</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">converters</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #0000ff;">set</span>&gt;
        <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#23558;&#39029;&#38754;&#25552;&#20132;&#30340;String&#36716;&#25442;&#20026;Date </span><span style="color: #b22222;">--&gt;</span>
        &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.util.StringToDate</span><span style="color: #8b2252;">"</span>/&gt;
      &lt;/<span style="color: #0000ff;">set</span>&gt;
    &lt;/<span style="color: #0000ff;">property</span>&gt;
  &lt;/<span style="color: #0000ff;">bean</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#35774;&#32622;&#36716;&#21457;Controller &#22788;&#29702;&#30340; URL&#12290;&#22914;&#26524;&#19968;&#20010; URL &#27809;&#26377;&#25214;&#21040;&#23545;&#24212;&#30340; Controller &#22788;&#29702;&#65292;&#21017;&#30001;&#36716;&#21457; Controller &#30452;&#25509;&#21462; URL &#23545;&#24212;&#30340;&#35270;&#22270;&#36820;&#22238;&#32473;&#27983;&#35272;&#22120; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">view-controller</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/**/*.html</span><span style="color: #8b2252;">"</span> /&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25318;&#25130;&#22120; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">interceptors</span>&gt;
    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#35775;&#38382;&#26085;&#24535;&#25318;&#25130;&#22120;&#65292;&#35760;&#24405;&#27983;&#35272;&#22120;&#35831;&#27714;&#30340; URL &#22320;&#22336;&#65292;&#23545;&#24212;&#30340;&#22788;&#29702;&#31867;&#65292;&#36820;&#22238;&#30340;&#35270;&#22270;&#21517; </span><span style="color: #b22222;">--&gt;</span>
    &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.web.interceptor.AccessLogInterceptor</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">interceptors</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25991;&#20214;&#19978;&#20256;&#35774;&#32622; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">multipartResolver</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.web.multipart.commons.CommonsMultipartResolver</span><span style="color: #8b2252;">"</span>&gt;
    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25991;&#20214;&#22823;&#23567;&#65292;&#21333;&#20301;&#65306;bytes </span><span style="color: #b22222;">--&gt;</span>
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">maxUploadSize</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">10000000</span><span style="color: #8b2252;">"</span>/&gt;
  &lt;/<span style="color: #0000ff;">bean</span>&gt;

  <span style="color: #b22222;">&lt;!--</span>
<span style="color: #b22222;">      &#35270;&#22270;&#22788;&#29702;&#22120;&#65292;&#22312;&#27809;&#26377; @ResponseBody &#30340;&#26102;&#20505;&#65292;&#30001;&#35813;&#31867;&#22788;&#29702;&#36820;&#22238;&#25968;&#25454;</span>
<span style="color: #b22222;">      &#35270;&#22270;&#22788;&#29702;&#22120;&#20250;&#26681;&#25454; Content-Type &#36873;&#25321;&#26368;&#20339;&#35270;&#22270;&#36820;&#22238;&#32473;&#27983;&#35272;&#22120;</span>
<span style="color: #b22222;">  </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.web.servlet.view.ContentNegotiatingViewResolver</span><span style="color: #8b2252;">"</span>&gt;
    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#26681;&#25454;&#27983;&#35272;&#22120;&#25552;&#20132;&#30340;&#25193;&#23637;&#21517;&#26469;&#20915;&#23450;&#36820;&#22238;&#30340; Content-Type </span><span style="color: #b22222;">--&gt;</span>
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">mediaTypes</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #0000ff;">map</span>&gt;
        &lt;<span style="color: #0000ff;">entry</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">atom</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">application/atom+xml</span><span style="color: #8b2252;">"</span>/&gt;
        &lt;<span style="color: #0000ff;">entry</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">html</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">text/html</span><span style="color: #8b2252;">"</span>/&gt;
        &lt;<span style="color: #0000ff;">entry</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">json</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">application/json</span><span style="color: #8b2252;">"</span>/&gt;
      &lt;/<span style="color: #0000ff;">map</span>&gt;
    &lt;/<span style="color: #0000ff;">property</span>&gt;
    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#35270;&#22270;&#22788;&#29702;&#22120;&#65292;&#29992;&#20110;&#29983;&#25104;&#20505;&#36873;&#35270;&#22270; </span><span style="color: #b22222;">--&gt;</span>
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">viewResolvers</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #0000ff;">list</span>&gt;
        &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.web.servlet.view.BeanNameViewResolver</span><span style="color: #8b2252;">"</span>/&gt;
        &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver</span><span style="color: #8b2252;">"</span>&gt;
          <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;">property name="cache" value="true"/</span><span style="color: #b22222;">--&gt;</span>
          &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">prefix</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">"</span>/&gt;
          &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">suffix</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">.html</span><span style="color: #8b2252;">"</span>/&gt;
          &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">contentType</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">text/html;charset=UTF-8</span><span style="color: #8b2252;">"</span>/&gt;
          &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">requestContextAttribute</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">request</span><span style="color: #8b2252;">"</span>/&gt;
          &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">viewClass</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.web.view.GnifFreeMarkerView</span><span style="color: #8b2252;">"</span>/&gt;
        &lt;/<span style="color: #0000ff;">bean</span>&gt;
      &lt;/<span style="color: #0000ff;">list</span>&gt;
    &lt;/<span style="color: #0000ff;">property</span>&gt;
    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#40664;&#35748;&#35270;&#22270;&#65292;&#23646;&#20110;&#20505;&#36873;&#35270;&#22270; </span><span style="color: #b22222;">--&gt;</span>
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">defaultViews</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #0000ff;">list</span>&gt;
        &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.web.servlet.view.json.MappingJackson2JsonView</span><span style="color: #8b2252;">"</span> /&gt;
      &lt;/<span style="color: #0000ff;">list</span>&gt;
    &lt;/<span style="color: #0000ff;">property</span>&gt;
  &lt;/<span style="color: #0000ff;">bean</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> FreeMarker &#35270;&#22270;&#22788;&#29702;&#22120;&#37197;&#32622; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">freemarkerConfig</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">templateLoaderPath</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/WEB-INF/view/</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">defaultEncoding</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">UTF-8</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">freemarkerVariables</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #0000ff;">map</span>&gt;
        &lt;<span style="color: #0000ff;">entry</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">resource</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value-ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">ftlResource</span><span style="color: #8b2252;">"</span>/&gt;
      &lt;/<span style="color: #0000ff;">map</span>&gt;
    &lt;/<span style="color: #0000ff;">property</span>&gt;
  &lt;/<span style="color: #0000ff;">bean</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#29992;&#20110;&#33719;&#21462;&#29992;&#25143;&#36164;&#28304;&#30340; FreeMarker &#20989;&#25968; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">ftlResource</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.auth.freemarker.ResourceFunction</span><span style="color: #8b2252;">"</span>/&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#24322;&#24120;&#22788;&#29702;&#22120; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">exceptionResolver</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.web.util.GnifExceptionResolver</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">defaultErrorView</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #0000ff;">value</span>&gt;common/error&lt;/<span style="color: #0000ff;">value</span>&gt;
    &lt;/<span style="color: #0000ff;">property</span>&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">exceptionMappings</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #0000ff;">props</span>&gt;
        &lt;<span style="color: #0000ff;">prop</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">java.lang.Exception</span><span style="color: #8b2252;">"</span>&gt;common/error&lt;/<span style="color: #0000ff;">prop</span>&gt;
      &lt;/<span style="color: #0000ff;">props</span>&gt;
    &lt;/<span style="color: #0000ff;">property</span>&gt;
  &lt;/<span style="color: #0000ff;">bean</span>&gt;

&lt;/<span style="color: #0000ff;">beans</span>&gt;
</pre>


</div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> 应用层</h2>
<div class="outline-text-2" id="text-4">



</div>

<div id="outline-container-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> 测试驱动</h3>
<div class="outline-text-3" id="text-4-1">


<p>
应用层与展现层是解耦的。因此，在开发应用的时候，可以使用测试驱动的方式进行开发。测试类的代码结构如下：
</p>



<pre class="src src-java"><span style="color: #008b8b;">@RunWith</span>(SpringJUnit4ClassRunner.<span style="color: #a020f0;">class</span>)
<span style="color: #008b8b;">@ContextConfiguration</span>(<span style="color: #8b2252;">"classpath:app-context.xml"</span>)
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">CodeServiceTest</span> {

    <span style="color: #008b8b;">@Autowired</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">CodeService</span> <span style="color: #a0522d;">codeService</span>;

    <span style="color: #008b8b;">@Autowired</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">ModelService</span> <span style="color: #a0522d;">modelService</span>;

    <span style="color: #008b8b;">@Test</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">testGenerateModel</span>() {
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span> = modelService.createModelFromTable(<span style="color: #8b2252;">"DEV_DATA_FIELD_"</span>);
        codeService.generateModel(<span style="color: #8b2252;">"DevDataField"</span>);
        modelService.deleteDataModel(id);
    }

    <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>

}
</pre>


<p>
在写测试类的时候，通过 @RunWith 申请使用 Spring 的测试运行类，并使用 @ContextConfiguration 指定 Spring 运行的时候要读取的初始化容器配置文件(app-context.xml)。通过这样的配置，就可以建立一个 Spring 容器并基于这个容器运行测试了。 app-context.xml 的内容示例如下：
</p>



<pre class="src src-xml">&lt;?<span style="color: #a020f0;">xml</span> <span style="color: #a0522d;">version</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">1.0</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">encoding</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">UTF-8</span><span style="color: #8b2252;">"</span>?&gt;
&lt;<span style="color: #0000ff;">beans</span> <span style="color: #483d8b;">xmlns</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.springframework.org/schema/beans</span><span style="color: #8b2252;">"</span>
       <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">xsi</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.w3.org/2001/XMLSchema-instance</span><span style="color: #8b2252;">"</span>
       <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">context</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.springframework.org/schema/context</span><span style="color: #8b2252;">"</span>
       <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">tx</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.springframework.org/schema/tx</span><span style="color: #8b2252;">"</span>
       <span style="color: #483d8b;">xsi</span>:<span style="color: #a0522d;">schemaLocation</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.springframework.org/schema/beans</span>
<span style="color: #8b2252;">            http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span style="color: #8b2252;">            http://www.springframework.org/schema/tx</span>
<span style="color: #8b2252;">            http://www.springframework.org/schema/tx/spring-tx.xsd</span>
<span style="color: #8b2252;">            http://www.springframework.org/schema/context</span>
<span style="color: #8b2252;">            http://www.springframework.org/schema/context/spring-context.xsd</span><span style="color: #8b2252;">"</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25351;&#23450;&#25968;&#25454;&#28304; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">devtoolDataSource</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.apache.commons.dbcp.BasicDataSource</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">destroy-method</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">close</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">driverClassName</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.microsoft.sqlserver.jdbc.SQLServerDriver</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">url</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">jdbc:sqlserver://192.168.0.44:1433;DatabaseName=gnif</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">username</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">sa</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">password</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">12345678</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">testWhileIdle</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">true</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">validationQuery</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">select 1</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">minEvictableIdleTimeMillis</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">1800000</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">removeAbandonedTimeout</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">180</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">removeAbandoned</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">true</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #0000ff;">bean</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25351;&#23450;&#20107;&#21153;&#31649;&#29702;&#22120; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">tx</span>:<span style="color: #0000ff;">annotation-driven</span> <span style="color: #a0522d;">transaction-manager</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">transactionManager</span><span style="color: #8b2252;">"</span>/&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#20107;&#21153;&#31649;&#29702;&#22120;&#30340;&#37197;&#32622; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">transactionManager</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.jdbc.datasource.DataSourceTransactionManager</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">dataSource</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">devtoolDataSource</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #0000ff;">bean</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25351;&#23450; MyBatis &#20250;&#35805;&#24037;&#21378; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">devtoolSessionFactory</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.MyBatis.spring.SqlSessionFactoryBean</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">configLocation</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">classpath:MyBatis-config.xml</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">dataSource</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">devtoolDataSource</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">typeAliasesPackage</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.devtool.model</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #0000ff;">bean</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25351;&#23450;&#38656;&#35201;&#25195;&#25551;&#30340;&#21253;&#65292;&#22810;&#25968;&#24773;&#20917;&#19979;&#65292;&#23601;&#26159; biz.service.impl &#21253; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">context</span>:<span style="color: #0000ff;">component-scan</span> <span style="color: #a0522d;">base-package</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.devtool.biz.service.impl</span><span style="color: #8b2252;">"</span>/&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25351;&#23450; Dao </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">devtoolMapper</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.MyBatis.spring.mapper.MapperScannerConfigurer</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">basePackage</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.devtool.integration.dao,com.gionee.gnif.dao</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #0000ff;">bean</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#20854;&#23427;&#25554;&#20214;&#37197;&#32622; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.GnifConfig</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">databaseSchemaUpdate</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">drop-create</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #0000ff;">bean</span>&gt;

  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">idGenerator</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.util.impl.DatabaseIDGenerator</span><span style="color: #8b2252;">"</span>/&gt;

  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">devTool</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.devtool.DevToolConfig</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">databaseSchemaUpdate</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">drop-create</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">sqlSessionFactory</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">devtoolSessionFactory</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">codeBasePath</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">d:/data/workspace/devtool/target</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">projectType</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">jar</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #0000ff;">bean</span>&gt;

&lt;/<span style="color: #0000ff;">beans</span>&gt;
</pre>


<p>
Controller 通过 Service 完成业务逻辑操作，因而，测试代码主要是针对 Service 接口进行测试。
</p>
</div>

</div>

<div id="outline-container-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Service</h3>
<div class="outline-text-3" id="text-4-2">


<p>
Service 的职责是，完成应用所需要的业务逻辑。
</p>
<p>
一个 Service 由接口与实现两个部分组成。 Service 接口定义在 biz 目录下, 实现类定义在 biz.impl 下。通过接口，达到功能入口写实现细节分离的目的。在需要的时候可以通过配置文件将 Service 的实现类予以替换。
</p>

</div>

<div id="outline-container-4-2-1" class="outline-4">
<h4 id="sec-4-2-1"><span class="section-number-4">4.2.1</span> 聚合服务</h4>
<div class="outline-text-4" id="text-4-2-1">


<p>
在开发过程中，需要将一个模块的功能集中在一个 Service 上提供功能给用户。以下是提供用户管理功能的 Service 示例：
</p>



<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">interface</span> <span style="color: #228b22;">UserService</span> {

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">save</span>(<span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span>);

    <span style="color: #228b22;">User</span> <span style="color: #0000ff;">getUser</span>(<span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">id</span>);

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">delete</span>(<span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">id</span>);

    List&lt;User&gt; queryUsers(Map&lt;String, Object&gt; param);

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35774;&#32622;&#29992;&#25143;&#25152;&#22312;&#32452;&#65292;</span>
    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">setGroups</span>(<span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">userId</span>, List&lt;Integer&gt; groupIds);

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#33719;&#21462;&#29992;&#25143;&#25152;&#22312;&#32452;&#65292;&#22914;&#26524;&#38656;&#35201;&#33719;&#21462;&#32452;&#20013;&#25152;&#26377;&#30340;&#29992;&#25143;&#65292;&#21017;&#38656;&#35201;&#22312; GroupService &#20013;&#25918;&#20837;&#35813;&#26041;&#27861;</span>
    List&lt;Group&gt; getGroups(<span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">userId</span>);

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#33719;&#21462;&#26426;&#26500;&#20013;&#30340;&#29992;&#25143;&#65292;&#21487;&#20197;&#21516;&#26102;&#22312; OrganizationService &#25918;&#20837;&#35813;&#26041;&#27861;</span>
    List&lt;User&gt; getUsersByOrgId(<span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">orgId</span>);

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#33719;&#21462;&#29992;&#25143;&#21487;&#20197;&#35775;&#38382;&#30340;&#36164;&#28304;&#65292;&#36890;&#24120;&#38656;&#35201;&#26681;&#25454;&#29992;&#25143;&#25214;&#36164;&#28304;&#65292;&#32780;&#19981;&#38656;&#35201;&#26681;&#25454;&#36164;&#28304;&#25214;&#29992;&#25143;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21487;&#20197;&#19981;&#38656;&#35201;&#22312; ResourceService &#20013;&#25918;&#20837;&#35813;&#26041;&#27861;</span>
    List&lt;Resource&gt; getUserSubResources(<span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">userId</span>, <span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">resourceId</span>, List&lt;Integer&gt; types);
    List&lt;Resource&gt; getUserSubResources(<span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">userId</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">resourceCode</span>, List&lt;Integer&gt; types);
    <span style="color: #228b22;">Resource</span> <span style="color: #0000ff;">getUserResource</span>(<span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">userId</span>, <span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">resourceId</span>);
    <span style="color: #228b22;">Resource</span> <span style="color: #0000ff;">getUserResource</span>(<span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">userId</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">resourceCode</span>);

}
</pre>


<p>
该示例中的服务聚合了用户相关服务。命名为 UserService，服务中提供了与用户相关的方法。方法中的参数/返回数值类型为 model 中的对象。在提供接口的时候，可能会存在相同的方法在不同的 Service 中都存在的情况。比如，UserService 可能需要获取某一个机构下的用户，OrganizationService 同时也提供了查询机构下用户的方法。两者的角度不一样，UserService 是从用户的角度来看，需要获取指定条件的用户；OrganizationService 是从机构的角度来看，需要获取指定机构下有哪些用户。这就意味着两者的实现可能会有所不同。所以可以在两个地方都放置相同的方法，但前提是，两者的角度不同从而可能未来的实现也有所不同。
</p>
</div>

</div>

<div id="outline-container-4-2-2" class="outline-4">
<h4 id="sec-4-2-2"><span class="section-number-4">4.2.2</span> 可否用 Map/Object 作为参数或返回值</h4>
<div class="outline-text-4" id="text-4-2-2">


<p>
在处理非查询的业务时，要求使用 biz.model 中的对象作为参数或返回值。使用 Map 的情况仅限于查询的时候使用。在非查询的业务中使用 biz.model 对象的原因如下：
</p>
<ol>
<li>明确服务接口，减少歧义地去理解服务接口这种情况出现
</li>
<li>提升服务的可重用性
</li>
<li>代码更易于测试和维护
</li>
</ol>


</div>

</div>

<div id="outline-container-4-2-3" class="outline-4">
<h4 id="sec-4-2-3"><span class="section-number-4">4.2.3</span> 服务粒度――事务完整性</h4>
<div class="outline-text-4" id="text-4-2-3">


<p>
一个服务方法的粒度大小规定是，一个服务方法应该对应于一个业务事务。业务事务通常对应于一个数据库事务，即满足数据库事务的四个要素(ACID)
</p>
<ul>
<li>原子性(Atomicity)：整个事务中的所有操作，要么全部完成，要么全部不完成，不可能停滞在中间某个环节。
</li>
<li>一致性(Consistency)：在事务开始之前和事务结束以后，数据库的完整性约束没有被破坏。
</li>
<li>隔离性(Isolation)：隔离状态执行事务，使它们好像是系统在给定时间内执行的唯一操作。有时也称为串行化，即一个事务执行的时候，其它所有事务都被阻塞，直到当前事务执行完成。
</li>
<li>持久性(Durability)：在事务完成以后，该事务所对数据库所作的更改便持久的保存在数据库之中，并不会被回滚。
</li>
</ul>


<p>
注：数据库的隔离性，通常可以指定隔离级别<sup><a class="footref" name="fnr-.6" href="#fn-.6">6</a></sup>，以达到提升事务处理的并发量的目的。
</p>
<p>
在写服务的实现的时候，可以加上事务标注来实现事务完成后的提交(commit)动作。举例如下：
</p>



<pre class="src src-java"><span style="color: #008b8b;">@Service</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">UserServiceImpl</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">UserService</span> {

    <span style="color: #008b8b;">@Autowired</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">AddressDao</span> <span style="color: #a0522d;">addressDao</span>;

    <span style="color: #008b8b;">@Autowired</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">UserDao</span> <span style="color: #a0522d;">userDao</span>;

    <span style="color: #008b8b;">@Transactional</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">saveAllUsers</span>(List&lt;User&gt; users) {
        <span style="color: #a020f0;">for</span> (<span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span>:users) {
            <span style="color: #a020f0;">for</span> (<span style="color: #228b22;">Address</span> <span style="color: #a0522d;">address</span>:user.getAddress()) {
                addressDao.save(address);
            }
            userDao.save(user);
        }
    }

}
</pre>


<p>
该示例中，一个方法处理了 User 与 Address 的数据库插入操作。是一个多表操作，从服务粒度的要求来看，应该是一个事务，从而通过添加 @Transactional 标注来指定所有的添加操作完成之后统一提交该事务。
</p>
</div>

</div>

<div id="outline-container-4-2-4" class="outline-4">
<h4 id="sec-4-2-4"><span class="section-number-4">4.2.4</span> Service 之间不能直接调用</h4>
<div class="outline-text-4" id="text-4-2-4">


<p>
Service 的主要功能是将业务逻辑进行包装，然后提供给外界调用。从包装业务逻辑的层面来讲，在 Service 层不应该进行嵌套包装，而要将嵌套包装交给更低一级的组件来完成。更低一级的组件包括：model(领域模型) 及 integration(集成层)。
</p>
</div>
</div>

</div>

<div id="outline-container-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Model</h3>
<div class="outline-text-3" id="text-4-3">


<p>
Model 的职责是，提供完成业务逻辑所需要的对象。Service 的入参及出参都为 Model。Model 中可以完成一些业务操作。Model 的基本结构为，存放数据的成员变量及对应的 get/set 方法。Model 可以用于 Freemarker 进行展示与 MyBatis 进行操作存取，两者都通过使用 get/set 方法对 Model 进行数据操作。
</p>

</div>

<div id="outline-container-4-3-1" class="outline-4">
<h4 id="sec-4-3-1"><span class="section-number-4">4.3.1</span> Model 的继承结构</h4>
<div class="outline-text-4" id="text-4-3-1">


<ul>
<li>PersistantObject 可持久化对象
<ul>
<li>RevisionObject 可锁定更新对象
<ul>
<li>BusinessObject 业务对象
</li>
</ul>

</li>
</ul>

</li>
</ul>



</div>

<div id="outline-container-4-3-1-1" class="outline-5">
<h5 id="sec-4-3-1-1"><span class="section-number-5">4.3.1.1</span> 可持久化对象</h5>
<div class="outline-text-5" id="text-4-3-1-1">


<p>
可持久化对象(PersistantObject)用于在数据库中存储数据实体。该类代码如下：
</p>



<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">PersistentObject</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">Serializable</span> {

    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">id</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Integer</span> <span style="color: #0000ff;">getId</span>() {
        <span style="color: #a020f0;">return</span> id;
    }

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">setId</span>(<span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">id</span>) {
        <span style="color: #a020f0;">this</span>.id = id;
    }

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Integer</span> <span style="color: #0000ff;">getNextId</span>() {
        id = AppContext.getIdGenerator().getId(<span style="color: #a020f0;">this</span>.getClass().getName());
        <span style="color: #a020f0;">return</span> id;
    }

}
</pre>


<p>
该对象有一个特殊的方法叫做 getNextId()。通过该方法可以取到对象的下一个 ID。该方法通过 IDGenerator 来获取 ID。在使用 PersistantObject 时，需要在 biz-context.xml 中配置 IDGenerator。
</p>
<p>
getNextId 用于 MyBatis 中的插入语句，如：
</p>



<pre class="src src-xml">&lt;<span style="color: #0000ff;">insert</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">insert</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">parameterType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.model.LoginUser</span><span style="color: #8b2252;">"</span>&gt;
  insert into login_user (id, name, password) values (
  #{nextId,jdbcType=NUMERIC},
  #{name,jdbcType=VARCHAR},
  #{password,jdbcType=VARCHAR}
  )
&lt;/<span style="color: #0000ff;">insert</span>&gt;
</pre>


<p>
就在 #{nextId} 中调用 LoginUser 对象中的 getNextId() 方法。
</p>
</div>

</div>

<div id="outline-container-4-3-1-2" class="outline-5">
<h5 id="sec-4-3-1-2"><span class="section-number-5">4.3.1.2</span> 可锁定更新对象</h5>
<div class="outline-text-5" id="text-4-3-1-2">


<p>
可锁定更新对象(RevisionObject)用于解决多个应用更新同一个数据库表的时候，处理加锁解锁的问题。该类定义如下：
</p>



<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">RevisionObject</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">PersistentObject</span> {

    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">revision</span> = 0;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">getRevision</span>() {
        <span style="color: #a020f0;">return</span> revision;
    }

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">setRevision</span>(<span style="color: #228b22;">int</span> <span style="color: #a0522d;">revision</span>) {
        <span style="color: #a020f0;">this</span>.revision = revision;
    }

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">getNextRevision</span>() {
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">this</span>.revision + 1;
    }

}
</pre>


<p>
该类对应的 MyBatis 更新方法如下：
</p>



<pre class="src src-xml">&lt;<span style="color: #0000ff;">update</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">update</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">parameterType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.model.DbProperty</span><span style="color: #8b2252;">"</span>&gt;
  update GC_PROPERTY_
  &lt;<span style="color: #0000ff;">set</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">value != null</span><span style="color: #8b2252;">"</span>&gt;
      VALUE_ = #{value,jdbcType=VARCHAR},
    &lt;/<span style="color: #0000ff;">if</span>&gt;
    REV_ = #{nextRevision}
  &lt;/<span style="color: #0000ff;">set</span>&gt;
  where KEY_ = #{key} and REV_ = #{revision}
&lt;/<span style="color: #0000ff;">update</span>&gt;
</pre>


<p>
在 MyBatis 配置文件中，更新条件加上 REV_ = #{revision}，更新值加上 REV_ = #{nextRevision}。意思是，如果当前版本与实体对象的当前版本一致，则将当前版本设置为下一个版本。
</p>
<p>
在调用 Dao 时，按以下方式进行调用：
</p>



<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">InvokeServiceImpl</span> {
    <span style="color: #008b8b;">@Autowired</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">DbPropertyDao</span> <span style="color: #a0522d;">propertyDao</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">invoke</span>() {
        <span style="color: #a020f0;">if</span> (propertyDao.update()!=1) {
            <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">GnifException</span>(<span style="color: #8b2252;">"&#26356;&#26032;&#25968;&#25454;&#22833;&#36133;"</span>)
        }
    }
}
</pre>


<p>
在调用 Dao 时，update 方法会返回当前影响的表行数。如果成功更新 n 行，则返回值为 n，否则返回值为0，表示没有更新任何一行。
</p>
<p>
如果需要对数据库进行加锁操作，可以使用 RevisionObject。
</p>
</div>

</div>

<div id="outline-container-4-3-1-3" class="outline-5">
<h5 id="sec-4-3-1-3"><span class="section-number-5">4.3.1.3</span> 业务对象</h5>
<div class="outline-text-5" id="text-4-3-1-3">


<p>
业务对象(BusinessObject)用于保存业务数据。业务数据包含了如：对象状态、备注、创建时间、创建人、修改时间、修改人等属性。其定义如下：
</p>



<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BusinessObject</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">RevisionObject</span> {

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">final</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">STATUS_NORMAL</span> = 0;
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">final</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">STATUS_DELETED</span> = -1;

    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">status</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">remark</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">createBy</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">Date</span> <span style="color: #a0522d;">createTime</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">updateBy</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">Date</span> <span style="color: #a0522d;">updateTime</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">getter and setters...</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">getCurrentAccount</span>() {
        <span style="color: #a020f0;">return</span> AppContext.getCurrentAccount();
    }
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Date</span> <span style="color: #0000ff;">getCurrentTime</span>() {
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Date</span>();
    }
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Integer</span> <span style="color: #0000ff;">getNormalStatus</span>() {
        <span style="color: #a020f0;">return</span> STATUS_NORMAL;
    }

}
</pre>


<p>
在业务对象中，提供了三个附加的方法：
</p>
<ul>
<li>getCurrentAccount() 用于在 MyBatis 中获取当前操作用户的账号
</li>
<li>getCurrentTime() 用于在 MyBatis 中获取当前的系统时间
</li>
<li>getNormalStatus() 用于在 MyBatis 中获取状态值
</li>
</ul>


<p>
以下举例如何在 MyBatis 中使用以上方法对用户进行添加和更新操作：
</p>



<pre class="src src-xml">&lt;<span style="color: #0000ff;">sql</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">columns</span><span style="color: #8b2252;">"</span>&gt;
  id, account, password, name, org_id, pri_group_id, telephone, mobile, email, type,
  status, remark, create_by, create_time, update_by, update_time
&lt;/<span style="color: #0000ff;">sql</span>&gt;

&lt;<span style="color: #0000ff;">insert</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">insert</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">parameterType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.auth.model.User</span><span style="color: #8b2252;">"</span>&gt;
  insert into auth_user (&lt;<span style="color: #0000ff;">include</span> <span style="color: #a0522d;">refid</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">columns</span><span style="color: #8b2252;">"</span>/&gt;) values (
  #{nextId},
  #{account},
  #{password},
  #{name},
  #{orgId},
  #{priGroupId},
  #{telephone},
  #{mobile},
  #{email},
  #{type},
  #{normalStatus},
  #{remark,jdbcType=VARCHAR},
  #{currentAccount},
  #{currentTime},
  #{currentAccount},
  #{currentTime}
  )
&lt;/<span style="color: #0000ff;">insert</span>&gt;

&lt;<span style="color: #0000ff;">update</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">update</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">parameterType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.auth.model.User</span><span style="color: #8b2252;">"</span>&gt;
  update auth_user
  &lt;<span style="color: #0000ff;">set</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">account != null</span><span style="color: #8b2252;">"</span>&gt;
      account = #{account},
    &lt;/<span style="color: #0000ff;">if</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">password != null</span><span style="color: #8b2252;">"</span>&gt;
      password = #{password},
    &lt;/<span style="color: #0000ff;">if</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">name != null</span><span style="color: #8b2252;">"</span>&gt;
      name = #{name},
    &lt;/<span style="color: #0000ff;">if</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">orgId != null</span><span style="color: #8b2252;">"</span>&gt;
      org_id = #{orgId},
    &lt;/<span style="color: #0000ff;">if</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">priGroupId != null</span><span style="color: #8b2252;">"</span>&gt;
      pri_group_id = #{priGroupId},
    &lt;/<span style="color: #0000ff;">if</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">telephone != null</span><span style="color: #8b2252;">"</span>&gt;
      telephone = #{telephone},
    &lt;/<span style="color: #0000ff;">if</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">mobile != null</span><span style="color: #8b2252;">"</span>&gt;
      mobile = #{mobile},
    &lt;/<span style="color: #0000ff;">if</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">email != null</span><span style="color: #8b2252;">"</span>&gt;
      email = #{email},
    &lt;/<span style="color: #0000ff;">if</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">type != null</span><span style="color: #8b2252;">"</span>&gt;
      type = #{type},
    &lt;/<span style="color: #0000ff;">if</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">status != null</span><span style="color: #8b2252;">"</span>&gt;
      status = #{status},
    &lt;/<span style="color: #0000ff;">if</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">remark != null</span><span style="color: #8b2252;">"</span>&gt;
      remark = #{remark},
    &lt;/<span style="color: #0000ff;">if</span>&gt;
    update_by = #{currentAccount},
    update_time = #{currentTime}
  &lt;/<span style="color: #0000ff;">set</span>&gt;
  where id = #{id}
&lt;/<span style="color: #0000ff;">update</span>&gt;
</pre>


<p>
在 update_by, update_time, create_by, create_time 及 status 字段中，就使用到了三个 get 方法。
</p>
</div>
</div>

</div>

<div id="outline-container-4-3-2" class="outline-4">
<h4 id="sec-4-3-2"><span class="section-number-4">4.3.2</span> 在 Model 中获取数据访问对象</h4>
<div class="outline-text-4" id="text-4-3-2">


<p>
在 Model 中可以调用 Dao。由于 Model 不是由 spring 进行管理的，因而不能使用注入的方式将 Dao 注入到 Model 中。而要使用 AppContext 来获取当前应用中由 spring 容器管理的对象。举例如下：
</p>



<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Organization</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">BusinessObject</span> {

    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">pid</span> = 0;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">address</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">telephone</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">fullName</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">getter and setters...</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">List</span>&lt;Integer&gt; getParents() {
        List&lt;Integer&gt; ret = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ArrayList</span>&lt;Integer&gt;();
        <span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">id</span> = AppContext.getBean(OrganizationDao.<span style="color: #a020f0;">class</span>).getParentId(getId());
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = AuthConfig.maxTreeLevel;
        <span style="color: #a020f0;">while</span> (id != <span style="color: #008b8b;">null</span>) {
            ret.add(id);
            <span style="color: #a020f0;">if</span> (--i &lt;= 0) {
                <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">GnifException</span>(<span style="color: #8b2252;">"encountered maxTreeLevel when getting parent organization id"</span>);
            }
            id = AppContext.getBean(OrganizationDao.<span style="color: #a020f0;">class</span>).getParentId(id);
        }
        <span style="color: #a020f0;">return</span> ret;
    }

}
</pre>


<p>
该例为组织架构（机构）对应的 Model。业务上需要获取一个机构的父机构，因而在 Organization 中加入方法 getParents()。在 getParents() 中，就使用 AppContext.getBean() 来获取 spring 容器中的 OrganizationDao。
</p>
</div>
</div>

</div>

<div id="outline-container-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> 日志</h3>
<div class="outline-text-3" id="text-4-4">


<p>
日志对于排错、统计、数据恢复等有着重要影响。开发平台在关键位置都加入了日志显示。如：显示访问的 URL、访问 Controller，打印数据库SQL语句等。在业务开发过程中，可以对关键业务进行日志打印控制。
</p>

</div>

<div id="outline-container-4-4-1" class="outline-4">
<h4 id="sec-4-4-1"><span class="section-number-4">4.4.1</span> 使用 Logger</h4>
<div class="outline-text-4" id="text-4-4-1">


<p>
一个典型的打印日志的类为如下写法：
</p>



<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">HelloServiceImpl</span> {
    <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">final</span> <span style="color: #228b22;">Logger</span> <span style="color: #a0522d;">logger</span> = LoggerFactory.getLogger(HelloServiceImpl.<span style="color: #a020f0;">class</span>);

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">handleHello</span>() {
        <span style="color: #a020f0;">if</span> (logger.isDebugEnabled()) {
            logger.debug(<span style="color: #8b2252;">"DEBUG INFORMATION"</span>);
        }
    }
}
</pre>


<p>
代码中包含定义 logger 及使用 logger 两部分内容。定义 logger 通过 LoggerFactory 来获取一个 Logger 类的实例赋值给静态成员变量 logger。在使用 logger 时，需要判断一下当前的日志打印级别是否满足预期的打印级别，再写打印日志部分的代码。
</p>
<p>
日志打印是有目的的打印，所以需要包含特定目的所需要的数据。如打印登录日志，就需要将用户的 IP 地址，登录时间，登录用户等信息打印出来。这样的日志才有利用价值。打印日志本身是需要占用开销的，如果日志没有利用价值，就没有必要浪费这样的开销。
</p>
</div>

</div>

<div id="outline-container-4-4-2" class="outline-4">
<h4 id="sec-4-4-2"><span class="section-number-4">4.4.2</span> 配置 log4j.properties</h4>
<div class="outline-text-4" id="text-4-4-2">





<pre class="src src-properties"># &#37197;&#32622;&#26681;&#32467;&#28857;
# level &#21487;&#20197;&#26159; ALL&lt;DEBUG&lt;INFO&lt;WARN&lt;ERROR&lt;FATAL&lt;OFF
log4j.rootLogger=[level], appenderName, appenderName, ...

# &#37197;&#32622; appender(&#29992;&#20110;&#36755;&#20986;&#26085;&#24535;)
# appender &#21487;&#20197;&#26159;&#65306;
# ConsoleAppender &#25511;&#21046;&#21488;
# FileAppender &#25991;&#20214;
# DailyRollingFileAppender &#27599;&#22825;&#20135;&#29983;&#19968;&#20010;&#26085;&#24535;&#25991;&#20214;
# RollingFileAppender &#25991;&#20214;&#22823;&#23567;&#21040;&#36798;&#25351;&#23450;&#23610;&#23544;&#26102;&#20135;&#29983;&#19968;&#20010;&#26032;&#30340;&#25991;&#20214;
# WriteAppender &#23558;&#26085;&#24535;&#20449;&#24687;&#20197;&#27969;&#26684;&#24335;&#21457;&#36865;&#21040;&#20219;&#24847;&#25351;&#23450;&#30340;&#22320;&#26041;
# JDBCAppender &#23558;&#26085;&#24535;&#20449;&#24687;&#20445;&#23384;&#21040;&#25968;&#25454;&#24211;&#20013;
log4j.appender.appenderName=org.apache.log4j.ConsoleAppender
log4j.appender.appenderName.layout=org.apache.log4j.PatternLayout
log4j.appender.appenderName.layout.ConversionPattern=%d %5p (%c:%L) - %m%n
# %m &#36755;&#20986;&#20195;&#30721;&#20013;&#25351;&#23450;&#30340;&#28040;&#24687;
# %p &#36755;&#20986;&#20248;&#20808;&#32423;&#65292;&#21363;DEBUG&#65292;INFO&#65292;WARN&#65292;ERROR&#65292;FATAL
# %r &#36755;&#20986;&#33258;&#24212;&#29992;&#21551;&#21160;&#21040;&#36755;&#20986;&#35813;log&#20449;&#24687;&#32791;&#36153;&#30340;&#27627;&#31186;&#25968;
# %c &#36755;&#20986;&#25152;&#23646;&#30340;&#31867;&#30446;&#65292;&#36890;&#24120;&#23601;&#26159;&#25152;&#22312;&#31867;&#30340;&#20840;&#21517;
# %t &#36755;&#20986;&#20135;&#29983;&#35813;&#26085;&#24535;&#20107;&#20214;&#30340;&#32447;&#31243;&#21517;
# %n &#36755;&#20986;&#19968;&#20010;&#22238;&#36710;&#25442;&#34892;&#31526;&#65292;Windows&#24179;&#21488;&#20026;&#8220;rn&#8221;&#65292;Unix&#24179;&#21488;&#20026;&#8220;n&#8221;
# %d &#36755;&#20986;&#26085;&#24535;&#26102;&#38388;&#28857;&#30340;&#26085;&#26399;&#25110;&#26102;&#38388;&#65292;&#40664;&#35748;&#26684;&#24335;&#20026;ISO8601&#65292;&#20063;&#21487;&#20197;&#22312;&#20854;&#21518;&#25351;&#23450;&#26684;&#24335;&#65292;&#27604;&#22914;&#65306;%d{yyyy MMM dd HH:mm:ss,SSS}&#65292;&#36755;&#20986;&#31867;&#20284;&#65306;2002&#24180;10&#26376;18&#26085; 22&#65306;10&#65306;28&#65292;921
# %l &#36755;&#20986;&#26085;&#24535;&#20107;&#20214;&#30340;&#21457;&#29983;&#20301;&#32622;&#65292;&#21253;&#25324;&#31867;&#30446;&#21517;&#12289;&#21457;&#29983;&#30340;&#32447;&#31243;&#65292;&#20197;&#21450;&#22312;&#20195;&#30721;&#20013;&#30340;&#34892;&#25968;&#12290;

# &#38024;&#23545;&#21253;&#37197;&#32622;&#26085;&#24535;&#30340;&#25171;&#21360;&#32423;&#21035;
log4j.logger.org.springframework=INFO
log4j.logger.com.gionee=DEBUG
</pre>


</div>

</div>

<div id="outline-container-4-4-3" class="outline-4">
<h4 id="sec-4-4-3"><span class="section-number-4">4.4.3</span> 配置 log4j.xml</h4>
<div class="outline-text-4" id="text-4-4-3">


<p>
使用 xml 配置与使用 properties 类似，主要是对 appender 进行设置。以下为配置举例：
</p>



<pre class="src src-xml">&lt;?<span style="color: #a020f0;">xml</span> <span style="color: #a0522d;">version</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">1.0</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">encoding</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">UTF-8</span><span style="color: #8b2252;">"</span> ?&gt;
&lt;!<span style="color: #a020f0;">DOCTYPE</span> log4j:configuration <span style="color: #a020f0;">SYSTEM</span> <span style="color: #8b2252;">"</span><span style="color: #8b2252;">log4j.dtd</span><span style="color: #8b2252;">"</span>&gt;
&lt;<span style="color: #483d8b;">log4j</span>:<span style="color: #0000ff;">configuration</span>&gt;

  &lt;<span style="color: #0000ff;">appender</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">CONSOLE</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.apache.log4j.ConsoleAppender</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">layout</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.apache.log4j.PatternLayout</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">ConversionPattern</span><span style="color: #8b2252;">"</span>
             <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">%d - %c -%-4r [%t] %-5p %x - %m%n</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;/<span style="color: #0000ff;">layout</span>&gt;

    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;">&#38480;&#21046;&#36755;&#20986;&#32423;&#21035;</span><span style="color: #b22222;">--&gt;</span>
    &lt;<span style="color: #0000ff;">filter</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.apache.log4j.varia.LevelRangeFilter</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">LevelMax</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">ERROR</span><span style="color: #8b2252;">"</span>/&gt;
      &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">LevelMin</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">TRACE</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;/<span style="color: #0000ff;">filter</span>&gt;
  &lt;/<span style="color: #0000ff;">appender</span>&gt;

  &lt;<span style="color: #0000ff;">appender</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">FILE</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.apache.log4j.FileAppender</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">File</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">C:/log4j1.log</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;<span style="color: #0000ff;">layout</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.apache.log4j.PatternLayout</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">ConversionPattern</span><span style="color: #8b2252;">"</span>
             <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">%d - %c -%-4r [%t] %-5p %x - %m%n</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;/<span style="color: #0000ff;">layout</span>&gt;
  &lt;/<span style="color: #0000ff;">appender</span>&gt;

  &lt;<span style="color: #0000ff;">appender</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">DATABASE</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.apache.log4j.jdbc.JDBCAppender</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">URL</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">jdbc:oracle:thin:@192.168.0.59:1521:oanet</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">driver</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">oracle.jdbc.driver.OracleDriver</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">user</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">hdczoa</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">password</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">system</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;<span style="color: #0000ff;">layout</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.apache.log4j.PatternLayout</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">ConversionPattern</span><span style="color: #8b2252;">"</span>
             <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">INSERT INTO hdczoa.LOG4J(stamp,thread, info_level,class,message) VALUES ('%d', '%t', '%p', '%c', %m)</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;/<span style="color: #0000ff;">layout</span>&gt;
  &lt;/<span style="color: #0000ff;">appender</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#21457;&#37038;&#20214;&#65288;&#21482;&#26377;ERROR&#26102;&#25165;&#20250;&#21457;&#36865;&#65281;&#65289; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">appender</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">MAIL</span><span style="color: #8b2252;">"</span>
            <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.apache.log4j.net.SMTPAppender</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">threshold</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">debug</span><span style="color: #8b2252;">"</span> /&gt;
    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#26085;&#24535;&#30340;&#38169;&#35823;&#32423;&#21035;</span>
<span style="color: #b22222;">         &lt;param name="threshold" value="fatal"/&gt;</span>
<span style="color: #b22222;">    </span><span style="color: #b22222;">--&gt;</span>
    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#32531;&#23384;&#25991;&#20214;&#22823;&#23567;&#65292;&#26085;&#24535;&#36798;&#21040;512K&#26102;&#21457;&#36865;Email </span><span style="color: #b22222;">--&gt;</span>
    &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">BufferSize</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">512</span><span style="color: #8b2252;">"</span> /&gt;<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#21333;&#20301;K </span><span style="color: #b22222;">--&gt;</span>
    &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">From</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">test@163.com</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">SMTPHost</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">smtp.163.com</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">Subject</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">juyee-log4jMessage</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">To</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">test@163.com</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">SMTPUsername</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">test</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">SMTPPassword</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">test</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">layout</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.apache.log4j.PatternLayout</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">ConversionPattern</span><span style="color: #8b2252;">"</span>
             <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">%-d{yyyy-MM-dd HH:mm:ss.SSS} [%p]-[%c] %m%n</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;/<span style="color: #0000ff;">layout</span>&gt;
  &lt;/<span style="color: #0000ff;">appender</span>&gt;

  &lt;<span style="color: #0000ff;">appender</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">ASYNC</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.apache.log4j.AsyncAppender</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">param</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">BufferSize</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">256</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">appender-ref</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">DATABASE</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #0000ff;">appender</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;">&#36890;&#36807;&lt;logger&gt;&lt;/logger&gt;&#30340;&#23450;&#20041;&#21487;&#20197;&#23558;&#21508;&#20010;&#21253;&#20013;&#30340;&#31867;&#26085;&#24535;&#36755;&#20986;&#21040;&#19981;&#21516;&#30340;&#26085;&#24535;&#25991;&#20214;&#20013;</span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">logger</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.litt2.log4j</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">additivity</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">false</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">level</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">WARN</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">appender-ref</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">CONSOLE</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #0000ff;">logger</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;">&#36890;&#36807;&lt;category&gt;&lt;/category&gt;&#30340;&#23450;&#20041;&#21487;&#20197;&#23558;&#21508;&#20010;&#21253;&#20013;&#30340;&#31867;&#26085;&#24535;&#36755;&#20986;&#21040;&#19981;&#21516;&#30340;&#26085;&#24535;&#25991;&#20214;&#20013;</span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">category</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.litt3</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">level</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">DEBUG</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">appender-ref</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">CONSOLE</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">appender-ref</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">MAIL</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #0000ff;">category</span>&gt;

  &lt;<span style="color: #0000ff;">root</span>&gt;
    &lt;<span style="color: #0000ff;">priority</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">debug</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">appender-ref</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">CONSOLE</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">appender-ref</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">FILE</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #0000ff;">root</span>&gt;

&lt;/<span style="color: #483d8b;">log4j</span>:<span style="color: #0000ff;">configuration</span>&gt;
</pre>


</div>
</div>

</div>

<div id="outline-container-4-5" class="outline-3">
<h3 id="sec-4-5"><span class="section-number-3">4.5</span> 异常</h3>
<div class="outline-text-3" id="text-4-5">


<p>
异常，用于在系统处理数据出错时，向用户提示有效信息，让用户可以知道接下来应该如何做。在开发框架中，可以抛出 GnifException。
</p>

</div>

<div id="outline-container-4-5-1" class="outline-4">
<h4 id="sec-4-5-1"><span class="section-number-4">4.5.1</span> 异常类的层次结构</h4>
<div class="outline-text-4" id="text-4-5-1">


<p>
异常分为运行时异常和非运行时异常。非运行时异常需要在代码中进行捕获处理，运行时异常则不需要。以下是 java/gnif 中异常的层次结构：
</p>
<ul>
<li>Throwable
<ul>
<li>Error
</li>
<li>Exception
<ul>
<li>RuntimeException
<ul>
<li>GnifException
</li>
</ul>

</li>
</ul>

</li>
</ul>

</li>
</ul>


<p>
Error 指系统出现的非预期异常。抛出该异常，则意味着系统处于非预期的不正常运行状态，可能出现非预期的任何结果。
</p>
<p>
Exception 指系统出现的可预期异常。抛出该异常，则意味着系统处理可控状态。该类异常需要在编写代码时进行捕获并进行相应的处理。
</p>
<p>
RuntimeException 属于可预期的异常。但不需要在编码代码时进行捕获处理。
</p>
<p>
GnifException 为 gnif 指定使用异常类。当代码中需要抛出异常时，需要使用该类。
</p>
</div>

</div>

<div id="outline-container-4-5-2" class="outline-4">
<h4 id="sec-4-5-2"><span class="section-number-4">4.5.2</span> 异常与事务处理</h4>
<div class="outline-text-4" id="text-4-5-2">


<p>
在 Service 层，为了在服务异常的时候进行事务回滚，需要在 Service 实现方法中加入 @Transactional 注解。@Transactional 默认对运行时异常进行捕获并在捕获到运行时异常的时候对事务进行回滚操作。开发人员可以指定 @Transactional 捕获非运行时异常，但不推荐这样做。对于非运行时异常，通常需要在代码中主动捕获并进行处理。可以捕获之后根据处理结构再将 GnifException 这一运行时异常抛出。
</p>
</div>

</div>

<div id="outline-container-4-5-3" class="outline-4">
<h4 id="sec-4-5-3"><span class="section-number-4">4.5.3</span> 异常与用户交互</h4>
<div class="outline-text-4" id="text-4-5-3">


<p>
在展现层中，平台会将异常消息发送到客户端（浏览器）。因而，开发时需要将异常的消息完整地写出来，包括两部分：一是要告诉用户出现什么错误，二是要告诉用户可以怎么做。以下是良好与不好的异常消息举例：
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">好的方式</th><th scope="col" class="left">不好的方式</th></tr>
</thead>
<tbody>
<tr><td class="left">用户帐号已经被占用，请换一个帐号</td><td class="left">操作失败</td></tr>
<tr><td class="left">用户原密码输入有误，请重试</td><td class="left">操作失败</td></tr>
</tbody>
</table>


</div>
</div>

</div>

<div id="outline-container-4-6" class="outline-3">
<h3 id="sec-4-6"><span class="section-number-3">4.6</span> 其它</h3>
<div class="outline-text-3" id="text-4-6">



</div>

<div id="outline-container-4-6-1" class="outline-4">
<h4 id="sec-4-6-1"><span class="section-number-4">4.6.1</span> 物理删除与逻辑删除</h4>
<div class="outline-text-4" id="text-4-6-1">


<p>
物理删除是指，在数据库中将一条记录使用 delete 语句删除掉。逻辑删除是指，设置记录的状态为删除状态。物理删除带来的后果是，所删除的记录不能再被找回。
</p>
<p>
在应用开发的时候，可以物理删除的内容是：与系统的业务相关度不大的数据。如，再使用系统的时候，会用通过用户与权限的关联表来记录用户的权限信息，这个记录可以控制用户能够使用的功能。删除这个关联，只是影响到用户的功能使用，可以再给用户授权即可让用户正常使用。
</p>
<p>
只能进行物理删除的数据是：与系统业务相关的数据。一个系统总是在完成一定的业务，业务通常与用户、机构相关，所以，用户、机构就不能物理删除。比如，一个借物还物系统，用户借出了东西，就在系统中记录一条记录，这条记录关联了用户的 ID ，如果物理删除了用户，会导致系统无法检索到具体的用户。作为一个借物还物系统，就会因为物理删除数据而丧失它的功能。
</p>
<p>
再举一个例子，在系统中通常会使用数据字典，即用户可以自定义含义的选择项。如：文档类型、人员类型等。如果删除这些数据，则与之相关的业务数据就缺失了信息，这些数据就只能做逻辑删除。
</p>
</div>
</div>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> 集成层</h2>
<div class="outline-text-2" id="text-5">



</div>

<div id="outline-container-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> 接口定义</h3>
<div class="outline-text-3" id="text-5-1">


<p>
一个典型的 Dao 接口定义如下：
</p>



<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">interface</span> <span style="color: #228b22;">UserDao</span> {

    <span style="color: #228b22;">int</span> <span style="color: #0000ff;">delete</span>(<span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">id</span>);

    <span style="color: #228b22;">int</span> <span style="color: #0000ff;">insert</span>(<span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span>);

    <span style="color: #228b22;">int</span> <span style="color: #0000ff;">update</span>(<span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span>);

    <span style="color: #228b22;">User</span> <span style="color: #0000ff;">get</span>(<span style="color: #228b22;">Integer</span> <span style="color: #a0522d;">id</span>);

}
</pre>


<p>
需要注意的是，在更新操作时，返回值应该是 int 型数据类型。该值表示当前方法执行后影响的数据库行数。在以下场景中需要用到这个值：
</p>

</div>

<div id="outline-container-5-1-1" class="outline-4">
<h4 id="sec-5-1-1"><span class="section-number-4">5.1.1</span> 同步数据</h4>
<div class="outline-text-4" id="text-5-1-1">





<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">merge</span>(<span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span>) {
    <span style="color: #a020f0;">if</span> (userDao.update(user) != 1) {
        userDao.insert(user);
    }
}
</pre>


<p>
如果要更新的用户不存在，则将用户插入。
</p>
</div>

</div>

<div id="outline-container-5-1-2" class="outline-4">
<h4 id="sec-5-1-2"><span class="section-number-4">5.1.2</span> 乐观锁更新</h4>
<div class="outline-text-4" id="text-5-1-2">





<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">save</span>(<span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span>) {
    <span style="color: #a020f0;">if</span> (userDao.update(user) != 1) {
        <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">GnifException</span>(<span style="color: #8b2252;">"&#26356;&#26032;&#29992;&#25143;&#20449;&#24687;&#22833;&#36133;&#65292;&#35813;&#25968;&#25454;&#24050;&#32463;&#30001;&#20854;&#20182;&#25805;&#20316;&#21592;&#26356;&#26032;&#65281;"</span>);
    }
}
</pre>



<pre class="src src-xml">&lt;<span style="color: #0000ff;">update</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">update</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">parameterType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.model.User</span><span style="color: #8b2252;">"</span>&gt;
  update user
  &lt;<span style="color: #0000ff;">set</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">name != null</span><span style="color: #8b2252;">"</span>&gt;
      name = #{name,jdbcType=VARCHAR},
    &lt;/<span style="color: #0000ff;">if</span>&gt;
    &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">password != null</span><span style="color: #8b2252;">"</span>&gt;
      password = #{password,jdbcType=VARCHAR},
    &lt;/<span style="color: #0000ff;">if</span>&gt;
    rev = #{nextRevision}
  &lt;/<span style="color: #0000ff;">set</span>&gt;
  where id = #{id} and rev = #{revision}
&lt;/<span style="color: #0000ff;">update</span>&gt;
</pre>


<p>
更新数据时，查询条件为 id+rev 组合查询条件。如果当前数据已经被更新，则其他操作人员无法更新当前数据。
</p>
</div>
</div>

</div>

<div id="outline-container-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> MyBatis O/R Mapping</h3>
<div class="outline-text-3" id="text-5-2">



</div>

<div id="outline-container-5-2-1" class="outline-4">
<h4 id="sec-5-2-1"><span class="section-number-4">5.2.1</span> 使用 sql 将包装可复用的 sql 语句</h4>
<div class="outline-text-4" id="text-5-2-1">





<pre class="src src-xml">&lt;<span style="color: #0000ff;">sql</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">columns</span><span style="color: #8b2252;">"</span>&gt;
  id, name, account, password
&lt;/<span style="color: #0000ff;">sql</span>&gt;
</pre>


<p>
以上 sql 语句可以在其它位置复用：
</p>



<pre class="src src-xml">&lt;<span style="color: #0000ff;">select</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">get</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">resultMap</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">userResultMap</span><span style="color: #8b2252;">"</span>&gt;
  select &lt;<span style="color: #0000ff;">include</span> <span style="color: #a0522d;">refid</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">columns</span><span style="color: #8b2252;">"</span>/&gt; from User
  where id = #{id}
&lt;/<span style="color: #0000ff;">select</span>&gt;
</pre>


</div>

</div>

<div id="outline-container-5-2-2" class="outline-4">
<h4 id="sec-5-2-2"><span class="section-number-4">5.2.2</span> 使用 resultMap 建立对象与关系表的映射</h4>
<div class="outline-text-4" id="text-5-2-2">



</div>

<div id="outline-container-5-2-2-1" class="outline-5">
<h5 id="sec-5-2-2-1"><span class="section-number-5">5.2.2.1</span> 基本结构</h5>
<div class="outline-text-5" id="text-5-2-2-1">





<pre class="src src-xml">&lt;<span style="color: #0000ff;">resultMap</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.auth.model.User</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">result</span><span style="color: #8b2252;">"</span>&gt;
  &lt;<span style="color: #0000ff;">id</span> <span style="color: #a0522d;">property</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">id</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">column</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">id</span><span style="color: #8b2252;">"</span>/&gt;
  &lt;<span style="color: #0000ff;">result</span> <span style="color: #a0522d;">property</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">account</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">column</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">account</span><span style="color: #8b2252;">"</span>/&gt;
  &lt;<span style="color: #0000ff;">result</span> <span style="color: #a0522d;">property</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">password</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">column</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">password</span><span style="color: #8b2252;">"</span>/&gt;
  &lt;<span style="color: #0000ff;">result</span> <span style="color: #a0522d;">property</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">name</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">column</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">name</span><span style="color: #8b2252;">"</span>/&gt;
&lt;/<span style="color: #0000ff;">resultMap</span>&gt;
</pre>


<p>
id, result 将 java 对象的属性与数据库字段进行映射关联。id 作为主键，在使用缓存的时候可以返回 id 相等的对象，使用 id 可以让 MyBatis 能够处理性能优化。
</p>
</div>

</div>

<div id="outline-container-5-2-2-2" class="outline-5">
<h5 id="sec-5-2-2-2"><span class="section-number-5">5.2.2.2</span> 一对一关联</h5>
<div class="outline-text-5" id="text-5-2-2-2">





<pre class="src src-xml">&lt;<span style="color: #0000ff;">resultMap</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.auth.model.User</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">result</span><span style="color: #8b2252;">"</span>&gt;
  ...
  &lt;<span style="color: #0000ff;">association</span> <span style="color: #a0522d;">property</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">address</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">javaType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">Address</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">id</span> <span style="color: #a0522d;">property</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">id</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">column</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">address_id</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">result</span> <span style="color: #a0522d;">property</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">name</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">column</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">address_name</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #0000ff;">association</span>&gt;
&lt;/<span style="color: #0000ff;">resultMap</span>&gt;
</pre>


<p>
如果 java 对象中有复杂的数据类型，则需要使用 association 标签。可以在 association 标签中写子查询。如：
</p>



<pre class="src src-xml">&lt;<span style="color: #0000ff;">resultMap</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.auth.model.User</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">result</span><span style="color: #8b2252;">"</span>&gt;
  ...
  &lt;<span style="color: #0000ff;">association</span> <span style="color: #a0522d;">property</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">address</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">column</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">address_id</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">javaType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">Address</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">select</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">getAddress</span><span style="color: #8b2252;">"</span>&gt;
&lt;/<span style="color: #0000ff;">resultMap</span>&gt;
</pre>


<p>
在使用子查询的时候，可以使用 fetchType="lazy|eager" 来指定子查询使用延迟加载的方式还是完全加载的方式。使用子查询关键在于两个属性：
</p>
<ul>
<li>column 指定查询的参数
</li>
<li>select 指定子查询的查询语句
</li>
</ul>


<p>
如果查询的参数有多个，可以使用 column="{prop1=col1,prop2=col2}" 的方式来传递多个查询参数。
</p>
</div>

</div>

<div id="outline-container-5-2-2-3" class="outline-5">
<h5 id="sec-5-2-2-3"><span class="section-number-5">5.2.2.3</span> 一对多关联</h5>
<div class="outline-text-5" id="text-5-2-2-3">





<pre class="src src-xml">&lt;<span style="color: #0000ff;">resultMap</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.auth.model.User</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">result</span><span style="color: #8b2252;">"</span>&gt;
  ...
  &lt;<span style="color: #0000ff;">collection</span> <span style="color: #a0522d;">property</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">addresses</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">javaType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">ArrayList</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">ofType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">Address</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">id</span> <span style="color: #a0522d;">property</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">id</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">column</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">address_id</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #0000ff;">result</span> <span style="color: #a0522d;">property</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">name</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">column</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">address_name</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #0000ff;">collection</span>&gt;
&lt;/<span style="color: #0000ff;">resultMap</span>&gt;
</pre>


<p>
在使用一对多关联时，javaType 为 ArrayList，List 中的数据类型使用 ofType 来指定。一对多关联的子查询与 association 类似。
</p>
</div>
</div>

</div>

<div id="outline-container-5-2-3" class="outline-4">
<h4 id="sec-5-2-3"><span class="section-number-4">5.2.3</span> 自动映射</h4>
<div class="outline-text-4" id="text-5-2-3">


<p>
可以不使用 resultMap 作为 O/R Mapping 的机制，采用以下方式可以直接建立对象与数据库表之间的映射：
</p>



<pre class="src src-xml">&lt;<span style="color: #0000ff;">select</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">get</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">resultType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.model.User</span><span style="color: #8b2252;">"</span>&gt;
  select
    id as "id",
    name as "name",
    passwd as "password"
  from user
  where id = #{id}
&lt;/<span style="color: #0000ff;">select</span>&gt;
</pre>


</div>
</div>

</div>

<div id="outline-container-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> MyBatis 动态 SQL 语句</h3>
<div class="outline-text-3" id="text-5-3">



</div>

<div id="outline-container-5-3-1" class="outline-4">
<h4 id="sec-5-3-1"><span class="section-number-4">5.3.1</span> 使用 _parameter</h4>
<div class="outline-text-4" id="text-5-3-1">


<p>
_parameter 表示当前传入的参数，如果查询的入参只有一个，则使用 _parameter
</p>



<pre class="src src-xml">&lt;<span style="color: #0000ff;">select</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">get</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">parameterType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">int</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">resultMap</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">userResult</span><span style="color: #8b2252;">"</span>&gt;
  select id, name, password, account from user
  where id = #{_parameter}
&lt;/<span style="color: #0000ff;">select</span>&gt;
</pre>


</div>

</div>

<div id="outline-container-5-3-2" class="outline-4">
<h4 id="sec-5-3-2"><span class="section-number-4">5.3.2</span> 模糊查询 like '%?%'</h4>
<div class="outline-text-4" id="text-5-3-2">





<pre class="src src-xml">&lt;<span style="color: #0000ff;">select</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">get</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">parameterType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.model.User</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">resultMap</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">userResult</span><span style="color: #8b2252;">"</span>&gt;
  &lt;<span style="color: #0000ff;">bind</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">pattern</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">'%' + _parameter.getName() + '%'</span><span style="color: #8b2252;">"</span> /&gt;
  select id, name, password, account from user
  where name like #{pattern}
&lt;/<span style="color: #0000ff;">select</span>&gt;
</pre>


<p>
使用 bind 标签进行字符串绑定
</p>
</div>

</div>

<div id="outline-container-5-3-3" class="outline-4">
<h4 id="sec-5-3-3"><span class="section-number-4">5.3.3</span> if 判断</h4>
<div class="outline-text-4" id="text-5-3-3">





<pre class="src src-xml">&lt;<span style="color: #0000ff;">select</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">findActiveBlogWithTitleLike</span><span style="color: #8b2252;">"</span>
     <span style="color: #a0522d;">resultType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">Blog</span><span style="color: #8b2252;">"</span>&gt;
  SELECT * FROM BLOG
  WHERE state = 'ACTIVE'
  &lt;<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">title != null</span><span style="color: #8b2252;">"</span>&gt;
    AND title like #{title}
  &lt;/<span style="color: #0000ff;">if</span>&gt;
&lt;/<span style="color: #0000ff;">select</span>&gt;
</pre>


<p>
可以加入 if 进行动态判断
</p>
</div>

</div>

<div id="outline-container-5-3-4" class="outline-4">
<h4 id="sec-5-3-4"><span class="section-number-4">5.3.4</span> switch 判断</h4>
<div class="outline-text-4" id="text-5-3-4">





<pre class="src src-xml">&lt;<span style="color: #0000ff;">select</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">findActiveBlogLike</span><span style="color: #8b2252;">"</span>
     <span style="color: #a0522d;">resultType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">Blog</span><span style="color: #8b2252;">"</span>&gt;
  SELECT * FROM BLOG WHERE state = 'ACTIVE'
  &lt;<span style="color: #0000ff;">choose</span>&gt;
    &lt;<span style="color: #0000ff;">when</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">title != null</span><span style="color: #8b2252;">"</span>&gt;
      AND title like #{title}
    &lt;/<span style="color: #0000ff;">when</span>&gt;
    &lt;<span style="color: #0000ff;">when</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">author != null and author.name != null</span><span style="color: #8b2252;">"</span>&gt;
      AND author_name like #{author.name}
    &lt;/<span style="color: #0000ff;">when</span>&gt;
    &lt;<span style="color: #0000ff;">otherwise</span>&gt;
      AND featured = 1
    &lt;/<span style="color: #0000ff;">otherwise</span>&gt;
  &lt;/<span style="color: #0000ff;">choose</span>&gt;
&lt;/<span style="color: #0000ff;">select</span>&gt;
</pre>


</div>

</div>

<div id="outline-container-5-3-5" class="outline-4">
<h4 id="sec-5-3-5"><span class="section-number-4">5.3.5</span> trim 去掉多余内容</h4>
<div class="outline-text-4" id="text-5-3-5">





<pre class="src src-xml">&lt;<span style="color: #0000ff;">trim</span> <span style="color: #a0522d;">prefix</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">WHERE</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">prefixOverrides</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">AND |OR </span><span style="color: #8b2252;">"</span>&gt;
  &lt;<span style="color: #0000ff;">if</span> ...&gt;
    AND ...
  &lt;/<span style="color: #0000ff;">if</span>&gt;
  &lt;<span style="color: #0000ff;">if</span> ...&gt;
    AND ...
  &lt;/<span style="color: #0000ff;">if</span>&gt;
  &lt;<span style="color: #0000ff;">if</span> ...&gt;
    AND ...
  &lt;/<span style="color: #0000ff;">if</span>&gt;
&lt;/<span style="color: #0000ff;">trim</span>&gt;
</pre>


<p>
该结构将在生成的 SQL 中添加 WHERE 前缀，并将 SQL 的 AND 或者 OR 前缀删除掉。等价于：
</p>



<pre class="src src-xml">&lt;<span style="color: #0000ff;">where</span>&gt;
  &lt;<span style="color: #0000ff;">if</span> ...&gt;
    AND ...
  &lt;/<span style="color: #0000ff;">if</span>&gt;
  &lt;<span style="color: #0000ff;">if</span> ...&gt;
    AND ...
  &lt;/<span style="color: #0000ff;">if</span>&gt;
  &lt;<span style="color: #0000ff;">if</span> ...&gt;
    AND ...
  &lt;/<span style="color: #0000ff;">if</span>&gt;
&lt;/<span style="color: #0000ff;">where</span>&gt;
</pre>


<p>
在更新数据时，使用以下方法：
</p>



<pre class="src src-xml">&lt;<span style="color: #0000ff;">trim</span> <span style="color: #a0522d;">prefix</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">SET</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">suffixOverrides</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">,</span><span style="color: #8b2252;">"</span>&gt;
  &lt;<span style="color: #0000ff;">if</span> ...&gt;
    account = #{account},
  &lt;/<span style="color: #0000ff;">if</span>&gt;
  &lt;<span style="color: #0000ff;">if</span> ...&gt;
    password = #{password},
  &lt;/<span style="color: #0000ff;">if</span>&gt;
  &lt;<span style="color: #0000ff;">if</span> ...&gt;
    name = #{name},
  &lt;/<span style="color: #0000ff;">if</span>&gt;
&lt;/<span style="color: #0000ff;">trim</span>&gt;
</pre>


<p>
以上结构将在生成的 SQL 中加入 SET 前缀，并将 SQL 中最后一个 , 去掉。等价于：
</p>



<pre class="src src-xml">&lt;<span style="color: #0000ff;">set</span>&gt;
  &lt;<span style="color: #0000ff;">if</span> ...&gt;
    account = #{account},
  &lt;/<span style="color: #0000ff;">if</span>&gt;
  &lt;<span style="color: #0000ff;">if</span> ...&gt;
    password = #{password},
  &lt;/<span style="color: #0000ff;">if</span>&gt;
  &lt;<span style="color: #0000ff;">if</span> ...&gt;
    name = #{name},
  &lt;/<span style="color: #0000ff;">if</span>&gt;
&lt;/<span style="color: #0000ff;">set</span>&gt;
</pre>


</div>

</div>

<div id="outline-container-5-3-6" class="outline-4">
<h4 id="sec-5-3-6"><span class="section-number-4">5.3.6</span> foreach 迭代变量</h4>
<div class="outline-text-4" id="text-5-3-6">





<pre class="src src-xml">&lt;<span style="color: #0000ff;">select</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">selectPostIn</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">resultType</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">domain.blog.Post</span><span style="color: #8b2252;">"</span>&gt;
  SELECT *
  FROM POST P
  WHERE ID in
  &lt;<span style="color: #0000ff;">foreach</span> <span style="color: #a0522d;">item</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">item</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">index</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">index</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">collection</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">list</span><span style="color: #8b2252;">"</span>
      <span style="color: #a0522d;">open</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">(</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">separator</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">,</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">close</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">)</span><span style="color: #8b2252;">"</span>&gt;
        #{item}
  &lt;/<span style="color: #0000ff;">foreach</span>&gt;
&lt;/<span style="color: #0000ff;">select</span>&gt;
</pre>


<p>
该结构可以使用 list 和 array 作为入参。入参中可以放简单对象 (String, int, long)或者 bean。
</p>
</div>
</div>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> 代码规范</h2>
<div class="outline-text-2" id="text-6">



</div>

<div id="outline-container-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> 通用规范</h3>
<div class="outline-text-3" id="text-6-1">


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">规则</th><th scope="col" class="left">说明</th></tr>
</thead>
<tbody>
<tr><td class="left">项目中的所有文件都以 UTF-8 的编码格式进行存储</td><td class="left"></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> 数据库</h3>
<div class="outline-text-3" id="text-6-2">



</div>

<div id="outline-container-6-2-1" class="outline-4">
<h4 id="sec-6-2-1"><span class="section-number-4">6.2.1</span> 命名规范</h4>
<div class="outline-text-4" id="text-6-2-1">


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">规则</th><th scope="col" class="left">举例</th></tr>
</thead>
<tbody>
<tr><td class="left">表、字段命名均以小写字母+下划线组成</td><td class="left">user, name, account, count_number</td></tr>
<tr><td class="left">如果名称与数据库关键字相同，则在名称后面添加下划线</td><td class="left">order_, group_</td></tr>
<tr><td class="left">字段名不需要添加前缀，因为表名已经限定了字段范围</td><td class="left">user_name =&gt; name, file_name =&gt; name</td></tr>
<tr><td class="left">提供 jar 包的表名，需要添加模块前缀，web 应用的表名，不需要添加特殊前缀</td><td class="left">auth_user, auth_organization 为 auth.jar 的表</td></tr>
<tr><td class="left">每个表需要加上以下字段：id, status, remark, create_by, create_time, update_by, update_time</td><td class="left">其中 create_by, update_by 是字符串类型</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-6-2-2" class="outline-4">
<h4 id="sec-6-2-2"><span class="section-number-4">6.2.2</span> 数据库的全局配置类</h4>
<div class="outline-text-4" id="text-6-2-2">


<p>
所有项目都需要提供建表语句（包括初始化数据库）和删表语句，同时项目应该提供一个全局配置类。全局配置类如下所示：
</p>



<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">AuthConfig</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">GnifPluginBase</span> {

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">Environment</span> <span style="color: #a0522d;">environment</span> = <span style="color: #008b8b;">Environment</span>.DEVELOP;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">setEnvironment</span>(<span style="color: #228b22;">Environment</span> <span style="color: #a0522d;">enviroment</span>) {
        AuthConfig.environment = enviroment;
    }

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">ModuleDefine</span> <span style="color: #0000ff;">defineModule</span>() {
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ModuleDefine</span>(<span style="color: #8b2252;">"auth"</span>, <span style="color: #8b2252;">"auth_user"</span>, <span style="color: #8b2252;">"1.0"</span>);
    }

}
</pre>


<p>
全局配置类的要求如下：
</p>
<ol>
<li>如果有数据库脚本执行，则全局配置类需要继承 GnifPluginBase
</li>
<li>全局配置类的变量均为静态变量，可以通过 set 方法设置值
</li>
<li>继承自 GnifPluginBase 的全局配置类，需要实现 defineModule 方法，该方法直接返回一个 ModuleDefine 类。参数为：
<ol>
<li>项目名称。
</li>
<li>特征表名。特征表用于判断数据库是否已经初始化，如果数据库已经初始化，则特征表是存在的；否则，特征表是不存在的
</li>
<li>数据库版本。如果项目更新时涉及到数据库表结构的更新，则需要指定新的版本号，并加入更新数据库的 SQL 代码
</li>
</ol>

</li>
</ol>


<p>
GnifPluginBase 提供了数据库更新功能。可以在 biz-context.xml 设置更新策略：
</p>



<pre class="src src-xml">&lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.gionee.gnif.GnifConfig</span><span style="color: #8b2252;">"</span>&gt;
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">databaseSchemaUpdate</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">drop-create</span><span style="color: #8b2252;">"</span> /&gt;
&lt;/<span style="color: #0000ff;">bean</span>&gt;
</pre>


<p>
可以设置的值包括：
</p>
<ul>
<li>true 发现数据库有新版本的时候，进行版本更新
</li>
<li>false 不对数据库进行版本更新
</li>
<li>create-drop 启动应用时创建表(调用create.sql)，关闭系统的时候删除表(调用drop.sql)
</li>
<li>drop-create 启动应用时先将所有表删除，再创建表
</li>
<li>create 只进行创建操作
</li>
</ul>


</div>

</div>

<div id="outline-container-6-2-3" class="outline-4">
<h4 id="sec-6-2-3"><span class="section-number-4">6.2.3</span> 初始化 SQL</h4>
<div class="outline-text-4" id="text-6-2-3">


<p>
初始化 SQL 应该放于 <b>项目目录/src/main/resource/com/gionee/项目名称/db/create/项目名称.create.项目名称.sql</b> 位置
</p>
<p>
初始化 SQL 包含三部分内容：
</p>
<ol>
<li>在 gc_property 中添加数据库版本信息
</li>
<li>所有建表语句
</li>
<li>所有初始化语句，如系统资源定义，角色定义，权限定义等
</li>
</ol>


<p>
以下为 gnif-auth 的初始化 SQL 举例：
</p>



<pre class="src src-sql">insert into gc_property_ (key_, value_) values (<span style="color: #8b2252;">'auth.version'</span>, <span style="color: #8b2252;">'1.0'</span>);

create table auth_user (
  id integer not null,
  account varchar(128) not null unique,
  password varchar(128),
  name varchar(128),
  pri_group_id integer,
  org_id integer not null,
  telephone varchar(128),
  mobile varchar(128),
  email varchar(128),
  type integer,
  status integer not null default 0,
  remark varchar(1024),
  create_by varchar(128),
  create_time datetime,
  update_by varchar(128),
  update_time datetime,
  primary key (id)
);

<span style="color: #b22222;">-- &#20854;&#23427;&#24314;&#34920;&#35821;&#21477;...</span>

insert into auth_user (id, name, account) values (1, <span style="color: #8b2252;">'&#24352;&#19977;'</span>, <span style="color: #8b2252;">'zhangsan'</span>);
insert into auth_user (id, name, account) values (2, <span style="color: #8b2252;">'&#26446;&#22235;'</span>, <span style="color: #8b2252;">'lisi'</span>);
insert into auth_user (id, name, account) values (3, <span style="color: #8b2252;">'&#29579;&#20116;'</span>, <span style="color: #8b2252;">'wangwu'</span>);

<span style="color: #b22222;">-- &#20854;&#23427;&#21021;&#22987;&#21270;&#35821;&#21477;...</span>
</pre>


</div>

</div>

<div id="outline-container-6-2-4" class="outline-4">
<h4 id="sec-6-2-4"><span class="section-number-4">6.2.4</span> 删除表 SQL</h4>
<div class="outline-text-4" id="text-6-2-4">


<p>
需要提供删除所有表结构的 SQL，该 SQL 应该放在 <b>项目目录/src/main/resource/com/gionee/项目名称/db/drop/项目名称.drop.项目名称.sql</b> 目录下。
</p>
<p>
SQL 应该包含三部分内容。
</p>
<ol>
<li>将 gc_property 中的版本删除
</li>
<li>删除所有已经建立的表结构
</li>
<li>其它表如果存在残留数据，需要删除这些残留数据
</li>
</ol>


<p>
举例如下：
</p>



<pre class="src src-sql">delete gc_property_ where key_ = <span style="color: #8b2252;">'auth.version'</span>;

if object_id(<span style="color: #8b2252;">'auth_user'</span>) is not null drop table auth_user;
if object_id(<span style="color: #8b2252;">'auth_group'</span>) is not null drop table auth_group;
if object_id(<span style="color: #8b2252;">'auth_organization'</span>) is not null drop table auth_organization;
if object_id(<span style="color: #8b2252;">'auth_user_group'</span>) is not null drop table auth_user_group;
if object_id(<span style="color: #8b2252;">'auth_resource'</span>) is not null drop table auth_resource;
if object_id(<span style="color: #8b2252;">'auth_group_resource'</span>) is not null drop table auth_group_resource;
if object_id(<span style="color: #8b2252;">'auth_pri_group'</span>) is not null drop table auth_pri_group;
if object_id(<span style="color: #8b2252;">'auth_pri_define'</span>) is not null drop table auth_pri_define;
if object_id(<span style="color: #8b2252;">'auth_privilege'</span>) is not null drop table auth_privilege;

<span style="color: #b22222;">-- &#21024;&#38500;&#20027;&#38190;&#33258;&#22686;&#35760;&#24405;</span>
delete gc_property_ where key_ = <span style="color: #8b2252;">'com.gionee.gnif.core.auth.model.User'</span>;
</pre>


</div>

</div>

<div id="outline-container-6-2-5" class="outline-4">
<h4 id="sec-6-2-5"><span class="section-number-4">6.2.5</span> 升级数据库 SQL</h4>
<div class="outline-text-4" id="text-6-2-5">


<p>
在项目已经部署到生产环境时，生产环境会产生大量数据，这个时候不能对生产环境的数据进行删除再初始化操作，只能对表结构进行更新。更新的文件应该放于： <b>项目目录/src/main/resource/com/gionee/项目名称/db/upgrade/项目名称.upgradestep.版本一.to.版本二.项目名称.sql</b> 。其中，版本一、版本二的格式为 主版本号+小版本号。如：1.0 写为 10，1.12 写为 112。版本一与版本二之间只能相隔一个版本号。举例如下：
</p>
<ul>
<li>auth.upgradestep.10.to.11.auth.sql 从初始化版本 1.0 升级到下一个版本 1.1
</li>
<li>auth.upgradestep.11.to.12.auth.sql 从第二个版本 1.1 升级到第三个版本 1.2
</li>
<li>auth.upgradestep.19.to.110.auth.sql 从版本 1.2 到 1.9 都没有数据库升级，接下来从 1.9 升级到 1.10 版本
</li>
</ul>


<p>
升级数据库之前，需要将 create.sql 及 drop.sql 先修改到最新版本，然后再写升级的 sql 脚本表示上一个版本的 create.sql 到当前版本的 create.sql 的变化。举例如下：
</p>
<p>
在 1.0 版本中，create.sql 的内容如下：
</p>



<pre class="src src-sql">insert into gc_property_ (key_, value_) values (<span style="color: #8b2252;">'auth.version'</span>, <span style="color: #8b2252;">'1.0'</span>);

create table auth_user (
  id integer not null,
  account varchar(128) not null unique,
  password varchar(128),
  name varchar(128),
  status integer not null default 0,
  remark varchar(1024),
  create_by varchar(128),
  create_time datetime,
  update_by varchar(128),
  update_time datetime,
  primary key (id)
);
</pre>


<p>
由于业务变化，开发人员增加了几个表字段，然后 create.sql 变为：
</p>



<pre class="src src-sql"><span style="color: #b22222;">-- &#23558;&#25968;&#25454;&#24211;&#29256;&#26412;&#21319;&#32423;</span>
insert into gc_property_ (key_, value_) values (<span style="color: #8b2252;">'auth.version'</span>, <span style="color: #8b2252;">'1.1'</span>);

create table auth_user (
  id integer not null,
  account varchar(128) not null unique,
  password varchar(128),
  name varchar(128),
  email varchar(128), <span style="color: #b22222;">-- &#28155;&#21152;&#37038;&#31665;</span>
  mobile varchar(128), <span style="color: #b22222;">-- &#28155;&#21152;&#25163;&#26426;</span>
  status integer not null default 0,
  remark varchar(1024),
  create_by varchar(128),
  create_time datetime,
  update_by varchar(128),
  update_time datetime,
  primary key (id)
);
</pre>


<p>
那么接下来需要在 upgrade.sql 中写入如下代码：
</p>



<pre class="src src-sql">update gc_property_ set value_ = <span style="color: #8b2252;">'1.1'</span> where key_ = <span style="color: #8b2252;">'auth.version'</span>;

alter table auth_user add email varchar(128);
alter table auth_user add mobile varchar(128);
</pre>


</div>
</div>

</div>

<div id="outline-container-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="section-number-3">6.3</span> Java 代码</h3>
<div class="outline-text-3" id="text-6-3">



</div>

<div id="outline-container-6-3-1" class="outline-4">
<h4 id="sec-6-3-1"><span class="section-number-4">6.3.1</span> 项目命名</h4>
<div class="outline-text-4" id="text-6-3-1">


<p>
创建一个项目，首先需要确认项目的简称。项目的简称只允许使用字母并且大小写不敏感。举例如下：
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">简称</th><th scope="col" class="left">说明</th></tr>
</thead>
<tbody>
<tr><td class="left">uaam</td><td class="left">User Authentication &amp; Authority Management 用户认证授权系统</td></tr>
<tr><td class="left">meta</td><td class="left">Meta 是元数据，代表元数据管理</td></tr>
<tr><td class="left">auth</td><td class="left">Authentication 认证系统</td></tr>
<tr><td class="left">metaData</td><td class="left"><b>该命名大小写敏感，不适合作为项目名称</b></td></tr>
<tr><td class="left">user_management</td><td class="left"><b>该命名有小划线，会导致名称过于复杂，不适合作为项目名称</b></td></tr>
</tbody>
</table>


<p>
有了项目命名，项目的包名就确定了： <b>com.gionee.小写项目名</b> 。如 com.gionee.uaam
</p>
</div>

</div>

<div id="outline-container-6-3-2" class="outline-4">
<h4 id="sec-6-3-2"><span class="section-number-4">6.3.2</span> 类命名</h4>
<div class="outline-text-4" id="text-6-3-2">


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">规则</th><th scope="col" class="left">说明</th></tr>
</thead>
<tbody>
<tr><td class="left">Controller, Response, Service, ServiceImpl, Dao 需要加上后缀</td><td class="left">这些类都是业务操作的基本类，加上后缀便于对业务操作进行识别和AOP操作</td></tr>
<tr><td class="left">类名应该是名词词性，接口名可以是形容词词性</td><td class="left">类表达的是对象，对象是名词，对象的动作才是动词。形容词如：Modifyable</td></tr>
<tr><td class="left">类名应该大写每个单词的首字母</td><td class="left">java 通用规范</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-6-3-3" class="outline-4">
<h4 id="sec-6-3-3"><span class="section-number-4">6.3.3</span> 属性名</h4>
<div class="outline-text-4" id="text-6-3-3">


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">规则</th><th scope="col" class="left">说明</th></tr>
</thead>
<tbody>
<tr><td class="left">属性名应该是名词词性</td><td class="left">属性表达的是对象</td></tr>
<tr><td class="left">属性应该小写首字母，多个单词之间，大写每个单词的首字母</td><td class="left">java 通用规范</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-6-3-4" class="outline-4">
<h4 id="sec-6-3-4"><span class="section-number-4">6.3.4</span> 方法名</h4>
<div class="outline-text-4" id="text-6-3-4">


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">规则</th><th scope="col" class="left">说明</th></tr>
</thead>
<tbody>
<tr><td class="left">方法名应该是动词词性</td><td class="left">方法表达的是对象的动作</td></tr>
<tr><td class="left">方法名应该小写首字母，多个单词之间，大写每个单词的首字母</td><td class="left">java 通用规范</td></tr>
<tr><td class="left">接口的方法名前面不需要加 public 指示符</td><td class="left">java 中的接口方法都是 public 的</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-6-3-5" class="outline-4">
<h4 id="sec-6-3-5"><span class="section-number-4">6.3.5</span> 注释</h4>
<div class="outline-text-4" id="text-6-3-5">


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">规则</th><th scope="col" class="left">说明</th></tr>
</thead>
<tbody>
<tr><td class="left">所有的 Service 接口都需要写注释</td><td class="left">Service 的目的是为了重用</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-6-3-6" class="outline-4">
<h4 id="sec-6-3-6"><span class="section-number-4">6.3.6</span> 代码格式</h4>
<div class="outline-text-4" id="text-6-3-6">


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">规则</th><th scope="col" class="left">说明</th></tr>
</thead>
<tbody>
<tr><td class="left">代码使用4个空格字符作为缩进</td><td class="left"></td></tr>
<tr><td class="left">关键字要放在行首</td><td class="left">通常 catch 没有放在行首，需要改一下</td></tr>
<tr><td class="left">关键字之后，要空格再写后面的代码</td><td class="left">如 if(a!=1) 要改写为 if (a!=1)</td></tr>
<tr><td class="left">左花括号不能单独起一行</td><td class="left">可以使代码比较紧凑</td></tr>
</tbody>
</table>


</div>
</div>

</div>

<div id="outline-container-6-4" class="outline-3">
<h3 id="sec-6-4"><span class="section-number-3">6.4</span> WEB 页面</h3>
<div class="outline-text-3" id="text-6-4">


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">规则</th><th scope="col" class="left">说明</th></tr>
</thead>
<tbody>
<tr><td class="left">所有 html 文件名称应该用小写字母+下划线组成</td><td class="left">如：user_info.html</td></tr>
<tr><td class="left">所有 html 文件所在目录应该用小写字母+下划线组成</td><td class="left">如：app, user</td></tr>
<tr><td class="left">html, css, js 缩进为两个空格</td><td class="left"></td></tr>
<tr><td class="left">js 类名、变量名、方法名与 java 规范一致</td><td class="left"></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-6-5" class="outline-3">
<h3 id="sec-6-5"><span class="section-number-3">6.5</span> 配置文件</h3>
<div class="outline-text-3" id="text-6-5">


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">规则</th><th scope="col" class="left">说明</th></tr>
</thead>
<tbody>
<tr><td class="left">一个应用的所有配置都需要放在 app.properties 文件中</td><td class="left"></td></tr>
<tr><td class="left">与 spring 容器相关的配置文件都以 -context.xml 结尾</td><td class="left"></td></tr>
<tr><td class="left">配置文件名称以小写字母+中划线组成</td><td class="left"></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-6-6" class="outline-3">
<h3 id="sec-6-6"><span class="section-number-3">6.6</span> 访问路径</h3>
<div class="outline-text-3" id="text-6-6">


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">规则</th><th scope="col" class="left">说明</th></tr>
</thead>
<tbody>
<tr><td class="left">所有基于 http 的访问路径由小写字母+下划线组成</td><td class="left">如：get_user.html, save_user.json</td></tr>
<tr><td class="left">一般情况下，以 html 为后缀的路径返回一个 html 页面</td><td class="left"></td></tr>
<tr><td class="left">一般情况下，以 json 为后缀的路径返回一个 json 对象</td><td class="left"></td></tr>
</tbody>
</table>


</div>
</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> 系统开发</h2>
<div class="outline-text-2" id="text-7">



</div>

<div id="outline-container-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> 项目主要阶段</h3>
<div class="outline-text-3" id="text-7-1">


<p>
基于 GNIF 的项目开发流程，可以是多样的，这里建议一种开发流程，其他的开发流程可以以此为参考：
</p>
<ol>
<li>项目设计与原型。通过项目原型来确定需求，项目原型是开发人员与业务人员都可以接受的表达方式，使用这种表达方式可以快速理解项目的目标与范围。
</li>
<li>建立模型。在理解需求之后，主要是考虑项目中涉及到的对象，以及对象之间的联系。考虑清楚这点才可以建立关系型数据库模型。
</li>
<li>编写代码。在编写代码的过程中，功能测试工作也在同时进行。
</li>
<li>集成测试。上线之前的测试。
</li>
<li>运营维护。
</li>
</ol>


<p>
以下对前两个阶段加以说明。
</p>

</div>

<div id="outline-container-7-1-1" class="outline-4">
<h4 id="sec-7-1-1"><span class="section-number-4">7.1.1</span> 项目设计与原型</h4>
<div class="outline-text-4" id="text-7-1-1">


<p>
项目设计与原型阶段主要做以下事情：
</p>
<ol>
<li>通过纸张、电脑画图等工具画出草图与业务相关人讨论解决方案。
</li>
<li>在技术上验证解决方案是否可以实施，实施的代价有多大。
</li>
</ol>


<p>
原型阶段十一个权衡的阶段，一方面要考虑尽可能解决用户需求问题，另一方面又要考虑技术上的实施代价是否值得。该阶段结束的时候，所形成的结果就是这两方面权衡的结果。这一结果通常是：用户规格说明书。用户规格说明书具体描述了所有功能点将如何做。该说明书是站在用户的角度来写的，从而不会涉及到实现的细节。用户通过该说明书了解自己为来讲如何操作具体的功能，开发人员则通过说明书知道自己要做成什么样的功能。
</p>
<p>
对于功能，开发人员可能不知道如何实现，这个时候要写一点技术说明。技术说明要告诉开发人员对于某个功能的实现方案。因为在该阶段，主要任务就是给出可行的方案，所以，对于看起来比较难以实施的功能点，需要作出技术说明。
</p>
</div>

</div>

<div id="outline-container-7-1-2" class="outline-4">
<h4 id="sec-7-1-2"><span class="section-number-4">7.1.2</span> 建立模型</h4>
<div class="outline-text-4" id="text-7-1-2">


<p>
系统开发的本质是对数据进行操作。目前 GNIF 基于 Java 这种面向对象的语言，所以在明确需求后就需要分析对象及对象之间的联系。
</p>
<p>
分析对象是指：
</p>
<ul>
<li>了解系统所涉及的名词。如，用户管理系统就包含：用户、用户组、机构等。
</li>
<li>了解对象内部的组成。如，用户包含姓名、帐号、密码等信息。
</li>
</ul>


<p>
分析对象之间的联系是指：
</p>
<ul>
<li>静态分析。了解对象之间是继承的关联还是包含的关联。
</li>
<li>动态分析。了解对象之间发送消息的先后顺序。
</li>
</ul>


<p>
有了这些分析，就可以很容易得到如数据库设计、接口设计等其他文档。
</p>
<p>
该阶段的产物是：静态类图、重要业务的时序图、数据库模型。
</p>
</div>
</div>

</div>

<div id="outline-container-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> 环境介绍</h3>
<div class="outline-text-3" id="text-7-2">


<p>
为了保证软件可以高效开发、准确测试、正常运营，GNIF 将软件项目划分为三个不同的环境：
</p>
<ul>
<li>开发环境：服务于开发人员，开发人员可以对代码，数据库进行快速修改
</li>
<li>测试环境：服务于测试人员，测试环境模拟生产环境搭建，能够尽可能暴露生产环境可能会出现的问题
</li>
<li>生产环境：服务于最终用户，生产环境的稳定性最高，项目软件需要经过充分测试之后才放到生产环境中
</li>
</ul>


</div>

</div>

<div id="outline-container-7-3" class="outline-3">
<h3 id="sec-7-3"><span class="section-number-3">7.3</span> 开发环境</h3>
<div class="outline-text-3" id="text-7-3">


<p>
开发环境由 eclipse<sup><a class="footref" name="fnr-.7" href="#fn-.7">7</a></sup>, svn<sup><a class="footref" name="fnr-.8" href="#fn-.8">8</a></sup>/git<sup><a class="footref" name="fnr-.9" href="#fn-.9">9</a></sup>, maven<sup><a class="footref" name="fnr-.10" href="#fn-.10">10</a></sup> 等工具组成。开发人员需要掌握这些开发工具。对于这些工具的基础使用方法，对于这些工具的基本使用，本文档不再赘述。本文档将选择对于开发比较重要的内容进行介绍。
</p>
</div>

</div>

<div id="outline-container-7-4" class="outline-3">
<h3 id="sec-7-4"><span class="section-number-3">7.4</span> eclipse</h3>
<div class="outline-text-3" id="text-7-4">



</div>

<div id="outline-container-7-4-1" class="outline-4">
<h4 id="sec-7-4-1"><span class="section-number-4">7.4.1</span> 使用快捷键</h4>
<div class="outline-text-4" id="text-7-4-1">


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">快捷键</th><th scope="col" class="left">说明</th></tr>
</thead>
<tbody>
<tr><td class="left">Ctrl+Shift+R</td><td class="left">查询、打开任意文件</td></tr>
<tr><td class="left">Ctrl+Shift+T</td><td class="left">查询、打开类定义文件</td></tr>
<tr><td class="left">Ctrl+Shift+O</td><td class="left">整理 Java 文件中的 import</td></tr>
<tr><td class="left">Ctrl+Alt+T</td><td class="left">重构</td></tr>
<tr><td class="left">Ctrl+Shift+Z</td><td class="left">在选择的代码外面包围 try,if 等语句</td></tr>
<tr><td class="left">Ctrl+T</td><td class="left">查看一个方法、类的继承层次结构</td></tr>
<tr><td class="left">Ctrl+O</td><td class="left">查询当前 Java 文件中的大纲结构</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-7-4-2" class="outline-4">
<h4 id="sec-7-4-2"><span class="section-number-4">7.4.2</span> 使用远程 Debug</h4>
<div class="outline-text-4" id="text-7-4-2">





<pre class="example">菜单Run -&gt; Debug Configurations -&gt; 弹出框 -&gt; Remote Java Application -&gt; 右键New
</pre>


<p>
输入名称(Name)，对应项目(Project)，远程主机(Host)，端口号(Port)
</p>
<p>
端口号就是下面说明启动参数中的 address 对应的值。
</p>
<p>
远程 Java 需要以调试模式启动，即在启动时需要加上以下参数：
</p>



<pre class="example">java -Xdebug -Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=n
</pre>


<p>
一般如 tomcat, jboss, weblogic 等服务器中会使用 JAVA<sub>OPTS</sub> 环境变量，如果要运行这类服务，可以设置该环境变量如下：
</p>
<p>
linux 下
</p>



<pre class="example">export JAVA_OPTS="$JAVA_OPTS -Xdebug -Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=n"
JAVA_OPTS="$JAVA_OPTS -Xdebug -Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=n"
</pre>


<p>
windows 下
</p>



<pre class="example">set JAVA_OPTS=%JAVA_OPTS% -Xdebug -Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=n
</pre>


<p>
maven 使用 MAVEN<sub>OPTS</sub> 参数，设置跟上面的类同。
</p>
</div>

</div>

<div id="outline-container-7-4-3" class="outline-4">
<h4 id="sec-7-4-3"><span class="section-number-4">7.4.3</span> 设置</h4>
<div class="outline-text-4" id="text-7-4-3">



</div>

<div id="outline-container-7-4-3-1" class="outline-5">
<h5 id="sec-7-4-3-1"><span class="section-number-5">7.4.3.1</span> 项目编码格式</h5>
<div class="outline-text-5" id="text-7-4-3-1">


<p>
改变整个工作空间的编码格式：
</p>



<pre class="example">菜单Window -&gt; Preferences -&gt; General -&gt; Workspace
</pre>


<p>
改变某个项目的编码格式：
</p>



<pre class="example">Project上右键 -&gt; Properties -&gt; Resource
</pre>


<p>
改变某类文件的编码格式：
</p>



<pre class="example">菜单Window -&gt; Preferences -&gt; General -&gt; Content Types 选择文件类型然后在最下面输入编码
</pre>


<p>
改变单个文件的编码格式：
</p>



<pre class="example">在文件上右键 -&gt; Properties -&gt; Resource
</pre>


</div>

</div>

<div id="outline-container-7-4-3-2" class="outline-5">
<h5 id="sec-7-4-3-2"><span class="section-number-5">7.4.3.2</span> maven</h5>
<div class="outline-text-5" id="text-7-4-3-2">


<p>
设置 maven 配置文件
</p>



<pre class="example">菜单Window -&gt; Preferences -&gt; Maven -&gt; User Settings
</pre>


<p>
设置打开 pom.xml 时，直接使用 xml 视图
</p>



<pre class="example">菜单Window -&gt; Preferences -&gt; Maven -&gt; User Interface 勾选 Open XML page in the POM editor by default
</pre>


</div>

</div>

<div id="outline-container-7-4-3-3" class="outline-5">
<h5 id="sec-7-4-3-3"><span class="section-number-5">7.4.3.3</span> jdk</h5>
<div class="outline-text-5" id="text-7-4-3-3">


<p>
如果 eclipse 中的 jdk 没有设置正确，会导致 maven 使用出错。设置 jdk 在：
</p>



<pre class="example">菜单Window -&gt; Preferences -&gt; Java -&gt; Installed JREs 中勾选 jdk1.7
</pre>


</div>
</div>
</div>

</div>

<div id="outline-container-7-5" class="outline-3">
<h3 id="sec-7-5"><span class="section-number-3">7.5</span> maven 使用</h3>
<div class="outline-text-3" id="text-7-5">



</div>

<div id="outline-container-7-5-1" class="outline-4">
<h4 id="sec-7-5-1"><span class="section-number-4">7.5.1</span> maven 原理</h4>
<div class="outline-text-4" id="text-7-5-1">


<p>
maven 是人为制订的一套开发规范，该规范定义了开发一个 java 项目时的各个细节。maven 通过 pom.xml 这一配置文件来描述一个项目。以下将介绍 pom.xml 文件及 maven 的主要概念。
</p>

</div>

<div id="outline-container-7-5-1-1" class="outline-5">
<h5 id="sec-7-5-1-1"><span class="section-number-5">7.5.1.1</span> pom.xml</h5>
<div class="outline-text-5" id="text-7-5-1-1">


<p>
POM (Project Object Model) 是对一个项目定义的模型。通过该配置文件可以完整地定义一个项目所涉及的如：项目放在哪里，项目依赖哪些东西，项目的作者是谁，项目如何构建等信息。maven 将通过该文件定义的信息对项目进行构建。
</p>
<p>
以下是 POM 文件的概要(详细内容参考：<a href="http://maven.apache.org/pom.html">http://maven.apache.org/pom.html</a>)：
</p>



<pre class="src src-xml">&lt;<span style="color: #0000ff;">project</span> <span style="color: #483d8b;">xmlns</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://maven.apache.org/POM/4.0.0</span><span style="color: #8b2252;">"</span>
  <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">xsi</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://www.w3.org/2001/XMLSchema-instance</span><span style="color: #8b2252;">"</span>
  <span style="color: #483d8b;">xsi</span>:<span style="color: #a0522d;">schemaLocation</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">http://maven.apache.org/POM/4.0.0</span>
<span style="color: #8b2252;">                      http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span style="color: #8b2252;">"</span>&gt;
  &lt;<span style="color: #0000ff;">modelVersion</span>&gt;4.0.0&lt;/<span style="color: #0000ff;">modelVersion</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#22522;&#26412;&#35774;&#32622; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">groupId</span>&gt;...&lt;/<span style="color: #0000ff;">groupId</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#25152;&#22312;&#32452;&#12289;&#26426;&#26500; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">artifactId</span>&gt;...&lt;/<span style="color: #0000ff;">artifactId</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#20135;&#21697;&#21517;&#31216; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">version</span>&gt;...&lt;/<span style="color: #0000ff;">version</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#20135;&#21697;&#29256;&#26412; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">packaging</span>&gt;...&lt;/<span style="color: #0000ff;">packaging</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#21253;&#31867;&#22411; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">dependencies</span>&gt;...&lt;/<span style="color: #0000ff;">dependencies</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#20381;&#36182;&#21253; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">parent</span>&gt;...&lt;/<span style="color: #0000ff;">parent</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#25152;&#32487;&#25215;&#30340;&#29238;&#39033;&#30446; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">dependencyManagement</span>&gt;...&lt;/<span style="color: #0000ff;">dependencyManagement</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#32487;&#25215;&#29238;&#31995;&#30340;&#20381;&#36182; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">modules</span>&gt;...&lt;/<span style="color: #0000ff;">modules</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25152;&#21253;&#21547;&#30340;&#23376;&#27169;&#22359; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">properties</span>&gt;...&lt;/<span style="color: #0000ff;">properties</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#23450;&#20041;&#21464;&#37327; </span><span style="color: #b22222;">--&gt;</span>

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#26500;&#24314;&#35774;&#32622; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">build</span>&gt;...&lt;/<span style="color: #0000ff;">build</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#25253;&#21578;&#29983;&#25104;&#35774;&#32622; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">reporting</span>&gt;...&lt;/<span style="color: #0000ff;">reporting</span>&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#26356;&#22810;&#35774;&#32622; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">name</span>&gt;...&lt;/<span style="color: #0000ff;">name</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#21517;&#31216; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">description</span>&gt;...&lt;/<span style="color: #0000ff;">description</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#25551;&#36848; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">url</span>&gt;...&lt;/<span style="color: #0000ff;">url</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#32593;&#31449; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">inceptionYear</span>&gt;...&lt;/<span style="color: #0000ff;">inceptionYear</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#36215;&#22987;&#24180;&#20221; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">licenses</span>&gt;...&lt;/<span style="color: #0000ff;">licenses</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#35768;&#21487; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">organization</span>&gt;...&lt;/<span style="color: #0000ff;">organization</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#32452;&#32455; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">developers</span>&gt;...&lt;/<span style="color: #0000ff;">developers</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#24320;&#21457;&#20154;&#21592; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">contributors</span>&gt;...&lt;/<span style="color: #0000ff;">contributors</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#39033;&#30446;&#36129;&#29486;&#32773; </span><span style="color: #b22222;">--&gt;</span>

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#29615;&#22659;&#35774;&#32622; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">issueManagement</span>&gt;...&lt;/<span style="color: #0000ff;">issueManagement</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#38382;&#39064;&#31649;&#29702; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">ciManagement</span>&gt;...&lt;/<span style="color: #0000ff;">ciManagement</span>&gt;
  &lt;<span style="color: #0000ff;">mailingLists</span>&gt;...&lt;/<span style="color: #0000ff;">mailingLists</span>&gt;
  &lt;<span style="color: #0000ff;">scm</span>&gt;...&lt;/<span style="color: #0000ff;">scm</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#20195;&#30721;&#31649;&#29702; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">prerequisites</span>&gt;...&lt;/<span style="color: #0000ff;">prerequisites</span>&gt;
  &lt;<span style="color: #0000ff;">repositories</span>&gt;...&lt;/<span style="color: #0000ff;">repositories</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25351;&#23450;&#20381;&#36182;&#21253;&#25152;&#22312;&#30340;&#20179;&#24211; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">pluginRepositories</span>&gt;...&lt;/<span style="color: #0000ff;">pluginRepositories</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25351;&#23450;&#25554;&#20214;&#25152;&#22312;&#30340;&#20179;&#24211; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">distributionManagement</span>&gt;...&lt;/<span style="color: #0000ff;">distributionManagement</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25351;&#23450;&#21457;&#24067;&#20301;&#32622; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">profiles</span>&gt;...&lt;/<span style="color: #0000ff;">profiles</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#38024;&#23545;&#19981;&#21516;&#30340;&#29615;&#22659;&#20351;&#29992;&#19981;&#21516;&#30340;&#37197;&#32622;&#65292;&#22914;&#24320;&#21457;&#19982;&#29983;&#20135;&#29615;&#22659;&#30340;&#25968;&#25454;&#24211;&#26159;&#19981;&#21516;&#30340; </span><span style="color: #b22222;">--&gt;</span>
&lt;/<span style="color: #0000ff;">project</span>&gt;
</pre>


<p>
从概要可以看到 maven 可以做代码管理，代码测试报告，项目网站，项目依赖关系等管理。
</p>
</div>

</div>

<div id="outline-container-7-5-1-2" class="outline-5">
<h5 id="sec-7-5-1-2"><span class="section-number-5">7.5.1.2</span> maven 运作</h5>
<div class="outline-text-5" id="text-7-5-1-2">





<pre class="example">sample
|   pom.xml         项目定义文件
\---src             项目源文件
    +---main          项目主文件
    \---test          项目测试文件
</pre>


<p>
一个 maven 项目的目录结构如上所示，maven 通过项目定义文件(pom.xml)来对项目的源文件进行操作。源文件包含两部分，一部分是最终能够提供功能的主要文件(main)，另一部分是用于测试主要功能的辅助文件(test)。
</p>
<p>
maven 程序的整个操作就是根据项目定义文件中的定义对源文件进行操作。maven 在 components.xml 文件中定义了一个项目的三种生命周期。每种生命周期有不同的阶段((详细参考 <a href="http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Lifecycle_Reference">http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Lifecycle_Reference</a>))。
</p>
<p>
<img src="lifecicle.png"  alt="lifecicle.png" />
</p>
<p>
maven 的每个生命周期定义了不同的阶段，每个阶段都可以设置该阶段所使用的插件及插件中的任务。以下通过 maven 命令来举例说明：
</p>



<pre class="example"># 将项目设置到默认生命周期的 deploy 阶段
# 这将使源码已经被编译、测试、安装及发布
mvn deploy

# 直接通过 maven 运行 clean 插件的 clean 任务
mvn clean:clean

# 先将项目设置到清理生命周期(clean)
# 然后将项目设置到默认生命周期的编译阶段(compile)
# 最后运行 jetty 插件的 run 任务
mvn clean compile jetty:run
</pre>


<p>
通过下面的配置（取自 components.xml ）可以了解到一个生命周期是如何定义的，并且生命周期的每个阶段会执行哪些 plugin 的任务。
</p>



<pre class="src src-xml">&lt;<span style="color: #0000ff;">component</span>&gt;
  &lt;<span style="color: #0000ff;">role</span>&gt;org.apache.maven.lifecycle.Lifecycle&lt;/<span style="color: #0000ff;">role</span>&gt;
  &lt;<span style="color: #0000ff;">implementation</span>&gt;org.apache.maven.lifecycle.Lifecycle&lt;/<span style="color: #0000ff;">implementation</span>&gt;
  &lt;<span style="color: #0000ff;">role-hint</span>&gt;site&lt;/<span style="color: #0000ff;">role-hint</span>&gt;
  &lt;<span style="color: #0000ff;">configuration</span>&gt;
    &lt;<span style="color: #0000ff;">id</span>&gt;site&lt;/<span style="color: #0000ff;">id</span>&gt;
    &lt;<span style="color: #0000ff;">phases</span>&gt;<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> site &#29983;&#21629;&#21608;&#26399;&#21253;&#25324;&#21738;&#20123;&#38454;&#27573; </span><span style="color: #b22222;">--&gt;</span>
      &lt;<span style="color: #0000ff;">phase</span>&gt;pre-site&lt;/<span style="color: #0000ff;">phase</span>&gt;
      &lt;<span style="color: #0000ff;">phase</span>&gt;site&lt;/<span style="color: #0000ff;">phase</span>&gt;
      &lt;<span style="color: #0000ff;">phase</span>&gt;post-site&lt;/<span style="color: #0000ff;">phase</span>&gt;
      &lt;<span style="color: #0000ff;">phase</span>&gt;site-deploy&lt;/<span style="color: #0000ff;">phase</span>&gt;
    &lt;/<span style="color: #0000ff;">phases</span>&gt;
    &lt;<span style="color: #0000ff;">default-phases</span>&gt;
      &lt;<span style="color: #0000ff;">site</span>&gt;<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> site &#38454;&#27573;&#20351;&#29992; site-plugin &#30340; site &#20219;&#21153; </span><span style="color: #b22222;">--&gt;</span>
        org.apache.maven.plugins:maven-site-plugin:2.0.1:site
      &lt;/<span style="color: #0000ff;">site</span>&gt;
      &lt;<span style="color: #0000ff;">site-deploy</span>&gt;
        org.apache.maven.plugins:maven-site-plugin:2.0.1:deploy
      &lt;/<span style="color: #0000ff;">site-deploy</span>&gt;
    &lt;/<span style="color: #0000ff;">default-phases</span>&gt;
  &lt;/<span style="color: #0000ff;">configuration</span>&gt;
&lt;/<span style="color: #0000ff;">component</span>&gt;
</pre>


</div>

</div>

<div id="outline-container-7-5-1-3" class="outline-5">
<h5 id="sec-7-5-1-3"><span class="section-number-5">7.5.1.3</span> maven 网络结构</h5>
<div class="outline-text-5" id="text-7-5-1-3">


<p>
<img src="organize.png"  alt="organize.png" />
</p>
<p>
maven 会将所有的公共 jar 包放置于公共的中心仓库（Center Repository）中。为了提高速度，各个网站会复制一份中心仓库的内容并且与中心仓库保持同步。这些复制的仓库称为镜像（Mirror）。在本地的电脑上，会有一个本地仓库，maven 根据项目的依赖关系从中心仓库或者镜像中下载所需要的 jar 包到本地仓库中，供不同的项目使用。
</p>
</div>
</div>

</div>

<div id="outline-container-7-5-2" class="outline-4">
<h4 id="sec-7-5-2"><span class="section-number-4">7.5.2</span> maven 环境搭建</h4>
<div class="outline-text-4" id="text-7-5-2">


<p>
新版 eclipse 中已经内置安装了 maven 插件。可以通过以下方式添加常用 maven 命令：
</p>



<pre class="example">菜单Run -&gt; Run Configurations -&gt; 弹出框 -&gt; Maven Build -&gt; 右键New
</pre>


<p>
设置名称(Name)，运行目录(Base directory)，目标(Goal)，配置文件(Profiles)
</p>
<p>
可以将更新快照版本(Update Snapshots)选项勾选上，这样，在开发过程中的 jar 包更新后，就可以立即使用最新版本的依赖 jar 包。
</p>
<p>
其中，目标(Goal)就是 maven 的命令，通常包含以下命令：
</p>



<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21024;&#38500;&#20043;&#21069;&#30340; eclipse &#39033;&#30446;&#25991;&#20214;&#65292;&#20877;&#29983;&#25104;&#26032;&#30340; eclipse &#39033;&#30446;&#25991;&#20214;</span>
eclipse:clean eclipse:eclipse

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36816;&#34892; maven &#39033;&#30446;</span>
clean jetty:run
</pre>


</div>
</div>

</div>

<div id="outline-container-7-6" class="outline-3">
<h3 id="sec-7-6"><span class="section-number-3">7.6</span> svn 使用</h3>
<div class="outline-text-3" id="text-7-6">


<p>
在 Eclipse 下没有集成 SVN 插件，可以通过 Eclipse 软件更新来安装 SVN 插件。关于 SVN 的基本使用可以通过网络资源学习。以下介绍 SVN 中常见的特殊用法：
</p>

</div>

<div id="outline-container-7-6-1" class="outline-4">
<h4 id="sec-7-6-1"><span class="section-number-4">7.6.1</span> 放弃最近的修改</h4>
<div class="outline-text-4" id="text-7-6-1">


<p>
在开发过程中，会遇到近期修改的内容需要完全放弃，这个时候，需要从之前的某个版本开始重新写代码。也就是说，需要让 SVN 合并（merge）到之前的版本。
</p>
<p>
在项目的目录视图中选择需要恢复的资源点右键：
</p>



<pre class="example">Team -&gt; Merge -&gt; 弹出框 -&gt; 1. 设置URL，2. 设置Revision -&gt; OK
</pre>


</div>

</div>

<div id="outline-container-7-6-2" class="outline-4">
<h4 id="sec-7-6-2"><span class="section-number-4">7.6.2</span> 分支版本及标签</h4>
<div class="outline-text-4" id="text-7-6-2">


<p>
在开发过程中，遇到如，不同平台的代码有所区别；已经发布的版本需要临时保留等问题。这样就需要使用分支版本或者标签的方式来完成。
</p>
<p>
在项目的目录视图中选择需要恢复的资源点右键：
</p>



<pre class="example">Team -&gt; Branch -&gt; 输入Branch名称 -&gt; OK
</pre>



<pre class="example">Team -&gt; Tag -&gt; 输入Tag名称 -&gt; OK
</pre>


</div>

</div>

<div id="outline-container-7-6-3" class="outline-4">
<h4 id="sec-7-6-3"><span class="section-number-4">7.6.3</span> 查看版本提交历史</h4>
<div class="outline-text-4" id="text-7-6-3">


<p>
如果需要知道自己或者其他开发人员什么时候提交了什么内容，可以查询 SVN 版本提交历史来获取这方面的信息。
</p>
<p>
在项目的目录视图中选择需要恢复的资源点右键：
</p>



<pre class="example">Team -&gt; History
</pre>


<p>
之后会唤出 History 窗口，可以在 History 窗口查看各版本由谁提交，提交了什么内容，任意两个版本之间的差异对比等信息。
</p>
</div>
</div>

</div>

<div id="outline-container-7-7" class="outline-3">
<h3 id="sec-7-7"><span class="section-number-3">7.7</span> git 使用</h3>
<div class="outline-text-3" id="text-7-7">


<p>
新版 Eclipse 默认已经安装了 Git 插件。Git 是未来配置管理的主流。GNIF 当前采用 SVN 进行配置管理。因而暂时不对 Git 进行详细说明。
</p>
</div>

</div>

<div id="outline-container-7-8" class="outline-3">
<h3 id="sec-7-8"><span class="section-number-3">7.8</span> firebug 使用</h3>
<div class="outline-text-3" id="text-7-8">


<p>
对于 Web 开发人员而言，推荐使用 Firefox 浏览器进行 Web 端的代码调试。可以使用 firefox 下的插件 firebug。
</p>

</div>

<div id="outline-container-7-8-1" class="outline-4">
<h4 id="sec-7-8-1"><span class="section-number-4">7.8.1</span> 运行 javascript 代码</h4>
<div class="outline-text-4" id="text-7-8-1">


<p>
在控制台(Console)面板下可以输入 javascript 代码运行。firebug 提供了智能补充代码的功能。对于 jQuery 对象，可以识别它的成员方法。
</p>
</div>

</div>

<div id="outline-container-7-8-2" class="outline-4">
<h4 id="sec-7-8-2"><span class="section-number-4">7.8.2</span> 查看所有网络传输数据</h4>
<div class="outline-text-4" id="text-7-8-2">


<p>
在网络(Net)面板下可以查看所有的网络通信数据。在调试代码的时候，需要知道 post/get 了哪些数据，则可以在该面板下查看。
</p>
</div>

</div>

<div id="outline-container-7-8-3" class="outline-4">
<h4 id="sec-7-8-3"><span class="section-number-4">7.8.3</span> 动态调整 css</h4>
<div class="outline-text-4" id="text-7-8-3">


<p>
在样式(Style)面板下可以修改全局新式，修改后的样式可以直接反馈在 firefox 的页面上。使用该功能可以很快调试出满意的 css，然后将 css 拷贝到源文件中去。
</p>
</div>

</div>

<div id="outline-container-7-8-4" class="outline-4">
<h4 id="sec-7-8-4"><span class="section-number-4">7.8.4</span> 动态调整 html 元素</h4>
<div class="outline-text-4" id="text-7-8-4">


<p>
在 HTML 面板可以查看、编辑当前页面的 DOM 结构。可以对页面的 DOM 元素设置其属性，添加，删除 DOM 元素。所做的操作可以即时反馈在 firefox 页面上。在操作完之后，可以了解具体的 HTML 代码应该怎么去写，然后将 HTML 代码写入源文件中。
</p>
</div>
</div>
</div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> 系统测试</h2>
<div class="outline-text-2" id="text-8">



</div>

<div id="outline-container-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> 功能测试与集成测试</h3>
<div class="outline-text-3" id="text-8-1">


<p>
在开发过程中，测试可以及时介入，这样可以保证软件的问题可以及早被发现。根据环境的不同，测试可以分为两类：
</p>
<ul>
<li>开发测试：在开发环境的测试。在开发环境测试可以加快发现功能性问题的速度。可以快速将功能性问题反馈给开发人员，以便让开发人员修改。
</li>
<li>集成测试：在测试环境的测试。测试环境是准生产环境，此时的测试更加倾向于测试应用与环境的兼容性。
</li>
</ul>


<p>
在测试的时候，如果将代码移到测试环境进行功能测试，则会延长开发时间。所以建议在开发的时候就能够进行功能测试。在进行集成测试的时候，主要测试的点在于：
</p>
<ul>
<li>数据库初始化给应用带来的影响
</li>
<li>新的软硬件环境给应用带来的影响
</li>
<li>多个用户使用时，权限控制得如何
</li>
<li>大量用户访问时，应用是否可以及时响应
</li>
</ul>


</div>

</div>

<div id="outline-container-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> 快速发布版本</h3>
<div class="outline-text-3" id="text-8-2">


<p>
为了能够让测试人员能够对功能进行测试，需要快速发布版本。以下是 linux 下的版本发布脚本代码：
</p>



<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">sh</span>

<span style="color: #a0522d;">PROJ</span>=cas
<span style="color: #a0522d;">PROD</span>=auth

<span style="color: #0000ff;">stop</span> () {
    ps ax | grep app/$<span style="color: #a0522d;">PROJ</span> | awk <span style="color: #8b2252;">'/java/ {print $1}'</span> | xargs -n 1 kill -9
}

<span style="color: #0000ff;">start</span> () {
    <span style="color: #483d8b;">cd</span> /data/app/$<span style="color: #a0522d;">PROJ</span>/bin
    ./startup.sh
}

<span style="color: #0000ff;">deploy</span> () {
    <span style="color: #a020f0;">if</span> [ $<span style="color: #a0522d;">#</span> != 1 ]; <span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">PROJ</span> deploy VERSION
        <span style="color: #a020f0;">exit</span>
    <span style="color: #a020f0;">fi</span>
    <span style="color: #a020f0;">if</span> [ ! -d /data/ftp/$<span style="color: #a0522d;">PROD</span>/ssyt_$<span style="color: #a0522d;">1</span> ]; <span style="color: #a020f0;">then</span>
        mkdir -p /data/ftp/$<span style="color: #a0522d;">PROD</span>/ssyt_$<span style="color: #a0522d;">1</span>
    <span style="color: #a020f0;">fi</span>
    <span style="color: #483d8b;">cd</span> /data/project/$<span style="color: #a0522d;">PROJ</span>
    cp target/$<span style="color: #a0522d;">PROJ</span>.war /data/ftp/$<span style="color: #a0522d;">PROD</span>/ssyt_$<span style="color: #a0522d;">1</span>/$<span style="color: #a0522d;">PROD</span>-ssyt_$<span style="color: #a0522d;">1</span>-<span style="color: #ff00ff;">`date +%Y%m%d%H%M%S`</span>_<span style="color: #ff00ff;">`svn st -u | awk '{print $4}'`</span>.war
}

<span style="color: #0000ff;">patch</span> () {
    <span style="color: #a020f0;">if</span> [ $<span style="color: #a0522d;">#</span> != 2 ]; <span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">PROJ</span> patch VERSION NUMBER
        <span style="color: #a020f0;">exit</span>
    <span style="color: #a020f0;">fi</span>
    <span style="color: #a020f0;">if</span> [ ! -d /data/ftp/$<span style="color: #a0522d;">PROD</span>/ssyt_$<span style="color: #a0522d;">1</span> ]; <span style="color: #a020f0;">then</span>
        mkdir -p /data/ftp/$<span style="color: #a0522d;">PROD</span>/ssyt_$<span style="color: #a0522d;">1</span>
    <span style="color: #a020f0;">fi</span>
    <span style="color: #483d8b;">cd</span> /data/project/$<span style="color: #a0522d;">PROJ</span>/target/$<span style="color: #a0522d;">PROJ</span>
    zip -r /data/ftp/$<span style="color: #a0522d;">PROD</span>/ssyt_$<span style="color: #a0522d;">1</span>/$<span style="color: #a0522d;">PROD</span>-ssyt_$<span style="color: #a0522d;">1</span>-patch_$<span style="color: #a0522d;">2</span>-<span style="color: #ff00ff;">`date +%Y%m%d%H%M%S`</span>_<span style="color: #ff00ff;">`svn info ../.. | awk '/^Revision:/ {print $2}'`</span>.zip *
}

<span style="color: #0000ff;">trace</span> () {
    tail -f /data/app/$<span style="color: #a0522d;">PROJ</span>/logs/catalina.out
}

<span style="color: #0000ff;">update</span> () {
    <span style="color: #483d8b;">cd</span> /data/project/$<span style="color: #a0522d;">PROJ</span>
    svn up $<span style="color: #a0522d;">1</span>
    mvn -U clean compile war:war -P test
    rm -rf /data/app/$<span style="color: #a0522d;">PROJ</span>/webapps/$<span style="color: #a0522d;">PROJ</span>*
    cp target/$<span style="color: #a0522d;">PROJ</span>.war /data/app/$<span style="color: #a0522d;">PROJ</span>/webapps/$<span style="color: #a0522d;">PROJ</span>.war
}

<span style="color: #a020f0;">case</span> <span style="color: #8b2252;">"$1"</span><span style="color: #a020f0;"> in</span>
    start)
        start
        trace
        ;;
    stop)
        stop
        ;;
    restart)
        stop
        start
        trace
        ;;
    reload)
        stop
        update $<span style="color: #a0522d;">2</span>
        start
        trace
        ;;
    deploy)
        deploy $<span style="color: #a0522d;">2</span>
        ;;
    patch)
        patch $<span style="color: #a0522d;">2</span> $<span style="color: #a0522d;">3</span>
        ;;
    log)
        trace
        ;;
    *)
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$PROJ (start|stop|restart|reload|deploy|patch|log)"</span>
        ;;
<span style="color: #a020f0;">esac</span>
</pre>


<p>
该脚本有以下命令：
</p>
<ul>
<li>start 启动 tomcat 服务
</li>
<li>stop 关闭 tomcat 服务
</li>
<li>restart 重启 tomcat 服务
</li>
<li>reload 从 svn 上取出最新版本的源代码，打包部署到 tomcat 上，并启动 tomcat
</li>
<li>deploy 将完成功能测试的应用发布到 ftp 服务器上
</li>
<li>patch 将完成功能测试的应用打补丁包到 ftp 服务器上
</li>
<li>log 查看应用的输出日志
</li>
</ul>


<p>
可以使用该脚本进行软件更新测试及版本发布。
</p>
</div>
</div>

</div>

<div id="outline-container-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> 系统部署</h2>
<div class="outline-text-2" id="text-9">



</div>

<div id="outline-container-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> 包命名规范</h3>
<div class="outline-text-3" id="text-9-1">



</div>

<div id="outline-container-9-1-1" class="outline-4">
<h4 id="sec-9-1-1"><span class="section-number-4">9.1.1</span> 全量文件</h4>
<div class="outline-text-4" id="text-9-1-1">





<pre class="example">[部署包名]-[版本号]-[时间戳]_[SVN版本号].war
</pre>


<p>
如：eoa-v1_0-20140326140853_43.war
</p>
</div>

</div>

<div id="outline-container-9-1-2" class="outline-4">
<h4 id="sec-9-1-2"><span class="section-number-4">9.1.2</span> 补丁包文件</h4>
<div class="outline-text-4" id="text-9-1-2">





<pre class="example">[部署包名]-[版本号]-[补丁版本号]-[时间戳]_[SVN版本号].zip
</pre>


<p>
如：eoa-v1_0-patch_1r-20140327141419_46.zip
</p>
<p>
其中，补丁版本号的格式如下：
</p>
<ul>
<li>patch_#r：最后一位 r，表示该补丁打上后需要重启系统
</li>
<li>patch_#u：最后一位 u，表示该补丁打上后不需要重启系统
</li>
</ul>


</div>
</div>

</div>

<div id="outline-container-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> 配置文件</h3>
<div class="outline-text-3" id="text-9-2">


<p>
部署过程中需要关注的配置文件是位于 classes 目录下的 properties 文件。这里的配置文件在不同的环境，内容有所不同。目前主要介绍 app.properties 与 log4j.properties 两个配置文件。
</p>

</div>

<div id="outline-container-9-2-1" class="outline-4">
<h4 id="sec-9-2-1"><span class="section-number-4">9.2.1</span> app.properties</h4>
<div class="outline-text-4" id="text-9-2-1">


<p>
该配置文件是应用的通用配置文件。所有与应用相关的特殊配置，都在该配置文件中进行配置。目前，该配置文件有一些公共配置如下：
</p>



<pre class="src src-properties"># &#25968;&#25454;&#24211;&#37197;&#32622;
jdbc.driverClassName=com.microsoft.sqlserver.jdbc.SQLServerDriver
jdbc.url=jdbc:sqlserver://192.168.0.X:1433;DatabaseName=XXXX
jdbc.username=sa
jdbc.password=******

# &#35748;&#35777;&#20013;&#24515;&#37197;&#32622;
cas.login.url=http://192.168.0.96/cas/login
cas.logout.url=http://192.168.0.96/cas/logout
cas.auth.url=http://192.168.0.96/cas

# &#39033;&#30446;&#26681;&#30446;&#24405;
base.path=http://localhost:8080/css/
</pre>


<p>
通常一个项目都会包含以上内容。
</p>
</div>

</div>

<div id="outline-container-9-2-2" class="outline-4">
<h4 id="sec-9-2-2"><span class="section-number-4">9.2.2</span> log4j.properties</h4>
<div class="outline-text-4" id="text-9-2-2">


<p>
该配置文件主要用于测试和生产环境中对日志记录的输出。具体配置可以参考集成层有关日志记录一章的介绍。
</p>
<p>
建议在日志输出级别控制策略上，按以下规则进行配置：
</p>
<ul>
<li>项目运行早期：将输出级别设置为 DEBUG 级别
</li>
<li>项目稳定运行时期：将输出级别设置为 INFO 级别
</li>
</ul>


<p>
项目运行早期，通常会遇到各种出错的可能。出错时，需要通过日志进行错误跟踪。如果将日志输出级别设置得太高，则会加大问题的排错难度。在项目稳定运行一段时间（通常是稳定运行半年）之后，再将日志输出级别设置为高级别。以免增加运行开销。
</p>
</div>
</div>
</div>

</div>

<div id="outline-container-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> 开发工具介绍</h2>
<div class="outline-text-2" id="text-10">



</div>

<div id="outline-container-10-1" class="outline-3">
<h3 id="sec-10-1"><span class="section-number-3">10.1</span> WEB应用开发工具</h3>
<div class="outline-text-3" id="text-10-1">


<p>
任意一个基于 GNIF 的项目，都可以使用 WEB 开发工具协助开发。WEB 开发工具的项目名为： devtool。启动项目后，输入 <a href="http://localhost:8080/dev/index.html">http://localhost:8080/dev/index.html</a> 即可打开 WEB 开发工具界面。
</p>
<p>
开发人员可以使用这个开发工具进行如下操作：
</p>
<ul>
<li>业务对象：将数据库中的对象生成业务对象。业务对象可以用于生成代码。
</li>
<li>对象明细：记录所有业务对象，在该页面可以生成各种代码
</li>
<li>功能模块：在应用开发的时候用于维护菜单、按钮等系统资源
</li>
<li>特权定义：在应用开发的时候用于维护特殊权限定义
</li>
<li>用户授权：在开发过程中用于对用户进行管理，包括组织架构调整，授权等
</li>
<li>数据库管理：用于查看当前系统所使用的数据库表结构，字段等
</li>
<li>初始化SQL：用于生成功能模块及特权定义的初始化SQL
</li>
</ul>


</div>

</div>

<div id="outline-container-10-2" class="outline-3">
<h3 id="sec-10-2"><span class="section-number-3">10.2</span> 功能模块的设置</h3>
<div class="outline-text-3" id="text-10-2">


<p>
功能模块对应于系统所有可以使用的资源。如，菜单、页面、按钮等，都可以在功能模块处定义。功能模块的定义需要填写以下字段信息：
</p>
<ul>
<li>类型：
<ul>
<li>菜单：是页面及子菜单的容器，没有拦截的URL地址
</li>
<li>页面：点击后可以直接访问一个页面
</li>
<li>按钮：对应于页面中的操作
</li>
</ul>

</li>
<li>名称(name)：可以填写菜单命名、页面命名、按钮命名等
</li>
<li>编码：用于指定特定资源的编码，可以直接通过编码来获取该资源
</li>
<li>排序：用于指定展现顺序
</li>
<li>操作方法(action)：对于页面（访问路径），按钮（JS函数）进行额外的设置
</li>
<li>拦截地址(url)：指定该资源对应的拦截地址。举例如下：
<ul>
<li><i>a/** 拦截 /a</i> 下的所有操作
</li>
<li>/a/b.html 拦截 /a/b.html
</li>
</ul>

</li>
<li>图标(icon)：资源对应的图标，在显示按钮，菜单，页面的时候可以使用这里设置的图标
</li>
</ul>


</div>

</div>

<div id="outline-container-10-3" class="outline-3">
<h3 id="sec-10-3"><span class="section-number-3">10.3</span> 代码生成</h3>
<div class="outline-text-3" id="text-10-3">


<p>
代码生成是开发工具的主要组成部分。本部分内容介绍三层的代码生成。从代码的依赖关系来讲，前端的代码依赖后端代码，在生成代码时请按照以下顺序进行。
</p>

</div>

<div id="outline-container-10-3-1" class="outline-4">
<h4 id="sec-10-3-1"><span class="section-number-4">10.3.1</span> 集成层</h4>
<div class="outline-text-4" id="text-10-3-1">


<p>
首先，要生成业务对象。即 model 中的对象。因为所有的代码都是围绕业务对象而操作的。业务对象可以通过“业务对象”功能进行管理。在“业务对象”功能中，可以添加系统中需要用到的对象。比如，一个物料借还系统会涉及到以下业务对象：
</p>
<ul>
<li>物料
</li>
<li>仓库
</li>
</ul>


<p>
因而，可以在这里添加这两个业务对象。如果已经有建立业务对象的表，可以通过表直接生成业务对象。
</p>
<p>
创建完业务对象之后，可以对每个业务对象进行明确定义。定义的操作在“对象明细”功能中进行。在“对象明细”中选择一个业务对象，然后定义它的各个字段以及字段与数据库之间的对应关系。接下来就可以生成业务对象。通过点击 <b>生成实体类</b> 就可以生成当前的业务对象。
</p>
<p>
在集成层中，主要是对业务对象的持久化的相关操作，也就是说，要生成 Dao。在 <b>生成Dao方法</b> 上，可以选择需要生成的方法。包括以下：
</p>
<ul>
<li>insert: 插入一条新的记录到数据库。
</li>
<li>update: 更新一条记录到数据库。
</li>
<li>delete: 删除多条记录。
</li>
<li>getAll: 查询所有记录。如果在属性上勾选了一项，会生成 getAllByXxxxx() 方法。
</li>
<li>getPage: 分页查询所有记录。如果在属性上勾选了一项，会生成 getPageByXxxxx() 方法。
</li>
<li>get: 查询单条记录，默认是按ID查询。如果在属性上勾选了一项，会生成 getByXxxxx() 方法。
</li>
</ul>


</div>

</div>

<div id="outline-container-10-3-2" class="outline-4">
<h4 id="sec-10-3-2"><span class="section-number-4">10.3.2</span> 应用层</h4>
<div class="outline-text-4" id="text-10-3-2">


<p>
在应用层，主要是生成服务相关的类和方法。在 <b>生成Service方法</b> 上，可以选择生成不同的 Service 方法：
</p>
<ul>
<li>保存(save): 生成持久化一个对象的方法。
</li>
<li>通过ID获取对象(get)：生成获取一个对象的方法。
</li>
<li>物理删除(delete)：生成一个删除对象的方法，该方法直接使用 delete 将对象删除。
</li>
<li>逻辑删除(delete)：生成一个删除对象的方法，该方法使用 update 将对象的 status 修改为删除状态(-1)
</li>
<li>查询(query)：生成查询对象的方法。
</li>
<li>分页查询(queryPage)：生成分页查询对象的方法，该方法返回一个PageResult。
</li>
</ul>


</div>

</div>

<div id="outline-container-10-3-3" class="outline-4">
<h4 id="sec-10-3-3"><span class="section-number-4">10.3.3</span> 展现层</h4>
<div class="outline-text-4" id="text-10-3-3">


<p>
在展现层可以生成两类代码：一类是用于展现视图的 View、Controller 代码，另外一类是生成 JSON 返回值的 Response 代码。
</p>
<p>
之所以要生成 Response 代码，而不是把 model 中的对象直接返回给客户端，其原因在 3.6 节进行了说明。要生成 Response 类，需要将返回的字段勾选上，然后点击 <b>生成响应类</b> 即可。
</p>
<p>
对于展现视图的 View、Controller 代码，则需要在“功能模块”功能下进行操作。在定义一个页面的时候，需要指定其操作方法为一个URL地址。如，一个站点管理的页面地址应该是：
</p>



<pre class="example">/site.html
</pre>


<p>
或者如果有好几个页面都放在一个功能模块之下。如，站点管理、资源管理、系统设置等都可以放在基础数据下，则各自的URL应该如下：
</p>



<pre class="example">/base/site.html
/base/resource.html
/base/system_setting.html
</pre>


<p>
设定好页面之后，在功能菜单之中点击页面，就可以生成页面的操作按钮了。可以选择的按钮包括：
</p>
<ul>
<li>新增按钮：新添加一条记录。
</li>
<li>编辑按钮：编辑记录。
</li>
<li>保存按钮：保存新添加的或编辑的记录。
</li>
<li>删除按钮：删除选择的记录。
</li>
</ul>


<p>
这里生成的是只是最简单的增删改功能，需要开发人员针对业务进行完善。
</p>
</div>
</div>
</div>

</div>

<div id="outline-container-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> 核心系统介绍</h2>
<div class="outline-text-2" id="text-11">



</div>

<div id="outline-container-11-1" class="outline-3">
<h3 id="sec-11-1"><span class="section-number-3">11.1</span> 核心系统关联</h3>
<div class="outline-text-3" id="text-11-1">


<p>
以下是核心系统的关联图：
</p>
<p>
<img src="sysrel.png"  alt="sysrel.png" />
</p>
<p>
关联图中，AUTH 是用户认证中心，所有的系统都通过 AUTH 进行用户认证操作。认证过的用户在登录其他系统的时候不再需要输入用户名、密码进行认证。
</p>
<p>
UAAM 是用户认证与授权系统，用于设置全部系统所有用户的认证信息与授权信息。认证信息用于用户登录，授权信息用于控制用户可以访问的资源。UAAM 限于内部用户访问。
</p>
<p>
EOA 是用户登录成功后默认的系统。UUAM 显示所有当前用户可以访问的子系统，用户可以通过 EOA 快速访问已经被授权访问的系统。EOA 目前只对内部用户开放。
</p>
<p>
BIZ-1、BIZ-2 是业务系统，用户所需要做的业务都由这些业务系统提供。这些业务系统如果被授权访问的话，用户可以在 EOA 上看到这些系统。
</p>
</div>

</div>

<div id="outline-container-11-2" class="outline-3">
<h3 id="sec-11-2"><span class="section-number-3">11.2</span> 用户核心操作时序图</h3>
<div class="outline-text-3" id="text-11-2">


<p>
了解以下时序图，有助于在开发过程中识别问题。
</p>
<p>
以下是用户登录的时序图：
</p>
<p>
<img src="sequence.png"  alt="sequence.png" />
</p>
<ol>
<li>用户访问系统 SYS
</li>
<li>SYS 检查当前用户没有 Session 并且不具备访问当前服务的票据，将用户重定向到 AUTH
</li>
<li>用户访问 AUTH 并完成登录操作
</li>
<li>AUTH 将用户重定向到 SYS 并在 URL 中带上票据
</li>
<li>用户再次访问 SYS 系统
</li>
<li>SYS 检查当前用户的 Session 不存在，于是使用票据向 AUTH 确认
</li>
<li>AUTH 确认用户已经认证且授权访问 SYS
</li>
<li>AUTH 返回用户信息给 SYS
</li>
<li>SYS 在当前系统中取得用户权限信息放于 Session 中
</li>
<li>SYS 将主页面返回给用户
</li>
</ol>


<p>
用户认证成功后的时序图与登录时序图类似，但在第 3、4 步的时候有所不同：
</p>
<ol>
<li>用户访问系统 SYS
</li>
<li>SYS 检查当前用户没有 Session 并且不具备访问当前服务的票据，将用户重定向到 AUTH
</li>
<li>用户访问 AUTH
</li>
<li>AUTH 检查到用户已经认证过，于是直接将用户重定向到 SYS 并在 URL 中带上票据
</li>
<li>用户再次访问 SYS 系统
</li>
<li>SYS 检查当前用户的 Session 不存在，于是使用票据向 AUTH 确认
</li>
<li>AUTH 确认用户已经认证且授权访问 SYS
</li>
<li>AUTH 返回用户信息给 SYS
</li>
<li>SYS 在当前系统中取得用户权限信息放于 Session 中
</li>
<li>SYS 将主页面返回给用户
</li>
</ol>


<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">
<p class="footnote"><sup><a class="footnum" name="fn-.1" href="#fnr-.1">1</a></sup> <a href="http://docs.spring.io/spring-security/site/docs/3.2.0.RELEASE/reference/htmlsingle/">http://docs.spring.io/spring-security/site/docs/3.2.0.RELEASE/reference/htmlsingle/</a>
</p>


<p class="footnote"><sup><a class="footnum" name="fn-.2" href="#fnr-.2">2</a></sup> <a href="http://javascript-reference.info/">http://javascript-reference.info/</a>
</p>


<p class="footnote"><sup><a class="footnum" name="fn-.3" href="#fnr-.3">3</a></sup> <a href="http://api.jquery.com/">http://api.jquery.com/</a>
</p>


<p class="footnote"><sup><a class="footnum" name="fn-.4" href="#fnr-.4">4</a></sup> <a href="http://www.jeasyui.com/documentation/index.php">http://www.jeasyui.com/documentation/index.php</a>
</p>


<p class="footnote"><sup><a class="footnum" name="fn-.5" href="#fnr-.5">5</a></sup> <a href="http://freemarker.org/docs/ref.html">http://freemarker.org/docs/ref.html</a>
</p>


<p class="footnote"><sup><a class="footnum" name="fn-.6" href="#fnr-.6">6</a></sup> <a href="http://msdn.microsoft.com/en-us/library/ms173763.aspx">http://msdn.microsoft.com/en-us/library/ms173763.aspx</a>
</p>


<p class="footnote"><sup><a class="footnum" name="fn-.7" href="#fnr-.7">7</a></sup> <a href="http://www.eclipse.org/">http://www.eclipse.org/</a>
</p>


<p class="footnote"><sup><a class="footnum" name="fn-.8" href="#fnr-.8">8</a></sup> <a href="http://subversion.apache.org/">http://subversion.apache.org/</a>
</p>


<p class="footnote"><sup><a class="footnum" name="fn-.9" href="#fnr-.9">9</a></sup> <a href="http://www.git-scm.com/">http://www.git-scm.com/</a>
</p>


<p class="footnote"><sup><a class="footnum" name="fn-.10" href="#fnr-.10">10</a></sup> <a href="http://maven.apache.org/">http://maven.apache.org/</a>
</p>


</div>
</div>
</div>

</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2014-09-22T14:24+0800</p>
<p class="author">Author: 雷鸣</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.3f with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
